<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icons/communication-icons.html" >
<link rel="import" href="../../bower_components/iron-icons/image-icons.html" >
<link rel="import" href="../../bower_components/iron-icons/social-icons.html" >
<link rel="import" href="../../bower_components/iron-image/iron-image.html" >

<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/google-streetview-pano/google-streetview-pano.html">
<link rel="import" href="../../bower_components/google-map/google-map.html">
<link rel="import" href="../../bower_components/google-map/google-map-marker.html">

<link rel="import" href="../yp-behaviors/app-helpers.html">

<dom-module id="yp-bulk-status-display">

  <template>

    <style include="iron-flex iron-flex-alignment">
      :host {
        display: block;
        width: 100%;
        height: 100%;
      }
    </style>

    <iron-signals on-iron-signal-yp-language="_languageEvent"></iron-signals>

    <h2>[[t('bulkStatusUdateFor')]] [[communityName]]</h2>

    <template is="dom-repeat" items="[[config.groups]]" as="group">
      <template is="dom-repeat" items="[[group.statuses]]" as="status">
        <h2>[[t(status.name)]]</h2>
        <template is="dom-repeat" items="[[status.post]]" as="post">
          <div class="layout vertical">
            <div class="postName">
              <a target="_blank" href="/post/[[post.id]]">[[post.name]]</a>
            </div>
            <div class="layout horizontal">
              <paper-icon-button class="openCloseButton" data-args$="[[post.id]]" icon="hardware:keyboard-arrow-right" on-tap="_setOpen"></paper-icon-button>
            </div>
            <div id="details_[[post.id]]" hidden>
              <div class="reason" hidden$="[[post.uniqueStatusMessage]]">
                [[templates[post.selectedTemplateName]]]
              </div>
              <div class="reason" hidden$="[[!post.uniqueStatusMessage]]">
                [[post.uniqueStatusMessage]]
              </div>
            </div>
          </div>
        </template>
      </template>
    </template>

    <yp-ajax id="ajax" url="/api/user/[[userId]]/status_update/[[statusUpdateId]]" on-response="_response"></yp-ajax>

  </template>

  <script>
    Polymer({
      is: 'yp-bulk-status-display',

      behaviors: [
        Polymer.appHelpers
      ],

      properties: {

        config: {
          type: Object
        },

        templates: {
          type: Object
        },

        communityName: {
          type: Object
        },

        statusUpdateId: {
          type: Number,
          observer: '_statusUpdateIdChanged'
        },

        userId: Number
      },

      _statusUpdateIdChanged: function (id) {
        if (id) {
          this.$.ajax.generateRequest();
        }
      },

      _setOpen: function (event) {
        var postId = event.target.getAttribute('data-args');
        this.$$("#detail_"+postId).hidden = false;
      },

      _setClosed: function () {
        var postId = event.target.getAttribute('data-args');
        this.$$("#detail_"+postId).hidden = true;
      },

      _response: function (event, detail) {
        this.set('config', detail.response.config);
        this.set('templates', detail.response.templates);
        this.set('communityName', detail.response.communityName);
      }
    });
  </script>
</dom-module>
