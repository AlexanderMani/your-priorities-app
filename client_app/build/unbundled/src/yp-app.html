<html><head><link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../bower_components/iron-signals/iron-signals.html">

<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">

<link rel="import" href="../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/app-layout/app-scrollpos-control/app-scrollpos-control.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">

<link rel="import" href="yp-app-globals/yp-app-globals.html">
<link rel="import" href="yp-app-globals/yp-app-user.html">
<link rel="import" href="yp-behaviors/app-helpers.html">
<link rel="import" href="yp-app/yp-app-drawer.html">
<link rel="import" href="yp-app/yp-app-nav-drawer.html">
<link rel="import" href="yp-dialog-container/yp-dialog-container.html">

<link rel="import" href="yp-domain/yp-domain.html">

</head><body><dom-module id="yp-app">

  <template>

    <style>
      :host {
        background-color: var(--primary-background-color);
      }

      app-header {
        color: #fff;
        background-color: var(--primary-background-color);
      }

      app-toolbar {
        color: #FFF;
      }

      iron-pages {
        background-color: var(--primary-background-color);
      }

      [condensed-title] {
        /*        background-size: 76px; */
        /* The difference in font size is used to calculate the scale of the title in the transition. */
        font-size: 16px;
      }

      [title] {
        /* The difference in font size is used to calculate the scale of the title in the transition. */
        font-size: 22;
        padding-top: 8px;
        padding-left: 8px;
      }

      .backIcon {
        width: 48px;
        height: 48px;
        padding-right: 16px;
        padding-bottom: 8px;
        padding-top: 0;
      }

      .closePostIcon {
        width: 52px;
        height: 52px;
      }

      .main-header {
        border-bottom: 1px solid var(--primary-color-800);
        background-color: var(--primary-color-800);
        color: #333;
        height: 64px;
      }

      .dropdown-content {
        width: 200px;
      }

      @media (max-width: 480px) {
        div[title] {
          font-size: 17px;
          white-space: normal !important;
        }

        .backIcon {
          width: 40px;
          height: 40px;
          padding-right: 8px;
        }

        .closePostIcon {
          width: 48px;
          height: 48px;
        }

        .loginButton {
          font-size: 15px;
          padding: 4px;
        }

        paper-menu-button {
          padding: 0;
        }

        paper-button {
          padding:0;
          margin: 0;
        }
      }
      @media (max-width: 340px) {
        div[title] {
          font-size: 17px;
          white-space: normal !important;
        }

        .backIcon {
          width: 40px;
          height: 40px;
          padding-right: 8px;
        }

        .loginButton {
          font-size: 12px;
          padding: 0;
        }
      }

    </style>
    <iron-signals on-iron-signal-yp-language="_languageEvent"></iron-signals>

    <yp-app-globals id="appGlobals" setup-defaults="" on-change-header="onChangeHeader"></yp-app-globals>

    <app-location route="{{route}}"></app-location>

    <app-route route="{{route}}" pattern="/:page" data="{{routeData}}" tail="{{subRoute}}"></app-route>

    <app-drawer-layout drawer-width="360px" responsive-width="16000px">

      <app-drawer id="drawer" align="end" position="right" swipe-open="">
        <div style="height: 100%; overflow: auto">
          <yp-app-drawer id="ypDrawer" user="[[user]]" route="[[route]]"></yp-app-drawer>
        </div>
      </app-drawer>

      <app-drawer id="navDrawer" align="start" position="left" swipe-open="">
        <div style="height: 100%; overflow: auto">
          <yp-app-nav-drawer id="ypNavDrawer" home-link="[[homeLink]]" on-yp-toggle-nav-drawer="_toggleNavDrawer" user="[[user]]" route="[[route]]"></yp-app-nav-drawer>
        </div>
      </app-drawer>

      <app-scrollpos-control selected="{{route}}"></app-scrollpos-control>

      <app-header-layout id="mainArea">

        <app-header id="appHeader" effects="waterfall" reveals="" class="main-header">
          <app-toolbar>
            <div hidden$="[[closePostHeader]]" class="layout horizontal">
              <paper-icon-button id="paperToggleNavMenu" icon="menu" on-tap="_toggleNavDrawer"></paper-icon-button>
              <div title="" class="layout vertical wrap">[[headerTitle]]</div>
              <paper-icon-button icon="arrow-upward" on-tap="goBack" class="backIcon" hidden$="[[!showBack]]"></paper-icon-button>
            </div>
            <template is="dom-if" if="[[closePostHeader]]">
              <paper-icon-button id="closePostButton" class="closePostIcon" icon="clear" on-tap="_closePost"></paper-icon-button>
            </template>

            <span class="flex"></span>

            <paper-menu-button horizontal-align="right">
              <paper-icon-button icon="help-outline" class="dropdown-trigger"></paper-icon-button>
              <paper-menu class="dropdown-content">
                <template is="dom-repeat" items="[[pages]]" as="page">
                  <paper-item data-args$="[[index]]" on-tap="_openPage">[[_getLocalizePageTitle(page)]]</paper-item>
                </template>
              </paper-menu>
            </paper-menu-button>

            <template is="dom-if" if="[[user]]">
              <paper-icon-button on-tap="_toggleUserDrawer" icon="face"></paper-icon-button>
            </template>

            <template is="dom-if" if="[[!user]]">
              <paper-button class="loginButton" on-tap="_login">[[t('user.login')]]</paper-button>
            </template>
          </app-toolbar>
        </app-header>

        <iron-pages selected="{{page}}" attr-for-selected="name" fallback-selection="view404">
          <yp-domain name="domain" sub-route="subRoute" on-change-header="onChangeHeader"></yp-domain>
          <yp-community name="community" sub-route="" on-change-header="onChangeHeader"></yp-community>
          <yp-group name="group" on-change-header="onChangeHeader"></yp-group>
          <yp-post name="post" on-change-header="onChangeHeader"></yp-post>
          <yp-user name="user" on-change-header="onChangeHeader"></yp-user>
          <yp-view-404 name="view404"></yp-view-404>
        </iron-pages>

      </app-header-layout>

    </app-drawer-layout>

    <yp-dialog-container id="dialogContainer"></yp-dialog-container>
    <yp-app-user id="appUser" on-user-changed="onUserChanged"></yp-app-user>
  </template>

  <script>Polymer({is:"yp-app",behaviors:[Polymer.appHelpers],properties:{homeLink:{type:Object},page:{type:String,reflectToAttribute:!0,observer:"_pageChanged"},route:{type:Object,observer:"_routeChanged"},routeData:Object,subRoute:Object,appTitle:{type:String,value:"Your Priorities"},user:{type:Object,value:null},previousSearches:{type:Array,value:[]},showSearch:{type:Boolean,value:!1},showBack:{type:Boolean,value:!1},backPath:{type:String},storedBackPath:String,storedLastDocumentTitle:String,headerTitle:{type:String},headerDescription:{type:String},params:{type:Object},narrow:{type:Boolean},pages:{type:Array},keepOpenForPost:{type:String,value:null},closePostHeader:{type:Boolean,computed:"_closePostHeader(params, keepOpenForPost)",value:null}},observers:["_routePageChanged(routeData.page)"],listeners:{"yp-set-pages":"_setPages","yp-set-home-link":"_setHomeLink"},_routeChanged:function(){window.location.href.indexOf("/#!/")>-1&&(window.location=window.location.href.replace("/#!/","/"))},_routePageChanged:function(e){this.page=e||"domain"},_pageChanged:function(e){var t=this.resolveUrl("yp-"+e+"/yp-"+e+".html");this.importHref(t,null,this._showPage404,!0)},_showPage404:function(){this.page="view404"},_setHomeLink:function(e,t){this.homeLink||this.set("homeLink",t)},setKeepOpenForPostsOn:function(e){this.set("keepOpenForPost",e),this.set("storedBackPath",this.backPath),this.set("storedLastDocumentTitle",document.title)},_closePost:function(){this.keepOpenForPost&&this.redirectTo(this.keepOpenForPost),this.storedBackPath&&this.set("backPath",this.storedBackPath),this.storedLastDocumentTitle&&(document.title=this.storedLastDocumentTitle,this.set("storedLastDocumentTitle",null)),this.set("this.keepOpenForPost",null)},_closePostHeader:function(e,t){return!(!e.postId||!t)},_isGroupOpen:function(e,t){return!!(e.groupId||e.postId&&t)},_isCommunityOpen:function(e,t){return!!(e.communityId||e.postId&&t)},_isDomainOpen:function(e,t){return!!(e.domainId||e.postId&&t)},_toggleNavDrawer:function(){this.$$("#navDrawer").toggle()},_setPages:function(e,t){this.set("pages",t)},_openPage:function(e){var t=JSON.parse(e.currentTarget.getAttribute("data-args")),o=this.pages[t];window.appGlobals.activity("open","pages",o.id);var i=Polymer.dom(document).querySelector("yp-app").getDialog("pageDialog"),n="en";o.title[window.locale]&&(n=window.locale),i.open(o.title[n],o.content[n])},_getLocalizePageTitle:function(e){var t="en";return e.title[window.locale]&&(t=window.locale),e.title[t]},ready:function(){},getDialog:function(e){return this.$$("#dialogContainer").getDialog(e)},scrollPageToTop:function(){var e=document.getElementById("#mainArea");e&&(e.scroller.scrollTop=0)},_toggleUserDrawer:function(){this.$$("#drawer").toggle()},openEdit:function(){var e=Polymer.dom(document).querySelector("yp-dialog-container #userEdit");e.setup(this.user,!1,null),e.open("edit",{userId:this.user.id})},_login:function(){window.appUser&&window.appUser.openUserlogin()},onChangeHeader:function(e,t){this.headerTitle=document.title=t.headerTitle,t.documentTitle&&(document.title=t.documentTitle),this.headerDescription=t.headerDescription,t.enableSearch?this.showSearch=!0:this.showSearch=!1,t.backPath?(this.showBack=!0,this.backPath=t.backPath):(this.showBack=!1,this.backPath=null)},goBack:function(e,t){this.backPath&&this.redirectTo(this.backPath)},_onSearch:function(e){this.toggleSearch(),this.unshift("previousSearches",e.detail.value);var t=document.querySelector("#postsFilter");t&&t.searchFor(e.detail.value)},onUserChanged:function(e,t){t&&t.id?this.set("user",t):this.set("user",null)},toggleSearch:function(){this.$$("#search").toggle()},__equal:function(e,t){return e===t},routeChanged:function(e,t){this.$$("#drawer")&&!this.$$("#drawer").persistent&&this.$$("#drawer").close()}});</script>
</dom-module>
</body></html>