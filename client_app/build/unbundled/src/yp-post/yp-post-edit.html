<html><head><link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../bower_components/iron-signals/iron-signals.html">

<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="../../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="../../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tab.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/neon-animation/neon-animated-pages.html">
<link rel="import" href="../../bower_components/neon-animation/neon-animatable.html">
<link rel="import" href="../../bower_components/neon-animation/neon-animation.html">

<link rel="import" href="../../bower_components/file-upload/file-upload.html">
<link rel="import" href="../yp-behaviors/app-helpers.html">
<link rel="import" href="../yp-edit-dialog/yp-edit-dialog.html">
<link rel="import" href="../yp-edit-dialog/yp-edit-dialog-behavior.html">
<link rel="import" href="../yp-image-uploader/yp-image-uploader.html">
<link rel="import" href="yp-post-location.html">

</head><body><dom-module id="yp-post-edit">
  <template>

    <style include="iron-flex iron-flex-alignment">
      .access {
        @apply(--layout-horizontal);
        @apply(--layout-center-justified);
      }

      file-upload::shadow paper-button {
        background-color: var(--accent-color);
        color: #FFF;
      }

      file-upload {
        margin-top: 16px;
      }

      .accessHeader {
        color: var(--primary-color,#777);
        font-weight: normal;
        margin-bottom: 0;
      }

      paper-radio-button {
        display: block;
      }

      .container {
        width: 100%;
        height: 100%;
        min-height: 300px;
      }

      @media (max-width: 600px) {
        .container {
          padding-right: 16px;
        }

        .subContainer {
        }

        paper-tab {
          font-size: 12px;
        }
      }

      yp-post-location {
      }

      section {
        margin-top: 32px;
      }

      .imageSizeInfo {
        font-size: 12px;
        padding-bottom: 16px;
        color: #444;
      }
    </style>
    <iron-signals on-iron-signal-yp-language="_languageEvent"></iron-signals>

    <yp-edit-dialog double-width="" id="editDialog" icon="icons:lightbulb-outline" action="[[action]]" use-next-tab-action="[[new]]" on-next-tab-action="_nextTab" method="[[method]]" save-text="[[saveText]]" next-action-text="[[t('next')]]" toast-text="[[toastText]]" params="[[params]]">
      <h2>[[editHeaderText]]</h2>
      <paper-tabs selected="{{selected}}" id="paperTabs" focused="">
        <paper-tab><span>[[t('post.yourPost')]]</span></paper-tab>
        <template is="dom-if" restamp="" if="[[new]]">
          <paper-tab>[[t('post.yourPoint')]]</paper-tab>
        </template>
        <template is="dom-if" if="[[!locationHidden]]" restamp="">
          <paper-tab>[[t('post.location')]]</paper-tab>
        </template>
        <paper-tab>[[t('post.photo')]]</paper-tab>
      </paper-tabs>

      <div class="layout vertical wrap container">
        <neon-animated-pages id="pages" class="layout horizontal flex" selected="[[selected]]">
          <section>
            <div class="layout vertical">

              <paper-input id="name" required="" minlength="5" name="name" type="text" label="[[t('title')]]" value="{{post.name}}" maxlength="60" char-counter="">
              </paper-input>

              <template is="dom-if" if="[[_showCategories(group)]]" restamp="">
                <paper-dropdown-menu label="[[t('category.select')]]">
                  <paper-menu class="dropdown-content" selected="{{selectedCategoryArrayId}}">
                    <template is="dom-repeat" items="[[group.Categories]]" as="category">
                      <paper-item data-category-id$="[[category.id]]">[[category.name]]</paper-item>
                    </template>
                  </paper-menu>
                </paper-dropdown-menu>
                <input type="hidden" name="categoryId" value="[[selectedCategoryId]]">
              </template>

              <paper-textarea id="description" required="" minlength="10" name="description" value="{{post.description}}" label="[[t('post.description')]]" char-counter="" rows="2" max-rows="5" maxlength="500">
              </paper-textarea>
            </div>
          </section>

          <template is="dom-if" restamp="" if="[[new]]">
            <section class="subContainer">
              <paper-textarea id="pointFor" required="" minlength="5" name="pointFor" value="{{post.pointFor}}" label="[[t('point.for')]]" char-counter="" rows="2" max-rows="5" maxlength="500">
              </paper-textarea>
            </section>
          </template>

          <template is="dom-if" if="[[!locationHidden]]" restamp="">
            <section>
                <template is="dom-if" if="[[mapActive]]" restamp="">
                  <yp-post-location encoded-location="{{encodedLocation}}" location="{{location}}" post="[[post]]"></yp-post-location>
                </template>
            </section>
          </template>

          <section>
            <div class="layout vertical center-center">
              <file-upload id="imageFileUpload" raised="true" multi="false" target="/api/images?itemType=post-header" method="POST" on-success="_imageUploaded">
                <iron-icon class="icon" icon="image:photo-camera"></iron-icon>
                <span>[[t('image.upload')]]</span>
              </file-upload>
              <div class="imageSizeInfo layout horizontal">
                <div>864 x 486 (16/9 widescreen)</div>
              </div>
              <div>[[t('post.cover.imageInfo')]]</div>
              <br>
              <h3 class="accessHeader">[[t('post.cover.media')]]</h3>
              <paper-radio-group id="coverMediaType" name="coverMediaType" class="coverMediaType layout horizontal" selected="{{selectedCoverMediaType}}">
                <paper-radio-button name="none">[[t('post.cover.none')]]</paper-radio-button>
                <paper-radio-button name="image">[[t('post.cover.image')]]</paper-radio-button>
                <template is="dom-if" if="[[location]]">
                  <paper-radio-button name="map">[[t('post.cover.map')]]</paper-radio-button>
                  <paper-radio-button name="streetView">[[t('post.cover.streetview')]]</paper-radio-button>
                </template>
              </paper-radio-group>
            </div>
          </section>
        </neon-animated-pages>
        <input type="hidden" name="location" value="[[encodedLocation]]">
        <input type="hidden" name="coverMediaType" value="[[selectedCoverMediaType]]">
        <input type="hidden" name="uploadedHeaderImageId" value="[[uploadedHeaderImageId]]">
      </div>
    </yp-edit-dialog>
  </template>

</dom-module>

<script>Polymer({is:"yp-post-edit",behaviors:[Polymer.appHelpers,Polymer.ypEditDialogBehavior],properties:{action:{type:String,value:"/api/posts"},new:{type:Boolean,value:!1},post:{type:Object,observer:"_postChanged"},group:{type:Object},locationHidden:{type:Boolean,value:!1,observer:"_locationHiddenChanged"},location:{type:Object,observer:"_locationChanged"},encodedLocation:{type:String,observer:"_encodedLocationChanged"},selectedCategoryArrayId:{type:Number,observer:"_selectedCategoryChanged"},selectedCategoryId:{type:Number},selectedCoverMediaType:{type:String,value:"none",observer:"_coverMediaTypeValueChanged"},uploadedHeaderImageId:{type:String,observer:"_uploadedHeaderImageIdChanged"},selected:{type:Number,value:0,observer:"_selectedChanged"},mapActive:{type:Boolean,value:!1}},listeners:{"iron-form-invalid":"_formInvalid"},_locationHiddenChanged:function(e){this.async(function(){var e=this.$$("#pages");e&&e.forceSynchronousItemUpdate();var t=this.$$("#paperTabs");t&&t.forceSynchronousItemUpdate(),console.log("Location hidden changed")},10)},_formInvalid:function(){this.set("selected",0),this.$$("#name").autoValidate=!0,this.$$("#description").autoValidate=!0,this.new&&(this.$$("#pointFor").autoValidate=!0)},_encodedLocationChanged:function(e){},_locationChanged:function(e){!e||this.selectedCoverMediaType&&""!=this.selectedCoverMediaType&&"none"!=this.selectedCoverMediaType||this.set("selectedCoverMediaType","map")},_uploadedHeaderImageIdChanged:function(e){e&&this.set("selectedCoverMediaType","image")},_nextOnEnter:function(e){13===e.keyCode&&this._searchMap()},_nextTab:function(){var e=3;this.new||(e=2),this.locationHidden&&(e-=1),this.selected<e&&this.set("selected",this.selected+1)},_selectedChanged:function(e){this.locationHidden||e!=(this.new?2:1)?this.set("mapActive",!1):this.set("mapActive",!0);var t=this.locationHidden?2:3;!this.new||this.new&&e==t?this.$$("#editDialog").useNextTabAction=!1:this.$$("#editDialog").useNextTabAction=!0},_selectedCategoryChanged:function(e,t){null!=e&&void 0!=e&&(this.selectedCategoryId=this.group.Categories[e].id)},_showCategories:function(e){return!(!e||!e.Categories)&&e.Categories.length>0},getPositionInArrayFromId:function(e,t){for(var o=0;o<e.length;o++)if(e[o].id==t)return o;return null},_postChanged:function(e,t){e&&(e.location&&(this.set("location",e.location),this.set("encodedLocation",JSON.stringify(this.location))),e.cover_media_type&&(this.selectedCoverMediaType=e.cover_media_type),e.category_id&&(this.selectedCategoryId=e.category_id,this.selectedCategoryArrayId=this.getPositionInArrayFromId(this.group.Categories,e.category_id)))},_imageUploaded:function(e,t){var o=JSON.parse(t.xhr.response);this.set("uploadedHeaderImageId",o.id)},_coverMediaTypeValueChanged:function(e,t){},_coverMediaTypeChanged:function(e,t){},_customRedirect:function(e){e?(e.newEndorsement&&window.appUser&&window.appUser.endorsementPostsIndex&&(window.appUser.endorsementPostsIndex[e.id]=e.newEndorsement),this.redirectTo("/post/"+e.id)):console.warn("No post found on custom redirect")},_clear:function(){this.new&&(this.set("post",{name:"",description:"",pointFor:"",categoryId:null}),this.set("location",null),this.set("selectedCategoryArrayId",null),this.set("selectedCategoryId",null),this.set("selected",0),this.set("uploadedHeaderImageId",null),this.$$("#imageFileUpload").clear(),this.set("selectedCoverMediaType","none"))},setup:function(e,t,o,i){t?(this.set("group",t),this.group.configuration&&this.group.configuration.locationHidden&&1==this.group.configuration.locationHidden?this.set("locationHidden",!0):this.set("locationHidden",!1)):this.set("group",null),e?this.set("post",e):this.set("post",null),this.set("new",o),this.set("refreshFunction",i),this._setupTranslation(),this._clear()},_setupTranslation:function(){this.new?(this.editHeaderText=this.t("post.new"),this.toastText=this.t("post.toast.created")):(this.editHeaderText=this.t("post.edit"),this.toastText=this.t("post.toast.updated"))}});</script>
</body></html>