<html><head><link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-list/iron-list.html">
<link rel="import" href="../../bower_components/iron-icons/social-icons.html">
<link rel="import" href="../../bower_components/iron-signals/iron-signals.html">

<link rel="import" href="../../bower_components/paper-tabs/paper-tab.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/neon-animation/neon-animated-pages.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link href="../../bower_components/paper-search/paper-search.html" rel="import">

<link rel="import" href="../with-in-viewport/with-in-viewport.html">

<link rel="import" href="../yp-behaviors/app-helpers.html">
<link rel="import" href="../yp-behaviors/yp-scroll-tab-behavior.html">
<link rel="import" href="../ac-activities/ac-activities.html">

<link rel="import" href="../yp-ajax/yp-ajax.html">
<link rel="import" href="../yp-post/yp-post-card.html">
<link rel="import" href="../yp-post/yp-post-edit.html">
<link rel="import" href="../yp-post/yp-post-card-add.html">

<link rel="import" href="../yp-posts-filter/yp-posts-filter.html">

</head><body><dom-module id="yp-post-list">
  <template>
    <style>

      :host {
      }

      .container {
        @apply(--layout-horizontal);
        @apply(--layout-wrap);
      }

      .postsFilter {
        padding-left: 16px;
        height: 36px;
      }

      .objectives {
        padding-bottom: 40px;
        max-width: 432px;
      }

      .description {
        padding: 12px;
      }


      yp-post-card {
        padding-bottom: 52px;
      }

      #outerRegion {
        position: relative;
        @apply(--layout-vertical);

      }

      #scrollableRegion {
        height: 100%;
        @apply(--layout-flex);
      }

      iron-list {
        width: 960px;
        height: 100%;
      }

      .searchContainer {
        width: 1024px;
      }

      yp-ajax {
        padding-top: 48px;
      }


      @media (max-width: 1024px) {
        iron-list, .searchContainer {
          width: 960px;
        }
      }

      @media (max-width: 900px) {
        iron-list, .searchContainer {
          width: 600px;
        }
      }

      @media (max-width: 640px) {
        iron-list, .searchContainer {
          width: 420px;
        }
      }

      @media (max-width: 420px) {
        iron-list, .searchContainer {
          width: 360px;
        }
      }

      yp-posts-filter {
        margin-bottom: 8px;
        margin-left: 8px;
        margin-top: 16px;
      }

      #list {
        margin-top: 16px;
      }

      .searchButton {
        padding: 8px;
        margin: 8px;
      }

      .searchContainer {
        margin-top: 16px;
      }

      yp-posts-filter {
        padding-right: 16px;
      }

      paper-search-bar {
        width: 270px;
      }

      .half {
        width: 50%
      }

      @media (max-width: 800px) {
        .half {
          width: 100%;
        }

        .searchContainer {
          @apply(--layout-center-center);
        }
      }

    </style>
    <iron-signals on-iron-signal-yp-language="_languageEvent"></iron-signals>

    <div class="layout horizontal center-center">
      <div class="searchContainer layout horizontal wrap">
        <div class="layout horizontal center-center">
          <paper-search-bar hide-clear-button="" hide-filter-button="" query="{{searchingFor}}" placeholder="[[t('searchFor')]]" on-paper-search-search="_search"></paper-search-bar>
        </div>
        <div class="layout horizontal center-center">
          <yp-posts-filter class="filter" id="postsFilter" tab-name="[[statusFilter]]" on-refresh-group="_refreshGroupFromFilter" group="[[group]]" filter="{{filter}}" searching-for="{{searchingFor}}" category-id="{{categoryId}}" category-name="{{categoryName}}" posts-count="{{postsCount}}">
          </yp-posts-filter>
        </div>
      </div>
    </div>

    <div id="scrollableRegion">
      <template is="dom-if" if="[[posts]]" restamp="">
        <iron-list id="list" items="[[posts]]" as="post">
          <template>
            <div class="layout vertical center-center">
              <yp-post-card tabindex$="[[tabIndex]]" class="card" post="[[post]]" on-mouseover="cardMouseOver" on-mouseout="cardMouseOut"></yp-post-card>
            </div>
          </template>
        </iron-list>
      </template>
      <div class="layout horizontal center-center">
        <yp-ajax id="ajax" large-spinner="" on-response="_postsResponse"></yp-ajax>
        <template is="dom-if" if="[[moreToLoad]]" restamp="">
          <paper-button on-tap="_loadMoreData" id="loadMoreButton">[[t('more')]]</paper-button>
        </template>
      </div>
    </div>
  </template>

  <script>Polymer({is:"yp-post-list",behaviors:[Polymer.appHelpers,Polymer.YpScrollTabBehavior],properties:{categories:{type:Array},defaultCategories:{type:Boolean,value:!1},posts:{type:Array,value:null,notify:!0},groupId:{type:Number,observer:"_groupIdChanged"},userId:{type:Number},group:{type:Object,notify:!0},filter:{type:String,value:"newest",observer:"_filterChanged"},statusFilter:{type:String,value:"open",notify:!0},categoryId:{type:String,observer:"_categoryIdChanged"},postsCount:{type:Number,notify:!0},categoryName:{type:String},searchingFor:{type:String,value:null,observer:"_searchingForChanged"},selectedCategoryName:{type:String},tabCounterId:{type:String},oldestPostAt:{type:Date}},_search:function(){window.appGlobals.activity("click","search"),this._refreshGroupFromFilter()},cardMouseOver:function(t){t.currentTarget.elevation=4},cardMouseOut:function(t){t.currentTarget.elevation=1},buildPostsUrlPath:function(){return this.$.postsFilter.buildPostsUrlPath()},_searchingForChanged:function(t,e){},_filterChanged:function(t,e){},_categoryIdChanged:function(t,e){},ready:function(){},_groupIdChanged:function(t,e){t&&(this.set("posts",null),this._loadMoreData())},_refreshGroupFromFilter:function(){this.set("posts",null),this._loadMoreData()},_loadMoreData:function(){this.set("moreToLoad",!1);var t,e;this.userId?(t=this.userId+"/posts",e="users"):(t=this.groupId,e="groups"),this.filter||this.set("filter","newest"),this.searchingFor?this.$$("#ajax").url="/api/"+e+"/"+t+"/search/"+this.searchingFor:(this.$$("#ajax").url="/api/"+e+"/"+t+"/posts/"+this.filter,this.categoryId?this.$$("#ajax").url+="/"+this.categoryId:this.$$("#ajax").url+="/null",this.$$("#ajax").url+="/"+this.statusFilter),this.$$("#ajax").url+="?offset="+(null!=this.posts?this.posts.length:0),this.$$("#ajax").generateRequest()},_postsResponse:function(t,e,s){this.posts||this.set("posts",[]);var r=e.response.posts;this.set("postsCount",e.response.totalPostsCount),this.fire("yp-post-count",{tabCounterId:this.tabCounterId,count:this.postsCount}),this.$$("#postsFilter")._updateTitle(),r.forEach(function(t){this.push("posts",t)}.bind(this)),this.async(function(){this.$$("#list").fire("iron-resize")},10),r.length>0&&r.length!=this.postsCount&&this.setMoreToLoad(),this._processCategories()},_processCategories:function(){if(this.categoryId&&this.group)for(var t=0;t<this.group.Categories.length;t++)this.group.Categories[t].id==this.categoryId&&(this.selectedCategoryName=this.group.Categories[t].name);else this.selectedCategoryName="categories.all"}});</script>
</dom-module>
</body></html>