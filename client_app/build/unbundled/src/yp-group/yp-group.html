<html><head><link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../bower_components/iron-list/iron-list.html">
<link rel="import" href="../../bower_components/iron-scroll-threshold/iron-scroll-threshold.html">
<link rel="import" href="../../bower_components/iron-icons/social-icons.html">
<link rel="import" href="../../bower_components/iron-signals/iron-signals.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">

<link rel="import" href="../../bower_components/paper-tabs/paper-tab.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/neon-animation/neon-animated-pages.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">

<link rel="import" href="../../bower_components/app-route/app-route.html">

<link rel="import" href="../yp-behaviors/app-helpers.html">
<link rel="import" href="../yp-behaviors/yp-scroll-tab-behavior.html">
<link rel="import" href="../ac-activities/ac-activities.html">
<link rel="import" href="../yp-page/yp-page.html">

<link rel="import" href="../yp-ajax/yp-ajax.html">
<link rel="import" href="../yp-post/yp-post-card.html">
<link rel="import" href="../yp-post/yp-post-card-add.html">

<link rel="import" href="../yp-posts-filter/yp-posts-filter.html">
<link rel="import" href="../yp-post/yp-post-list.html">
<link rel="import" href="../yp-post/yp-post-map.html">
<link rel="import" href="../yp-theme/yp-theme-behavior.html">

<link rel="import" href="../yp-post/yp-post-edit.html">
<link rel="import" href="../yp-group/yp-group-edit.html">

<link rel="import" href="yp-group-card-large.html">

</head><body><dom-module id="yp-group">
  <template>
    <style include="iron-flex iron-flex-alignment">
      .objectives {
        padding-bottom: 40px;
        max-width: 432px;
      }

      .description {
        padding: 12px;
      }

      yp-ajax {
        background-color: var(--primary-background-color);
      }

      .counterInfo {
        font-size: 11px;
      }
    </style>
    <iron-signals on-iron-signal-yp-language="_languageEvent"></iron-signals>

    <app-route route="{{idRoute}}" pattern="/:id" data="{{idRouteData}}" tail="{{tabRoute}}">
    </app-route>

    <app-route route="{{tabRoute}}" pattern="/:tabName" data="{{tabRouteData}}" tail="{{listRoute}}">
    </app-route>

    <yp-page id="page" create-fab-icon="[[createFabIcon]]" create-fab-title="[[t('post.add_new')]]" on-yp-create-fab-tap="_newPost">

      <yp-group-card-large id="groupCard" class="largeCard" group="[[group]]" on-update-group="_refreshAjax"></yp-group-card-large>

      <div class="largeAddButton">
        <yp-post-card-add on-new-post="_newPost" elevation="2" hidden$="[[!createFabIcon]]"></yp-post-card-add>
      </div>

      <paper-tabs id="paperTabs" class="tabs" selected="{{selectedTab}}" attr-for-selected="name" focused="">
        <paper-tab id="tab1" name="open">
          <div class="layout vertical center-center tabCounterContainer">
            <span>[[t('posts.open')]]</span><div class="counterInfo" id="tabCountOpen"></div>
          </div>
        </paper-tab>
        <paper-tab name="news">[[t('news')]]</paper-tab>
        <template is="dom-if" if="[[hasNonOpenPosts]]">
          <paper-tab name="in_progress">
            <div class="layout vertical center-center tabCounterContainer">
              <span>[[t('posts.inProgress')]]</span><div class="counterInfo" id="tabCountInProgress"></div>
            </div>
          </paper-tab>
          <paper-tab name="successful">
            <div class="layout vertical center-center tabCounterContainer">
              <span>[[t('posts.successful')]]</span><div class="counterInfo" id="tabCountSuccessful"></div>
            </div>
          </paper-tab>
          <paper-tab name="failed">
            <div class="layout vertical center-center tabCounterContainer">
              <span>[[t('posts.failed')]]</span><div class="counterInfo" id="tabCountFailed"></div>
            </div>
          </paper-tab>
        </template>
        <paper-tab name="map">[[t('posts.map')]]</paper-tab>
      </paper-tabs>

      <iron-pages id="tabPages" class="tabPages" selected="{{selectedTab}}" attr-for-selected="name" entry-animation="fade-in-animation" exit-animation="fade-out-animation">
        <section name="open">
          <div class="layout horizontal center-center">
            <yp-post-list id="openPostList" selected-tab="[[selectedTab]]" list-route="[[listRoute]]" status-filter="open" tab-counter-id="tabCountOpen" searching-for="[[searchingFor]]" group="[[group]]" group-id="[[lastValidGroupId]]"></yp-post-list>
          </div>
        </section>
        <section name="news">
          <ac-activities id="groupActivities" disable-new-posts="[[disableNewPosts]]" selected-tab="[[selectedTab]]" list-route="[[listRoute]]" group-id="[[group.id]]"></ac-activities>
        </section>
        <template is="dom-if" if="[[hasNonOpenPosts]]">
          <section name="in_progress">
            <div class="layout horizontal center-center">
              <yp-post-list id="inProgressPostList" selected-tab="[[selectedTab]]" list-route="[[listRoute]]" status-filter="in_progress" tab-counter-id="tabCountInProgress" searching-for="[[searchingFor]]" group="[[group]]" group-id="[[lastValidGroupId]]"></yp-post-list>
            </div>
          </section>
          <section name="successful">
            <div class="layout horizontal center-center">
              <yp-post-list id="successfulPostList" selected-tab="[[selectedTab]]" list-route="[[listRoute]]" status-filter="successful" tab-counter-id="tabCountSuccessful" searching-for="[[searchingFor]]" group="[[group]]" group-id="[[lastValidGroupId]]"></yp-post-list>
            </div>
          </section>
          <section name="failed">
            <div class="layout horizontal center-center">
              <yp-post-list id="failedPostList" selected-tab="[[selectedTab]]" list-route="[[listRoute]]" status-filter="failed" tab-counter-id="tabCountFailed" searching-for="[[searchingFor]]" group="[[group]]" group-id="[[lastValidGroupId]]"></yp-post-list>
            </div>
          </section>
        </template>
        <section name="map">
          <template is="dom-if" if="[[mapActive]]" restamp="">
            <yp-post-map group-id="[[group.id]]"></yp-post-map>
          </template>
        </section>
      </iron-pages>
    </yp-page>

    <div class="layout horizontal center-center">
      <yp-ajax large-spinner="" id="ajax" on-response="_groupsResponse"></yp-ajax>
      <yp-ajax id="pagesAjax" on-response="_pagesResponse"></yp-ajax>
    </div>

  </template>

  <script>Polymer({is:"yp-group",behaviors:[Polymer.appHelpers,Polymer.ypThemeBehavior],listeners:{"yp-post-count":"_updateTabPostCount"},properties:{idRoute:Object,tabRoute:Object,idRouteData:Object,tabRouteData:Object,listRoute:Object,createFabIcon:{type:String,value:null,notify:!0},groupId:{type:Number,observer:"_groupIdChanged"},group:{type:Object,notify:!0,value:null},searchingFor:{type:String,value:null},selectedTab:{type:String,value:"open",observer:"_selectedTabChanged"},hasNonOpenPosts:{type:Boolean,value:!1,observer:"_hasNonOpenPostsChanged"},mapActive:{type:Boolean,value:!1},lastValidGroupId:{type:String},disableNewPosts:{type:Boolean,value:!1}},observers:["_routeIdChanged(idRouteData.id)","_routeTabChanged(tabRouteData.tabName)"],_routeIdChanged:function(e){e&&this.set("groupId",e)},_routeTabChanged:function(e){e&&this.set("selectedTab",e)},_selectedTabChanged:function(e){this.group&&this.redirectTo("/group/"+this.group.id+"/"+e),"map"==e?this.set("mapActive",!0):this.set("mapActive",!1),e&&window.appGlobals&&window.appGlobals.activity("open","group_tab_"+e)},_hasNonOpenPostsChanged:function(){this.async(function(){var e=this.$$("#tabPages");e&&e.forceSynchronousItemUpdate();var t=this.$$("#paperTabs");t&&(t.forceSynchronousItemUpdate(),t.notifyResize())},10)},_updateTabPostCount:function(e,t){var o=this.$$("#"+t.tabCounterId);o&&(o.innerHTML=this.formatNumber(t.count))},_searchingForChanged:function(e,t){},_filterChanged:function(e,t){},_categoryIdChanged:function(e,t){},_openEdit:function(){this.$$("#groupEdit").open("edit",{groupId:this.group.id})},_refreshAjax:function(){this.$.ajax.generateRequest(),this.$$("#groupActivities").loadNewData()},ready:function(){},_groupIdChanged:function(e,t){e&&e!=this.lastValidGroupId&&(this.set("lastValidGroupId",e),this.set("group",null),this.$.groupCard.resetGroup(),this.$.tabCountOpen.innerHTML="",this.hasNonOpenPosts&&(this.$$("#tabCountInProgress").innerHTML="",this.$$("#tabCountSuccessful").innerHTML="",this.$$("#tabCountFailed").innerHTML=""),this.set("selectedTab","open"),this.set("hasNonOpenPosts",!1),this._getGroup())},_getGroup:function(){this.$.ajax.url="/api/groups/"+this.groupId,this.$.ajax.retryMethodAfter401Login=this._getGroup.bind(this),this.$.ajax.generateRequest()},_pagesResponse:function(e,t){this.fire("yp-set-pages",t.response)},_groupsResponse:function(e,t,o){this.set("group",t.response.group),this.refresh(),this.group.configuration&&void 0!=this.group.configuration.canAddNewPosts?this.group.configuration.canAddNewPosts===!0?(this.set("createFabIcon","lightbulb-outline"),this.set("disableNewPosts",!1)):this.set("disableNewPosts",!0):this.set("createFabIcon","lightbulb-outline"),this.set("hasNonOpenPosts",t.response.hasNonOpenPosts)},refresh:function(){this.group&&(this.fire("yp-set-home-link",{type:"group",id:this.group.id,name:this.group.name}),this.group.configuration&&null!=this.group.configuration.defaultLocale&&this.changeLocaleIfNeeded(this.group.configuration.defaultLocale),null!=this.group.theme_id?this.setTheme(this.group.theme_id):null!=this.group.Community.theme_id?this.setTheme(this.group.Community.theme_id):null!=this.group.Community.Domain.theme_id&&this.setTheme(this.group.Community.Domain.theme_id),this.group.GroupHeaderImages&&this.group.GroupHeaderImages.length>0&&this.$.page.setupTopHeaderImage(this.group.GroupHeaderImages),this.fire("change-header",{headerTitle:this.group.Community.name,headerDescription:this.group.Community.description,headerIcon:"social:group",documentTitle:this.group.name,enableSearch:!0,backPath:"/community/"+this.group.community_id}),this.$.pagesAjax.url="/api/groups/"+this.group.id+"/pages",this.$.pagesAjax.generateRequest())},_newPost:function(){window.appGlobals.activity("open","newPost");var e=Polymer.dom(document).querySelector("yp-app").getDialog("postEdit");e.setup(null,this.group,!0,null),e.open("new",{groupId:this.groupId})}});</script>
</dom-module>
</body></html>