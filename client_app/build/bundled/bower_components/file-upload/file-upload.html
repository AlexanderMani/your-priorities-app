<html><head><link rel="import" href="../polymer/polymer.html">



<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-progress/paper-progress.html">
  <link rel="import" href="../iron-icons/iron-icons.html">

</head><body><dom-module id="file-upload">

  <style type="text/css">
    .enabled {
      border: 1px dashed #555;
    }

    .hover {
      opacity: .7;
      border: 1px dashed #111;
    }

    #UploadBorder{
      vertical-align: middle;
      color: #555;
      padding: 20px;
      max-height: 300px;
      overflow-y: auto;
      display: inline-block;
    }

    #dropArea {
      text-align: center;
    }

    paper-button {
      margin-bottom: 20px;
    }

    .file {
      padding: 10px 0px;
    }

    .commands {
      float: right;
    }

    .commands iron-icon:not([icon="check-circle"]) {
      cursor: pointer;
      opacity: .9;
    }

    .commands iron-icon:hover {
      opacity: 1;
    }

    [hidden] {
      display: none;
    }

    .error {
      color: #f40303;
      font-size: 11px;
      margin: 2px 0px -3px;
    }

    paper-progress {
      --paper-progress-active-color: #03a9f4;
    }

    paper-progress[error] {
      --paper-progress-active-color: #f40303;
    }
  </style>

  <template>
    <div>
      <paper-button id="button" icon="file-upload" class="blue" on-click="_fileClick">
        <content></content>
      </paper-button>
      <div id="UploadBorder">
        <div id="dropArea" hidden$="{{!_shownDropText}}">{{dropText}}</div>
        <template is="dom-repeat" items="{{files}}">
          <div class="file">
            <div class="name">
              <span>{{item.name}}</span>
              <div class="commands">
                <iron-icon icon="autorenew" title="{{retryText}}" on-click="_retryUpload" hidden$="{{!item.error}}"></iron-icon>
                <iron-icon icon="cancel" title="{{removeText}}" on-click="_cancelUpload" hidden$="{{item.complete}}"></iron-icon>
                <iron-icon icon="check-circle" title="{{successText}}" hidden$="{{!item.complete}}"></iron-icon>
              </div>
            </div>
            <div class="error" hidden$="{{!item.error}}">{{errorText}}</div>
            <div hidden$="{{item.complete}}">
              <paper-progress value$="{{item.progress}}" indeterminate="" error$="{{item.error}}"></paper-progress>
            </div>
          </div>
        </template>
      </div>
    </div>
    <input type="file" id="fileInput" on-change="_fileChange" hidden="" multiple="{{multi}}">
    
  </template>

</dom-module>

<script>Polymer({is:"file-upload",properties:{target:{type:String,value:""},progressHidden:{type:Boolean,value:!1},droppable:{type:Boolean,value:!1},dropText:{type:String,value:"Drop Files Here"},multi:{type:Boolean,value:!1},files:{type:Array,value:function(){return[]}},method:{type:String,value:"PUT"},raised:{type:Boolean,value:!1},noink:{type:Boolean,value:!1},headers:{type:Object,value:{}},retryText:{type:String,value:"Retry Upload"},removeText:{type:String,value:"Remove"},successText:{type:String,value:"Success"},errorText:{type:String,value:"Error uploading file..."},_shownDropText:{type:Boolean,value:!1}},clear:function(){this.set("files",[]),this._showDropText()},ready:function(){this.raised&&this.toggleAttribute("raised",!0,this.$.button),this.noink&&this.toggleAttribute("noink",!0,this.$.button),this.droppable&&(this._showDropText(),this.setupDrop())},setupDrop:function(){var e=this.$.UploadBorder;this.toggleClass("enabled",!0,e),this.ondragover=function(t){return t.stopPropagation(),this.toggleClass("hover",!0,e),!1},this.ondragleave=function(){return this.toggleClass("hover",!1,e),!1},this.ondrop=function(t){this.toggleClass("hover",!1,e),t.preventDefault();for(var r=t.dataTransfer.files.length,o=0;o<r;o++){var s=t.dataTransfer.files[o];s.progress=0,s.error=!1,s.complete=!1,this.push("files",s),this.uploadFile(s)}}},_fileClick:function(){var e=this.$.fileInput;if(e&&document.createEvent){var t=document.createEvent("MouseEvents");t.initEvent("click",!0,!1),e.dispatchEvent(t)}},_fileChange:function(e){for(var t=e.target.files.length,r=0;r<t;r++){var o=e.target.files[r];o.progress=0,o.error=!1,o.complete=!1,this.push("files",o),this.uploadFile(o)}},cancel:function(e){e&&e.xhr&&(e.xhr.abort(),this.splice("files",this.files.indexOf(e),1),this._showDropText())},_cancelUpload:function(e){this.cancel(e.model.__data__.item)},_retryUpload:function(e){e.model.set("item.error",!1),e.model.set("item.progress",0);var t=this;this.async(function(){t.uploadFile(e.model.__data__.item)},50)},_showDropText:function(){this.set("_shownDropText",!this.files.length&&this.droppable)},uploadFile:function(e){if(e){this.fire("file-upload-starting"),this._showDropText();var t="files."+this.files.indexOf(e),r=this,o=new FormData;o.append("file",e,e.name);var s=e.xhr=new XMLHttpRequest;s.upload.onprogress=function(e){var o=e.loaded,s=e.total;r.set(t+".progress",Math.floor(o/s*1e3)/10)};var i=this.target.replace("<name>",e.name);s.open(this.method,i,!0);for(key in this.headers)this.headers.hasOwnProperty(key)&&s.setRequestHeader(key,this.headers[key]);s.onload=function(e){r.fire("file-upload-complete"),200===s.status?(r.fire("success",{xhr:s}),r.set(t+".complete",!0)):(r.set(t+".error",!0),r.set(t+".complete",!1),r.set(t+".progress",100),r.updateStyles(),r.fire("error",{xhr:s}))},s.send(o)}}});</script>
</body></html>