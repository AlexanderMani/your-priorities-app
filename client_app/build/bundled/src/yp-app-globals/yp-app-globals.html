<html><head><link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">

<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-toast/paper-toast.html">

<link rel="import" href="../yp-behaviors/app-helpers.html">

<link rel="import" href="../yp-session/yp-session.html">
<link rel="import" href="../yp-ajax/yp-ajax.html">

</head><body><dom-module id="yp-app-globals">

  <template>
    <style include="iron-flex iron-flex-alignment">
    </style>

    <yp-session id="session"></yp-session>

    <yp-ajax id="boot" url="/api/domains" on-response="_bootResponse"></yp-ajax>
    <iron-signals on-iron-signal-logged-in="_userLoggedIn"></iron-signals>
  </template>

  <script>!function(){Polymer({is:"yp-app-globals",behaviors:[Polymer.appHelpers],properties:{dialogHeading:{type:String,value:""},seenWelcome:{type:Boolean,value:!1,notify:!0},activityHost:{type:String,value:""},resetSeenWelcome:{type:Boolean,value:!1},disableWelcome:{type:Boolean,value:!0},setupDefaults:{type:Boolean,value:!1},domain:{type:Object},minSplashMs:{type:Number,value:1500},requestInProgress:{type:Boolean,value:!1}},notifyUserViaToast:function(e){var t=Polymer.dom(document).querySelector("yp-app").getDialog("masterToast");t.text=e,t.show()},reBoot:function(){this.requestInProgress||this.$.boot.generateRequest()},_removeSplashNode:function(e){e&&(e.parentNode.removeChild(e),document.body.classList.remove("loading"))},_removeSplash:function(){this._removeSplashNode(document.getElementById("splashCore"))},_removeSplashWithDelay:function(){var e=new Date-window.appStartTime;console.log("Difference: "+e),e<this.minSplashMs?(e=this.minSplashMs-e,console.log("Wait: "+e),Polymer.Base.async(function(){this._removeSplash()}.bind(this),e)):this._removeSplash()},setupGoogleAnalytics:function(e){e.public_api_keys&&e.public_api_keys&&e.public_api_keys.google&&e.public_api_keys.google.analytics_tracking_id&&ga("create",e.public_api_keys.google.analytics_tracking_id,"auto")},_userLoggedIn:function(e,t){this.async(function(){ga("set","&uid",t.id)},250)},_bootResponse:function(e,t){this.set("requestInProgress",!1),this.set("domain",t.response.domain),this.setupGoogleAnalytics(this.domain),"/"==window.location.pathname&&(t.response.community?this.redirectTo("/community/"+t.response.community.id):(this.redirectTo("/domain/"+this.domain.id),this.fire("change-header",{headerTitle:this.domain.domain_name,headerDescription:this.domain.description}))),this._removeSplashWithDelay()},activity:function(e,t,o){var i;i=window.appUser&&window.appUser.user?window.appUser.user.id:"-1";var s="activity stream: "+i+" "+e+" "+t;console.log(s),o&&(s+=" "+o),this.sendToGoogleAnalytics("send","event",t,e);var n=document.createElement("iron-ajax"),a=new Date;n.handleAs="json",n.contentType="application/x-www-form-urlencoded",n.url="/api/users/createActivityFromApp",n.method="POST",n.body={actor:i,type:e,object:t,context:o?o:"",path_name:location.pathname,event_time:a.toISOString(),session_id:this.getSessionFromCookie(),user_agent:navigator.userAgent},n.generateRequest()},ready:function(){window.appStartTime=new Date,window.appGlobals=this,window.googleMapsApiKey=null,window.instagramAccessToken="3066250812.cf0499d.4d1d4db0bb8b43b59c057346511161c8",window.instagramClientID="d2f248ec764d4b208ab668b7561a89cc",this.requestInProgress=!0,this.fire("app-ready"),this.$.boot.generateRequest(),this.disableWelcome?localStorage.setItem("yrpri-welcome-status",!0):this.resetSeenWelcome&&localStorage.setItem("yrpri-welcome-status",!1),this.activity("open","page",window.location.href),this.seenWelcome="true"==localStorage.getItem("yrpri-welcome-status"),this.seenWelcome||this.$.welcomeDialog.open()},setSeenWelcome:function(){this.seenWelcome=!0,localStorage.setItem("yrpri-welcome-status",!0)},getSessionFromCookie:function(){for(var e=document.cookie,t=e.split(";"),o="",i=0;i<t.length;i++){name=t[i].split("=")[0];var s=t[i].split("=")[1];" connect.sid"==name&&(o=s)}return o},sendToGoogleAnalytics:function(e,t,o,i){"function"==typeof ga?o&&i?ga(e,t,o,i):ga(e,t):console.warn("Google analytics message not sent for a:"+e+" b:"+t+" c:"+o+" d:"+i)},computeHeading:function(){return this.t("")}})}();</script>
</dom-module>
</body></html>