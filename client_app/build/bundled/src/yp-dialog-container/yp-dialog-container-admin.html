<html><head><meta charset="UTF-8"><link rel="import" href="../yp-app/yp-app.html?v=6.3.184"></head><body><div hidden="" by-vulcanize=""><dom-module id="yp-category-edit" assetpath="../yp-category/">
  <template>

    <style include="iron-flex iron-flex-alignment">
    </style>
    <iron-signals on-iron-signal-yp-language="_languageEvent"></iron-signals>

    <yp-edit-dialog id="editDialog" icon="add" action="[[action]]" method="[[method]]" params="[[params]]" save-text="[[saveText]]" toast-text="[[toastText]]">
      <h2>[[editHeaderText]]</h2>

      <paper-input id="name" name="name" type="text" label="[[t('Name')]]" value="{{category.name}}" maxlength="60" char-counter="">
      </paper-input>

      <paper-textarea id="description" name="description" value="{{category.description}}" label="[[t('Description')]]" char-counter="" rows="2" max-rows="5" maxlength="300">
      </paper-textarea>

      <div class="layout vertical additionalSettings">
        <file-upload id="iconImageUpload" droppable="true" raised="true" multi="false" target="/api/images?itemType=category-icon" method="POST" on-success="_iconImageUploaded">
          <iron-icon class="icon" icon="image:photo-camera"></iron-icon>
          <span>[[t('image.icon.upload')]]</span>
        </file-upload>
      </div>

      <div class="layout vertical additionalSettings" hidden="">
        <file-upload id="headerImageUpload" droppable="true" raised="true" multi="false" target="/api/images?itemType=category-header" method="POST" on-success="_headerImageUploaded">
          <iron-icon class="icon" icon="image:photo-camera"></iron-icon>
          <span>[[t('image.header.upload')]]</span>
        </file-upload>
      </div>

      <input type="hidden" name="uploadedIconImageId" value="[[uploadedIconImageId]]">
      <input type="hidden" name="uploadedHeaderImageId" value="[[uploadedHeaderImageId]]">

    </yp-edit-dialog>
  </template>

</dom-module>

<script>

  Polymer({

    is: 'yp-category-edit',

    behaviors: [
      Polymer.appHelpers,
      Polymer.ypEditDialogBehavior
    ],

    properties: {

      action: {
        type: String,
        value: "/api/categories"
      },

      category: {
        type: Object
      },

      group: {
        type: Object
      },

      categoryAccess: {
        type: String
      },

      params: {
        type: String
      },

      method: {
        type: String
      },

      uploadedIconImageId: {
        type: String
      },

      uploadedHeaderImageId: {
        type: String
      }
    },

    _iconImageUploaded: function (event, detail) {
      var image = JSON.parse(detail.xhr.response);
      this.set('uploadedIconImageId', image.id);
    },

    _headerImageUploaded: function (event, detail) {
      var image = JSON.parse(detail.xhr.response);
      this.set('uploadedHeaderImageId', image.id);
    },

    setup: function (group, newNotEdit, refreshFunction, category) {
      this.set('group', group);
      this.set('new', newNotEdit);
      this.set('refreshFunction', refreshFunction);
      if (category) {
        this.set('category', category);
      }
      this._setupTranslation();
      this._setupNewUpdateState();
    },

    _clear: function () {
      this.category = { name: '', description: '' };
      this.uploadedIconImageId = null;
      this.uploadedHeaderImageId = null;
      this.$.headerImageUpload.clear();
      this.$.iconImageUpload.clear();
    },

    _setupTranslation: function () {
      if (this.new) {
        this.editHeaderText = this.t('New category');
        this.toastText = this.t('category.toast.created');
      } else {
        this.editHeaderText = this.t('Update category info');
        this.toastText = this.t('category.toast.updated');
      }
    }
  });
</script>
<dom-module id="yp-users-grid" assetpath="../yp-user/">
  <template>
    <style include="iron-flex iron-flex-alignment">
      #dialog {
        width: 800px;
        background-color: #FFF;
      }

      iron-list {
        color: #000;
        height: 500px;
        width: 100%;
      }

      .userItem {
        padding-right: 16px;
      }

      .id {
        width: 40px;
      }

      .name {
        width: 200px;
      }

      .email {
        width: 190px;
      }

      .organization {
        width: 150px;
      }

      .addRemoveButtons {
        width: 150px;
      }

      #selectOrganizationDialog {
        background-color: #FFF;

      }
    </style>
    <iron-signals on-iron-signal-yp-language="_languageEvent"></iron-signals>

    <paper-dialog id="selectOrganizationDialog" modal="">
      <h2>[[t('users.selectOrganization')]]</h2>
      <paper-dialog-scrollable>
        <paper-menu>
          <template is="dom-repeat" items="[[availableOrganizations]]">
            <paper-item on-tap="_selectOrganization" id="[[item.id]]">[[item.name]]</paper-item>
          </template>
        </paper-menu>
      </paper-dialog-scrollable>

      <div class="buttons">
        <paper-button dialog-dismiss="">[[t('Close')]]</paper-button>
      </div>
    </paper-dialog>

    <paper-dialog id="dialog">
      <h2>[[headerText]]</h2>
      <paper-dialog-scrollable>
        <iron-list items="[[users]]" as="user">
          <template>
            <div class="layout horizontal">
              <div class="userItem id">
                [[user.id]]
              </div>
              <div class="userItem name">
                [[user.name]]
              </div>
              <div class="userItem email">
                [[user.email]]
              </div>
              <template is="dom-if" if="[[!_userOrganizationName(user)]]">
                <div class="organization">
                  <paper-button data-args$="[[user.id]]" on-tap="_addToOrganization">[[t('users.addToOrganization')]]</paper-button>
                </div>
              </template>
              <div class="organization" hidden$="[[!_userOrganizationName(user)]]">
                <div class="organizationName">
                  [[_userOrganizationName(user)]]
                </div>
                <paper-button data-args$="[[user.id]]" data-args-org$="[[_userOrganizationId(user)]]" on-tap="_removeFromOrganization">[[t('users.removeFromOrganization')]]</paper-button>
              </div>
              <div hidden$="[[!adminUsers]]" class="addRemoveButtons">
                <paper-button data-args$="[[user.id]]" on-tap="_removeAdmin">[[t('users.removeAdmin')]]</paper-button>
              </div>
              <div hidden$="[[adminUsers]]">
                <paper-button data-args$="[[user.id]]" on-tap="_removeUser">[[t('users.removeUser')]]</paper-button>
              </div>
            </div>
          </template>
        </iron-list>
      </paper-dialog-scrollable>
      <div hidden$="[[!adminUsers]]" class="layout horizontal">
        <paper-input label="[[t('users.email')]]" value="{{addAdminEmail}}"></paper-input>
        <paper-button on-tap="_addAdmin">[[t('users.addAdmin')]]</paper-button>
      </div>
      <div hidden$="[[adminUsers]]" class="layout horizontal">
        <paper-input label="[[t('users.email')]]" value="{{inviteUserEmail}}"></paper-input>
        <paper-button on-tap="_inviteUser">[[t('users.inviteUser')]]</paper-button>
      </div>

      <div class="buttons">
        <paper-button dialog-dismiss="">[[t('close')]]</paper-button>
      </div>
    </paper-dialog>

    <div class="layout horizontal center-center">
      <yp-ajax id="ajax" on-response="_usersResponse"></yp-ajax>
      <yp-ajax method="DELETE" id="removeAdminAjax" on-response="_removeAdminResponse"></yp-ajax>
      <yp-ajax method="DELETE" id="removeUserAjax" on-response="_removeUserResponse"></yp-ajax>
      <yp-ajax method="DELETE" id="removeOrganizationAjax" on-response="_removeOrganizationResponse"></yp-ajax>
      <yp-ajax method="POST" id="inviteUserAjax" on-response="_inviteUserResponse"></yp-ajax>
      <yp-ajax method="POST" id="addAdminAjax" on-response="_addAdminResponse"></yp-ajax>
      <yp-ajax method="POST" id="addOrganizationAjax" on-response="_addOrganizationResponse"></yp-ajax>
    </div>

  </template>

  <script>
    Polymer({

      is: 'yp-users-grid',

      behaviors: [
        Polymer.appHelpers
      ],

      properties: {

        addAdminEmail: {
          type: String
        },

        inviteUserEmail: {
          type: String
        },

        users: {
          type: Array,
          notify: true
        },

        headerText: {
          type: String
        },

        groupId: {
          type: Number,
          observer: '_groupIdChanged'
        },

        domainId: {
          type: Number,
          observer: '_domainIdChanged'
        },

        communityId: {
          type: Number,
          observer: '_communityIdChanged'
        },

        adminUsers: {
          type: Boolean,
          value: false
        },

        selected: {
          type: Object
        },

        modelType: {
          type: String
        },

        opened: {
          type: Boolean,
          value: false
        },

        availableOrganizations: {
          type: Array
        },

        userIdForSelectingOrganization: Number
      },

      _userOrganizationId: function (user) {
        if (user && user.OrganizationUsers && user.OrganizationUsers.length>0) {
          return user.OrganizationUsers[0].id;
        } else {
          return null;
        }
      },

      _userOrganizationName: function (user) {
        if (user && user.OrganizationUsers && user.OrganizationUsers.length>0) {
          return user.OrganizationUsers[0].name;
        } else {
          return null;
        }
      },

      _availableOrganizations: function () {
        if (window.appUser.adminRights && window.appUser.adminRights.OrganizationAdmins) {
          return  window.appUser.adminRights.OrganizationAdmins;
        } else {
          return [];
        }
      },

      _addToOrganization: function (event) {
        this.set('userIdForSelectingOrganization', event.target.getAttribute('data-args'));
        this.set('availableOrganizations', this._availableOrganizations());
        this.$.selectOrganizationDialog.open();
      },

      _removeFromOrganization: function (event) {
        var userId = event.target.getAttribute('data-args');
        var organizationId = event.target.getAttribute('data-args-org');
        this.$.removeOrganizationAjax.body = {};
        this.$.removeOrganizationAjax.url = "/api/organizations/" + organizationId + "/" + userId + "/remove_user";
        this.$.removeOrganizationAjax.generateRequest();
      },

      _selectOrganization: function (event, detail) {
        this.$.addOrganizationAjax.body = {};
        this.$.addOrganizationAjax.url = "/api/organizations/" + event.target.id + "/" + this.userIdForSelectingOrganization + "/add_user";
        this.$.addOrganizationAjax.generateRequest();
        this.$.selectOrganizationDialog.close();
      },

      _removeAdmin: function (event) {
        var userId = event.target.getAttribute('data-args');
        this.$.removeAdminAjax.body = {};
        if (this.modelType=="groups" && this.groupId) {
          this.$.removeAdminAjax.url = "/api/" + this.modelType + "/" + this.groupId + "/" + userId + "/remove_admin";
          this.$.removeAdminAjax.generateRequest();
        } else if (this.modelType=="communities" && this.communityId) {
          this.$.removeAdminAjax.url = "/api/" + this.modelType + "/" + this.communityId + "/" + userId + "/remove_admin";
          this.$.removeAdminAjax.generateRequest();
        } else {
          console.warn("Can't find model type or ids");
        }
      },

      _removeUser: function (event) {
        var userId = event.target.getAttribute('data-args');
        this.$.removeUserAjax.body = {};
        if (this.modelType=="groups" && this.groupId) {
          this.$.removeUserAjax.url = "/api/" + this.modelType + "/" + this.groupId + "/" + userId + "/remove_user";
          this.$.removeUserAjax.generateRequest();
        } else if (this.modelType=="communities" && this.communityId) {
          this.$.removeUserAjax.url = "/api/" + this.modelType + "/" + this.communityId + "/" + userId + "/remove_user";
          this.$.removeUserAjax.generateRequest();
        } else {
          console.warn("Can't find model type or ids");
        }
      },

      _addAdmin: function (event) {
        this.$.addAdminAjax.body = {};
        if (this.modelType=="groups" && this.groupId) {
          this.$.addAdminAjax.url = "/api/" + this.modelType + "/" + this.groupId + "/" + this.addAdminEmail + "/add_admin";
          this.$.addAdminAjax.generateRequest();
        } else if (this.modelType=="communities" && this.communityId) {
          this.$.addAdminAjax.url = "/api/" + this.modelType + "/" + this.communityId + "/" + this.addAdminEmail + "/add_admin";
          this.$.addAdminAjax.generateRequest();
        } else {
          console.warn("Can't find model type or ids");
        }
      },

      _inviteUser: function (event) {
        this.$.inviteUserAjax.body = {};
        if (this.modelType=="groups" && this.groupId) {
          this.$.inviteUserAjax.url = "/api/" + this.modelType + "/" + this.groupId + "/" + this.inviteUserEmail + "/invite_user";
          this.$.inviteUserAjax.generateRequest();
        } else if (this.modelType=="communities" && this.communityId) {
          this.$.inviteUserAjax.url = "/api/" + this.modelType + "/" + this.communityId + "/" + this.inviteUserEmail + "/invite_user";
          this.$.inviteUserAjax.generateRequest();
        } else {
          console.warn("Can't find model type or ids");
        }
      },

      _removeAdminResponse: function () {
        window.appGlobals.notifyUserViaToast(this.t('users.adminRemoved'));
        this.$.ajax.generateRequest();
      },

      _removeUserResponse: function () {
        window.appGlobals.notifyUserViaToast(this.t('users.userRemoved'));
        this.$.ajax.generateRequest();
      },

      _addAdminResponse: function () {
        window.appGlobals.notifyUserViaToast(this.t('users.adminAdded')+' '+this.addAdminEmail);
        this.set('addAdminEmail', null);
        this.$.ajax.generateRequest();
      },

      _addOrganizationResponse: function (event, detail) {
        window.appGlobals.notifyUserViaToast(this.t('users.organizationUserAdded')+' '+ detail.response.email);
        this.$.ajax.generateRequest();
      },

      _removeOrganizationResponse: function (event, detail) {
        window.appGlobals.notifyUserViaToast(this.t('users.organizationUserRemoved')+' '+ detail.response.email);
        this.$.ajax.generateRequest();
      },

      _inviteUserResponse: function () {
        window.appGlobals.notifyUserViaToast(this.t('users.userInvited')+' '+this.inviteUserEmail);
        this.set('inviteUserEmail', null);
        this.$.ajax.generateRequest();
      },

      _domainIdChanged: function (newGroupId) {
        if (newGroupId) {
          this.set('modelType', 'domains');
          this._generateRequest(newGroupId);
        }
      },

      _groupIdChanged: function (newGroupId) {
        if (newGroupId) {
          this.set('modelType', 'groups');
          this._generateRequest(newGroupId);
        }
      },

      _communityIdChanged: function (newCommunityId) {
        if (newCommunityId) {
          this.set('modelType', 'communities');
          this._generateRequest(newCommunityId);
        }
      },

      _generateRequest: function (id) {
        var adminsOrUsers = this.adminUsers ? "admin_users" : "users";
        this.$.ajax.url = "/api/"+this.modelType+"/"+id+"/"+adminsOrUsers;
        this.$.ajax.generateRequest();
      },

      _usersResponse: function (event, detail) {
        this.set('users', detail.response);
      //  debugger;
      },

      setup: function (groupId, communityId, domainId, adminUsers) {
        this.set('groupId', null);
        this.set('communityId', null);
        this.set('domainId', null);
        this.set('users', null);
        this.set('adminUsers', adminUsers);

        if (groupId)
          this.set('groupId', groupId);

        if (communityId)
          this.set('communityId', communityId);

        if (domainId)
          this.set('domainId', domainId);

        this._setupHeaderText();
      },

      open: function () {
        this.set('opened', true);
        this.$.dialog.open();
      },

      _setupHeaderText: function () {
        if (this.groupId) {
          if (this.adminUsers) {
            this.set('headerText', this.t('group.admins'));
          } else {
            this.set('headerText', this.t('group.users'));
          }
        } else if (this.communityId) {
          if (this.adminUsers) {
            this.set('headerText', this.t('community.admins'));
          } else {
            this.set('headerText', this.t('community.users'));
          }
        } else if (this.domainId) {
          if (this.adminUsers) {
            this.set('headerText', this.t('domain.admins'));
          } else {
            this.set('headerText', this.t('domain.users'));
          }
        }
      },

      ready2: function () {
        /*
        this.$.grid.columns[5].renderer = this._adminActionRenderer;

        var filterElement = document.createElement('input');
        filterElement.setAttribute('type', 'search');
        filterElement.setAttribute('placeholder', 'Filter...');
        filterElement.style.width = '100%';

        var timer = 0;

        function filter() {
          clearTimeout(timer);
          timer = setTimeout(grid.refreshItems.bind(grid), 500);
        }

        filterElement.addEventListener('keyup', filter);
        filterElement.addEventListener('click', filter);

        this.$.grid.items = function(params, callback) {
          var filterValue = filterElement.value.toLowerCase();
          var data = this.users.filter(function(val) {
            return (val.toString().toLowerCase()).indexOf(filterValue) != -1;
          });
          var slice = data.slice(params.index, params.index + params.count);
          callback(slice, data.length);
        };

        this.$.grid.then(function() {
          this.$.grid.header.getCell(1, 0).content = filterElement;
        }.bind(this));
        */
      },

      _adminActionRenderer: function(cell) {
        cell.element.innerHTML = '';
        var child = document.createElement('progress');
        child.setAttribute('value', cell.data);
        cell.element.appendChild(child);
      },

      _onSelect: function() {
        if (this.$.grid.selection.selected().length === 0) {
          this.selected = null;
        } else {
          this.selected = this.users[this.$.grid.selection.selected()];
        }
      }
    });
  </script>
</dom-module>
<dom-module id="yp-pages-grid" assetpath="../yp-page/">
  <template>
    <style include="iron-flex iron-flex-alignment">
      #dialog {
        width: 90%;
        max-height: 90%;
        background-color: #FFF;
      }

      iron-list {
        color: #000;
        height: 500px;
        width: 100%;
      }

      .pageItem {
        padding-right: 16px;
      }

      .id {
        width: 60px;
      }

      .title {
        width: 200px;
      }

      .email {
        width: 240px;
      }

      #editPageLocale {
        width: 80%;
        max-height: 80%;
        background-color: #FFF;
      }

      .locale {
        width: 30px;
        cursor: pointer;
      }

      paper-textarea {
        height: 60%;
      }

      .localeInput {
        width: 26px;
      }

      .pageItem {
        padding-top: 8px;
      }
    </style>
    <iron-signals on-iron-signal-yp-language="_languageEvent"></iron-signals>

    <paper-dialog id="editPageLocale" modal="" class="layout vertical">
      <h2>[[t('page.editPageLocale')]]</h2>

      <paper-dialog-scrollable>
        <paper-input id="title" name="title" type="text" label="[[t('pages.title')]]" value="{{currentlyEditingTitle}}" maxlength="60" char-counter="" class="mainInput">
        </paper-input>

        <paper-textarea id="content" name="content" value="{{currentlyEditingContent}}" label="[[t('pages.content')]]" rows="7" max-rows="10">
        </paper-textarea>
      </paper-dialog-scrollable>


      <div class="buttons">
        <paper-button on-tap="_closePageLocale" dialog-dismiss="">[[t('close')]]</paper-button>
        <paper-button on-tap="_updatePageLocale" dialog-dismiss="">[[t('save')]]</paper-button>
      </div>
    </paper-dialog>

    <paper-dialog id="dialog">
      <h2>[[headerText]]</h2>
      <iron-list items="[[pages]]" as="page">
        <template>
          <div class="layout horizontal">
            <div class="pageItem id">
              [[page.id]]
            </div>
            <div class="pageItem title">
              [[page.title.en]]
            </div>
            <template is="dom-repeat" items="[[_toLocaleArray(page.title)]]" class="pageItem">
              <div class="layout vertical center-center">
                <a class="locale" data-args-page$="[[page]]" data-args-locale$="[[item.locale]]" on-tap="_editPageLocale">[[item.locale]]</a>
              </div>
            </template>
            <paper-input no-label-float="" class="localeInput" length="2" maxlength="2" value="{{newLocaleValue}}"></paper-input>
            <paper-button data-args$="[[page.id]]" on-tap="_addLocale">[[t('pages.addLocale')]]</paper-button>
            <div hidden$="[[page.published]]">
              <paper-button data-args$="[[page.id]]" on-tap="_publishPage">[[t('pages.publish')]]</paper-button>
            </div>
            <div hidden$="[[!page.published]]">
              <paper-button data-args$="[[page.id]]" on-tap="_unPublishPage">[[t('pages.unPublish')]]</paper-button>
            </div>
            <paper-button data-args$="[[page.id]]" on-tap="_deletePage">[[t('pages.deletePage')]]</paper-button>
          </div>
        </template>
      </iron-list>
      <div class="layout horizontal">
        <paper-button id="addPageButton" on-tap="_addPage">[[t('pages.addPage')]]</paper-button>
      </div>

      <div class="buttons">
        <paper-button dialog-dismiss="">[[t('close')]]</paper-button>
      </div>
    </paper-dialog>

    <div class="layout horizontal center-center">
      <yp-ajax id="ajax" on-response="_pagesResponse"></yp-ajax>
      <yp-ajax method="POST" id="newPageAjax" on-response="_newPageResponse"></yp-ajax>
      <yp-ajax method="DELETE" id="deletePageAjax" on-response="_deletePageResponse"></yp-ajax>
      <yp-ajax method="PUT" id="updatePageAjax" on-response="_updatePageResponse"></yp-ajax>
      <yp-ajax method="PUT" id="publishPageAjax" on-response="_publishPageResponse"></yp-ajax>
      <yp-ajax method="PUT" id="unPublishPageAjax" on-response="_unPublishPageResponse"></yp-ajax>
    </div>

  </template>

  <script>
    Polymer({

      is: 'yp-pages-grid',

      behaviors: [
        Polymer.appHelpers,
        Polymer.WordWrap
      ],

      properties: {
        pages: {
          type: Array,
          notify: true
        },

        headerText: {
          type: String
        },

        groupId: {
          type: Number,
          observer: '_groupIdChanged'
        },

        domainId: {
          type: Number,
          observer: '_domainIdChanged'
        },

        communityId: {
          type: Number,
          observer: '_communityIdChanged'
        },

        selected: {
          type: Object
        },

        modelType: {
          type: String
        },

        newLocaleValue: {
          type: String
        },

        currentlyEditingLocale: {
          type: String
        },

        currentlyEditingPage: {
          type: Object
        },

        currentlyEditingTitle: {
          type: String
        },

        currentlyEditingContent: {
          type: String
        }
      },

      _toLocaleArray: function(obj) {
        var array = Object.keys(obj).map(function(key) {
          return {
            locale: key,
            value: obj[key]
          };
        });

        return __.sortBy(array, function(o) { return o.item; });
      },

      _editPageLocale: function (event) {
        this.set('currentlyEditingPage', JSON.parse(event.target.getAttribute('data-args-page')));
        this.set('currentlyEditingLocale', event.target.getAttribute('data-args-locale'));
        this.set('currentlyEditingContent',this.wordwrap(120)(this.currentlyEditingPage["content"][this.currentlyEditingLocale]));
        this.set('currentlyEditingTitle',this.currentlyEditingPage["title"][this.currentlyEditingLocale]);
        this.$.editPageLocale.open();
      },

      _closePageLocale: function () {
        this.set('currentlyEditingPage', null);
        this.set('currentlyEditingLocale', null);
        this.set('currentlyEditingContent', null);
        this.set('currentlyEditingTitle', null);
      },

      _dispatchAjax: function(ajax, pageId, path) {
        var pageIdPath;
        if (pageId) {
          pageIdPath = "/" + pageId + "/" + path;
        } else {
          pageIdPath = "/" + path;
        }
        if (this.modelType=="groups" && this.groupId) {
          ajax.url = "/api/" + this.modelType + "/" + this.groupId + pageIdPath;
          ajax.generateRequest();
        } else if (this.modelType=="communities" && this.communityId) {
          ajax.url = "/api/" + this.modelType + "/" + this.communityId +  pageIdPath;
          ajax.generateRequest();
        } else if (this.modelType=="domains" && this.domainId) {
          ajax.url = "/api/" + this.modelType + "/" + this.domainId + pageIdPath;
          ajax.generateRequest();
        } else {
          console.warn("Can't find model type or ids");
        }
      },

      _updatePageLocale: function () {
        this.$.updatePageAjax.body = {
          locale: this.currentlyEditingLocale,
          content: this.currentlyEditingContent,
          title: this.currentlyEditingTitle
        };
        this._dispatchAjax(this.$.updatePageAjax, this.currentlyEditingPage.id, "update_page_locale")
        this._closePageLocale();
      },

      _publishPage: function () {
        this.$.updatePageAjax.body = {};
        var pageId = event.target.getAttribute('data-args');
        this._dispatchAjax(this.$.updatePageAjax, pageId, "publish_page")
      },

      _publishPageResponse: function () {
        window.appGlobals.notifyUserViaToast(this.t('pages.pagePublished'));
        this.$.ajax.generateRequest();
      },

      _unPublishPage: function () {
        this.$.updatePageAjax.body = {};
        var pageId = event.target.getAttribute('data-args');
        this._dispatchAjax(this.$.updatePageAjax, pageId, "un_publish_page")
      },

      _unPublishPageResponse: function () {
        window.appGlobals.notifyUserViaToast(this.t('pages.pageUnPublished'));
        this.$.ajax.generateRequest();
      },

      _deletePage: function () {
        this.$.deletePageAjax.body = {};
        var pageId = event.target.getAttribute('data-args');
        this._dispatchAjax(this.$.deletePageAjax, pageId, "delete_page")
      },

      _deletePageResponse: function () {
        window.appGlobals.notifyUserViaToast(this.t('pages.pageDeleted'));
        this.$.ajax.generateRequest();
      },

      _addLocale: function (event) {
        if (this.newLocaleValue && this.newLocaleValue.length>1) {
          var pageId = event.target.getAttribute('data-args');
          this.$.updatePageAjax.body = {
            locale: this.newLocaleValue.toLowerCase(),
            content: '',
            title: ''
          };
          this._dispatchAjax(this.$.updatePageAjax, pageId, "update_page_locale")
          this.set('newLocaleValue', null);
        }
      },

      _addPage: function (event) {
        this.$.newPageAjax.body = {};
        this.$.addPageButton.disabled = true;
        this._dispatchAjax(this.$.newPageAjax, null, "add_page")
      },

      _newPageResponse: function () {
        window.appGlobals.notifyUserViaToast(this.t('pages.newPageCreated'));
        this.$.ajax.generateRequest();
        this.$.addPageButton.disabled = false;
      },

      _updatePageResponse: function () {
        window.appGlobals.notifyUserViaToast(this.t('posts.updated'));
        this.$.ajax.generateRequest();
      },

      _domainIdChanged: function (newGroupId) {
        if (newGroupId) {
          this.set('modelType', 'domains');
          this._generateRequest(newGroupId);
        }
      },

      _groupIdChanged: function (newGroupId) {
        if (newGroupId) {
          this.set('modelType', 'groups');
          this._generateRequest(newGroupId);
        }
      },

      _communityIdChanged: function (newCommunityId) {
        if (newCommunityId) {
          this.set('modelType', 'communities');
          this._generateRequest(newCommunityId);
        }
      },

      _generateRequest: function (id) {
        this.$.ajax.url = "/api/"+this.modelType+"/"+id+"/pages_for_admin";
        this.$.ajax.generateRequest();
      },

      _pagesResponse: function (event, detail) {
        this.set('pages', detail.response);
      },

      setup: function (groupId, communityId, domainId, adminUsers) {
        this.set('groupId', null);
        this.set('communityId', null);
        this.set('domainId', null);
        this.set('pages', null);

        if (groupId)
          this.set('groupId', groupId);

        if (communityId)
          this.set('communityId', communityId);

        if (domainId)
          this.set('domainId', domainId);

        this._setupHeaderText();
      },

      open: function () {
        this.$.dialog.open();
      },

      _setupHeaderText: function () {
        if (this.groupId) {
          this.set('headerText', this.t('group.pages'));
        } else if (this.communityId) {
          this.set('headerText', this.t('community.pages'));
        } else if (this.domainId) {
          this.set('headerText', this.t('domain.pages'));
        }
      }
    });
  </script>
</dom-module>
<dom-module id="yp-organization-edit" assetpath="../yp-organization/">
  <template>

    <style include="iron-flex iron-flex-alignment">
      .access {
        @apply(--layout-horizontal);
        @apply(--layout-center-justified);
      }

      .accessHeader {
        color: var(--primary-color,#777);
        font-weight: normal;
        margin-bottom: 0;
      }

      paper-radio-button {
        display: block;
      }

      .additionalSettings {
        padding-top: 16px;
      }

      .half {
        width: 50%;
      }
    </style>
    <iron-signals on-iron-signal-yp-language="_languageEvent"></iron-signals>

    <yp-edit-dialog id="editDialog" icon="places:business-center" action="[[action]]" method="[[method]]" params="[[params]]" save-text="[[saveText]]" toast-text="[[toastText]]">
      <h2>[[editHeaderText]]</h2>

      <div class="layout vertical">
        <paper-input id="name" name="name" type="text" label="[[t('name')]]" value="{{organization.name}}" maxlength="60" char-counter="" class="mainInput">
        </paper-input>

        <paper-textarea id="description" name="description" value="{{organization.description}}" label="[[t('description')]]" char-counter="" rows="2" max-rows="5" maxlength="300" class="mainInput">
        </paper-textarea>

        <paper-input id="website" name="website" type="text" label="[[t('website')]]" value="{{organization.website}}" maxlength="256" char-counter="" class="mainInput">
        </paper-input>
      </div>

      <div class="layout horizontal">
        <div class="layout vertical additionalSettings half">
          <file-upload id="logoImageUpload" raised="true" multi="false" target="/api/images?itemType=organization-logo" method="POST" on-success="_logoImageUploaded">
            <iron-icon class="icon" icon="image:photo-camera"></iron-icon>
            <span>[[t('image.logo.upload')]]</span>
          </file-upload>
        </div>

        <div class="layout vertical additionalSettings half">
          <file-upload id="headerImageUpload" raised="true" multi="false" target="/api/images?itemType=organization-header" method="POST" on-success="_headerImageUploaded">
            <iron-icon class="icon" icon="image:photo-camera"></iron-icon>
            <span>[[t('image.header.upload')]]</span>
          </file-upload>
        </div>
      </div>

      <input type="hidden" name="uploadedLogoImageId" value="[[uploadedLogoImageId]]">
      <input type="hidden" name="uploadedHeaderImageId" value="[[uploadedHeaderImageId]]">

      <h3 class="accessHeader">[[t('Access')]]</h3>
      <paper-radio-group id="access" name="access" class="access" selected="{{organizationAccess}}">
        <paper-radio-button name="public">[[t('public')]]</paper-radio-button>
        <paper-radio-button name="closed">[[t('closed')]]</paper-radio-button>
        <paper-radio-button name="secret">[[t('secret')]]</paper-radio-button>
      </paper-radio-group>

    </yp-edit-dialog>
  </template>

</dom-module>

<script>

  Polymer({

    is: 'yp-organization-edit',

    behaviors: [
      Polymer.appHelpers,
      Polymer.ypEditDialogBehavior
    ],

    properties: {

      action: {
        type: String,
        value: "/api/organizations"
      },

      organization: {
        type: Object,
        observer: "_organizationChanged"
      },

      organizationAccess: {
        type: String,
        value: "public"
      },

      params: {
        type: String
      },

      method: {
        type: String
      },

      uploadedLogoImageId: {
        type: String
      },

      uploadedHeaderImageId: {
        type: String
      }
    },

    _customRedirect: function (organization) {
      if (organization) {
       // this.redirectTo("/organization/"+organization.id);
      } else {
        console.warn('No organization found on custom redirect');
      }
    },

    _organizationChanged: function (newValue, oldValue) {
      if (this.organization.access===0) {
        this.organizationAccess = "public"
      } else if (this.organization.access===1) {
        this.organizationAccess = "closed"
      } else if (this.organization.access===2) {
        this.organizationAccess = "secret"
      }
    },

    _clear: function () {
      this.set('organization', { name: '', description: '', access: 0 });
      this.uploadedLogoImageId = null;
      this.uploadedHeaderImageId = null;
      this.$.headerImageUpload.clear();
      this.$.logoImageUpload.clear();
    },

    setup: function (organization, newNotEdit, refreshFunction) {
      if (!organization) {
        this.set('organization', { name: '', description: '', access: 0 });
      } else {
        this.set('organization', organization);
      }
      this.set('new', newNotEdit);
      this.set('refreshFunction', refreshFunction);
      this._setupTranslation();
    },

    _setupTranslation: function () {
      if (this.new) {
        this.set('editHeaderText', this.t('organization.new'));
        this.set('toastText', this.t('organization.toast.created'));
        this.set('saveText', this.t('create'));
      } else {
        this.set('editHeaderText', this.t('Update organization info'));
        this.set('toastText', this.t('organization.toast.updated'));
        this.set('saveText', this.t('update'));
      }
    }
  });
</script>
<dom-module id="yp-organizations-grid" assetpath="../yp-organization/">
  <template>
    <style include="iron-flex iron-flex-alignment">
      #dialog {
        width: 90%;
        max-height: 90%;
        background-color: #FFF;
      }

      iron-list {
        color: #000;
        height: 500px;
        width: 100%;
      }

      .pageItem {
        padding-right: 16px;
      }

      .id {
        width: 60px;
      }

      .title {
        width: 200px;
      }

      .email {
        width: 240px;
      }

      #editPageLocale {
        width: 80%;
        max-height: 80%;
        background-color: #FFF;
      }

      .locale {
        width: 30px;
        cursor: pointer;
      }

      paper-textarea {
        height: 60%;
      }

      .localeInput {
        width: 26px;
      }

      .pageItem {
        padding-top: 8px;
      }
    </style>
    <iron-signals on-iron-signal-yp-language="_languageEvent"></iron-signals>

    <paper-dialog id="selectOrganizationDialog" modal="">
      <h2>[[t('users.selectOrganization')]]</h2>
      <paper-dialog-scrollable>
        <paper-menu>
          <template is="dom-repeat" items="[[availableOrganizations]]">
            <paper-item on-tap="_selectOrganization" id="[[item.id]]">[[item.name]]</paper-item>
          </template>
        </paper-menu>
      </paper-dialog-scrollable>

      <div class="buttons">
        <paper-button dialog-dismiss="">[[t('Close')]]</paper-button>
      </div>
    </paper-dialog>

    <paper-dialog id="dialog">
      <h2>[[headerText]]</h2>
      <paper-dialog-scrollable>
        <iron-list items="[[availableOrganizations]]" as="organization">
          <template>
            <div class="layout horizontal">
              <div class="pageItem id">
                [[organization.name]]
              </div>
              <div class="pageItem title">
                [[_organizationImageUrl(organization)]]
              </div>
              <paper-button data-args$="[[organization]]" on-tap="_editOrganization">[[t('update')]]</paper-button>
            </div>
          </template>
        </iron-list>

        <iron-list items="[[users]]" as="user">
          <template>
            <div class="layout horizontal">
              <div class="userItem id">
                [[user.id]]
              </div>
              <div class="userItem name">
                [[user.name]]
              </div>
              <div class="userItem email">
                [[user.email]]
              </div>
              <template is="dom-if" if="[[!_userOrganizationName(user)]]">
                <div class="organization">
                  <paper-button data-args$="[[user.id]]" on-tap="_addToOrganization">[[t('users.addToOrganization')]]</paper-button>
                </div>
              </template>
              <div class="organization" hidden$="[[!_userOrganizationName(user)]]">
                <div class="organizationName">
                  [[_userOrganizationName(user)]]
                </div>
                <paper-button data-args$="[[user.id]]" data-args-org$="[[_userOrganizationId(user)]]" on-tap="_removeFromOrganization">[[t('users.removeFromOrganization')]]</paper-button>
              </div>
            </div>
          </template>
        </iron-list>
      </paper-dialog-scrollable>

      <div class="buttons">
        <paper-button dialog-dismiss="">[[t('close')]]</paper-button>
      </div>
    </paper-dialog>

    <div class="layout horizontal center-center">
      <yp-ajax method="DELETE" id="removeOrganizationAjax" on-response="_removeOrganizationResponse"></yp-ajax>
      <yp-ajax method="POST" id="addOrganizationAjax" on-response="_addOrganizationResponse"></yp-ajax>
    </div>

  </template>

  <script>
    Polymer({

      is: 'yp-organizations-grid',

      behaviors: [
        Polymer.appHelpers,
        Polymer.WordWrap
      ],

      properties: {
        organizations: {
          type: Array,
          notify: true
        },

        availableOrganizations: {
          type: Array
        },

        headerText: {
          type: String
        },

        selected: {
          type: Object
        }

      },

      _newOrganization: function () {
        var dialog = Polymer.dom(document).querySelector('yp-app').getDialog("organizationEdit");
        dialog.setup(null, true, null);
        dialog.open('new', {});
      },

      _editOrganization: function (event) {
        var organization = JSON.parse(event.target.getAttribute('data-args'));
        var dialog = Polymer.dom(document).querySelector('yp-app').getDialog("organizationEdit");
        dialog._clear();
        dialog.setup(organization, false, null);
        dialog.open('edit', { organizationId: organization.id });
      },

      _organizationImageUrl: function (organization) {
        if (organization.OrganizationLogoImages) {
          return this.getImageFormatUrl(organization.OrganizationLogoImages, 2);
        } else {
          return null;
        }
      },

      _availableOrganizations: function () {
        if (window.appUser.adminRights && window.appUser.adminRights.OrganizationAdmins) {
          return  window.appUser.adminRights.OrganizationAdmins;
        } else {
          return [];
        }
      },

      _addToOrganization: function (event) {
        this.set('userIdForSelectingOrganization', event.target.getAttribute('data-args'));
        this.$.selectOrganizationDialog.open();
      },

      _removeFromOrganization: function (event) {
        var userId = event.target.getAttribute('data-args');
        var organizationId = event.target.getAttribute('data-args-org');
        this.$.removeOrganizationAjax.body = {};
        this.$.removeOrganizationAjax.url = "/api/organizations/" + organizationId + "/" + userId + "/remove_user";
        this.$.removeOrganizationAjax.generateRequest();
      },

      _selectOrganization: function (event, detail) {
        this.$.addOrganizationAjax.body = {};
        this.$.addOrganizationAjax.url = "/api/organizations/" + event.target.id + "/" + this.userIdForSelectingOrganization + "/add_user";
        this.$.addOrganizationAjax.generateRequest();
        this.$.selectOrganizationDialog.close();
      },

      _addOrganizationResponse: function (event, detail) {
        window.appGlobals.notifyUserViaToast(this.t('users.organizationUserAdded')+' '+ detail.response.email);
        this.$.ajax.generateRequest();
      },

      _removeOrganizationResponse: function (event, detail) {
        window.appGlobals.notifyUserViaToast(this.t('users.organizationUserRemoved')+' '+ detail.response.email);
        this.$.ajax.generateRequest();
      },

      open: function () {
        this.set('availableOrganizations', this._availableOrganizations());
        this.$.dialog.open();
      }
    });
  </script>
</dom-module>
<dom-module id="yp-domain-edit" assetpath="../yp-domain/">
  <template>

    <style include="iron-flex iron-flex-alignment">
      .additionalSettings {
        padding-top: 8px;
        margin-top: 8px;
      }

      .mainInput {
        max-width: 400px;
      }

      yp-theme-selector {
        padding-top: 8px;
        margin-bottom: 8px;
      }

      .imageSizeInfo {
        font-size: 13px;
      }

      .sectionMargin {
        margin-top: 8px;
      }
    </style>

    <iron-signals on-iron-signal-yp-language="_languageEvent"></iron-signals>

    <yp-edit-dialog id="editDialog" icon="cloud-queue" action="[[action]]" method="[[method]]" params="[[params]]" save-text="[[saveText]]" toast-text="[[toastText]]">
      <h2>[[editHeaderText]]</h2>

      <paper-tabs selected="{{selected}}" id="paper_tabs" focused="">
        <paper-tab><span>[[t('domain.info')]]</span></paper-tab>
        <paper-tab>[[t('domain.settings')]]</paper-tab>
        <paper-tab>[[t('domain.apis')]]</paper-tab>
      </paper-tabs>

      <div class="layout vertical wrap container">
        <neon-animated-pages id="pages" class="layout horizontal flex" selected="[[selected]]">

          <section>
            <paper-input id="name" name="name" type="text" label="[[t('Name')]]" value="{{domain.name}}" maxlength="60" char-counter="" class="mainInput">
            </paper-input>

            <paper-textarea id="description" name="description" value="{{domain.description}}" label="[[t('Description')]]" char-counter="" rows="2" max-rows="5" maxlength="300" class="mainInput">
            </paper-textarea>
            <div class="horizontal end-justified layout">
              <emoji-selector id="emojiSelectorDescription"></emoji-selector>
            </div>

            <div class="layout vertical">
              <yp-theme-selector object="[[domain]]" selected-theme="{{themeId}}"></yp-theme-selector>
            </div>

            <div class="layout vertical additionalSettings">
              <file-upload id="logoImageUpload" raised="true" multi="false" target="/api/images?itemType=domain-logo" method="POST" on-success="_logoImageUploaded">
                <iron-icon class="icon" icon="image:photo-camera"></iron-icon>
                <span>[[t('image.logo.upload')]]</span><br>
                <span class="imageSizeInfo">864 x 486</span>
              </file-upload>
            </div>

            <div class="layout vertical additionalSettings">
              <file-upload id="headerImageUpload" raised="true" multi="false" target="/api/images?itemType=domain-header" method="POST" on-success="_headerImageUploaded">
                <iron-icon class="icon" icon="image:photo-camera"></iron-icon>
                <span>[[t('image.header.upload')]]</span><br>
                <span class="imageSizeInfo">1920 x 600</span>
              </file-upload>
            </div>

            <paper-input id="customUserRegistrationText" name="customUserRegistrationText" type="text" label="[[t('customUserRegistrationText')]]" value="{{domain.configuration.customUserRegistrationText}}" maxlength="256" char-counter="">
            </paper-input>

            <input type="hidden" name="themeId" value="[[themeId]]">
            <input type="hidden" name="uploadedLogoImageId" value="[[uploadedLogoImageId]]">
            <input type="hidden" name="uploadedHeaderImageId" value="[[uploadedHeaderImageId]]">
          </section>

          <section class="sectionMargin">
            <paper-checkbox name="onlyAdminsCanCreateCommunities" checked$="{{domain.only_admins_can_create_communities}}">[[t('domain.onlyAdminsCanCreateCommunities')]]</paper-checkbox>
            <paper-checkbox name="downloadFacebookImagesForUser" checked$="{{domain.configuration.downloadFacebookImagesForUser}}">[[t('downloadFacebookImagesForUser')]]</paper-checkbox>
            <yp-language-selector name="defaultLocale" no-user-events="" selected-locale="{{domain.default_locale}}"></yp-language-selector>
          </section>

          <section>
            <paper-input id="facebookClientId" name="facebookClientId" type="text" label="Facebook Client Id" value="{{domain.secret_api_keys.facebook.client_id}}" maxlength="60" char-counter="" class="mainInput">
            </paper-input>

            <paper-input id="facebookClientSecret" name="facebookClientSecret" type="text" label="Facebook Client Secret" value="{{domain.secret_api_keys.facebook.client_secret}}" maxlength="60" char-counter="" class="mainInput">
            </paper-input>

            <paper-input id="googleClientId" name="googleClientId" type="text" label="Google Client Id" value="{{domain.secret_api_keys.google.client_id}}" maxlength="60" char-counter="" class="mainInput">
            </paper-input>

            <paper-input id="googleClientSecret" name="googleClientSecret" type="text" label="Google Client Secret" value="{{domain.secret_api_keys.google.client_secret}}" maxlength="60" char-counter="" class="mainInput">
            </paper-input>

            <paper-input id="samlEntryPoint" name="samlEntryPoint" type="text" label="SAML EntryPoint" value="{{domain.secret_api_keys.saml.entryPoint}}" maxlength="100" char-counter="" class="mainInput">
            </paper-input>

            <paper-input id="samlCallbackUrl" name="samlCallbackUrl" type="text" label="SAML CallbackUrl" value="{{domain.secret_api_keys.saml.callbackUrl}}" maxlength="100" char-counter="" class="mainInput">
            </paper-input>

            <paper-textarea id="samlCert" name="samlCert" value="{{domain.secret_api_keys.saml.cert}}" label="SAML Verification Certificate Chain" char-counter="" rows="2" max-rows="5" maxlength="20000" class="mainInput">
            </paper-textarea>
          </section>
        </neon-animated-pages>

    
  </div></yp-edit-dialog></template>

</dom-module>

<script>

  Polymer({

    is: 'yp-domain-edit',

    behaviors: [
      Polymer.appHelpers,
      Polymer.ypEditDialogBehavior
    ],

    properties: {
      action: {
        type: String,
        value: "/api/domains"
      },

      domain: {
        type: Object,
        observer: '_domainChanged',
        notify: true
      },

      params: {
        type: String
      },

      selected: {
        type: Number,
        value: 0
      },

      method: {
        type: String
      },

      uploadedLogoImageId: {
        type: String
      },

      uploadedHeaderImageId: {
        type: String
      },

      themeId: {
        type: String,
        value: null
      },

      status: {
        type: String
      }
    },

    observers: [
      '_setupTranslation(language,t)'
    ],

    _updateEmojiBindings: function () {
      this.async(function () {
        var description = this.$$("#description");
        var emojiSelector = this.$$("#emojiSelectorDescription");
        if (description && emojiSelector) {
          emojiSelector.inputTarget = description;
        } else {
          console.warn("Domain edit: Can't bind emojis :(");
        }
      }.bind(this), 500);
    },

    _domainChanged: function (domain) {
       this._updateEmojiBindings();
    },

    _customRedirect: function (domain) {
      if (this.new) {
        this.redirectTo("/domain/"+domain.id);
      }
    },

    _clear: function () {
      this.domain = { name: '', description: '' };
      this.uploadedLogoImageId = null;
      this.uploadedHeaderImageId = null;
      this.$.headerImageUpload.clear();
      this.$.logoImageUpload.clear();
    },

    setup: function (domain, newNotEdit, refreshFunction) {
      this.set('domain', domain);
      this.set('new', newNotEdit);
      this.set('refreshFunction', refreshFunction);
      this._setupTranslation();
    },

    _setupTranslation: function () {
      if (this.new) {
        this.editHeaderText = this.t('domain.new');
        this.toastText = this.t('domainToastCreated');
        this.set('saveText', this.t('create'));
      } else {
        this.set('saveText', this.t('save'));
        this.editHeaderText = this.t('domain.edit');
        this.toastText = this.t('domainToastUpdated');
      }
    }
  });
</script>
<dom-module id="yp-post-status-change-edit" assetpath="../yp-post/">
  <template>

    <style include="iron-flex iron-flex-alignment">
      .additionalSettings {
        padding-top: 16px;
      }

      paper-textarea {
        padding-top: 16px;
      }
    </style>
    <iron-signals on-iron-signal-yp-language="_languageEvent"></iron-signals>

    <yp-edit-dialog id="editDialog" double-width="" icon="language" confirmation-text="[[t('post.statusChangeConfirmText')]]" action="[[action]]" method="[[method]]" params="[[params]]" save-text="[[saveText]]" toast-text="[[toastText]]">
      <h2>[[editHeaderText]]</h2>

      <div class="layout horizontal center-center">
        <paper-dropdown-menu label="[[t('post.statusChangeSelectNewStatus')]]">
          <paper-menu class="dropdown-content" attr-for-selected="name" selected="{{officialStatus}}">
            <template is="dom-repeat" items="[[officialStatusOptions]]" as="statusOption">
              <paper-item name="[[statusOption.official_value]]">[[statusOption.translatedName]]</paper-item>
            </template>
          </paper-menu>
        </paper-dropdown-menu>
        <input type="hidden" name="official_status" value="[[officialStatus]]">
      </div>

      <div class="layout vertical">
        <paper-textarea id="content" name="content" value="{{postStatusChange.content}}" label="[[t('post.statusChangeContent')]]" char-counter="" rows="10" max-rows="10" maxlength="100000" class="mainInput">
        </paper-textarea>
      </div>
    </yp-edit-dialog>
  </template>

</dom-module>

<script>

  Polymer({

    is: 'yp-post-status-change-edit',

    behaviors: [
      Polymer.appHelpers,
      Polymer.ypEditDialogBehavior,
      Polymer.ypOfficialStatusOptions
    ],

    properties: {

      action: {
        type: String,
        value: "/api/posts"
      },

      post: {
        type: Object,
        observer: "_postChanged"
      },

      params: {
        type: String
      },

      method: {
        type: String
      },

      officialStatus: Number,

      postStatusChange: Object
    },

    _postChanged: function (newValue, oldValue) {
      if (newValue) {
        this.set('officialStatus', this.post.official_status);
      }
    },

    _clear: function () {
      this.set('postStatusChange', { content: '' });
      this.set('post', null);
    },

    setup: function (post, postStatusChange, refreshFunction) {
      this.set('post', post);
      if (!postStatusChange) {
        this.set('postStatusChange', { content: ''});
      } else {
        this.set('postStatusChange', postStatusChange);
      }
      this.set('refreshFunction', refreshFunction);
      this._setupTranslation();
    },

    _setupTranslation: function () {
      this.set('editHeaderText', this.t('post.statusChange'));
      this.set('toastText', this.t('post.statusChangeSent'));
      this.set('saveText', this.t('post.statusChange'));
    }
  });
</script>
<dom-module id="yp-post-move" assetpath="../yp-post/">
  <template>

    <style include="iron-flex iron-flex-alignment">
      .additionalSettings {
        padding-top: 16px;
      }

      paper-textarea {
        padding-top: 16px;
      }

      .groupName {
        cursor: pointer;
      }
    </style>
    <iron-signals on-iron-signal-yp-language="_languageEvent"></iron-signals>

    <yp-edit-dialog id="editDialog" icon="language" confirmation-text="[[t('post.statusChangeConfirmText')]]" action="[[action]]" method="[[method]]" params="[[params]]" save-text="[[saveText]]" toast-text="[[toastText]]">
      <h2>[[editHeaderText]]</h2>

      <template is="dom-repeat" items="[[availableGroups]]" as="group">
        <div class="groupName" on-tap="_selectGroup" data-args$="[[group.id]]" data-args-name$="[[group.name]]">[[group.name]]</div>
      </template>

      <div class="layout horizontal center-center">
        <yp-ajax method="GET" id="getAvailableGroupsAjax" url="/api/users/available/groups" on-response="_getGroupsResponse"></yp-ajax>
        <yp-ajax method="PUT" id="movePostAjax" on-response="_movePostResponse"></yp-ajax>
      </div>
    </yp-edit-dialog>
  </template>

</dom-module>

<script>

  Polymer({

    is: 'yp-post-move',

    behaviors: [
      Polymer.appHelpers,
      Polymer.ypEditDialogBehavior,
      Polymer.AccessHelpers,
      Polymer.ypPostMoveBehavior
    ],

    properties: {

      action: {
        type: String,
        value: "/api/posts"
      },

      post: {
        type: Object
      },

      selectedGroupId: Number
    },

    _selectGroup: function (event) {
      this.set('selectedGroupId', event.target.getAttribute('data-args'));
      var groupName = event.target.getAttribute('data-args-name');
      var dialog = Polymer.dom(document).querySelector('yp-app').getDialog("confirmationDialog");
      dialog.open(this.t('post.confirmMove')+' "'+this.post.name+'" '+this.t('to')+' "'+groupName+'"', this._reallyMove.bind(this));
    },

    _reallyMove: function () {
      this.$.movePostAjax.url="/api/posts/"+this.post.id+'/'+this.selectedGroupId+'/move';
      this.$.movePostAjax.body = {};
      this.$.movePostAjax.generateRequest();
    },

    _movePostResponse: function () {
      location.reload();
    },

    _clear: function () {
      this.set('selectedGroupId', null);
      this.set('post', null);
    },

    setupAndOpen: function (post, refreshFunction) {
      this.set('post', post);
      this.set('refreshFunction', refreshFunction);
      this._setupTranslation();
      this.$.getAvailableGroupsAjax.generateRequest();
      this.open();
    },

    _setupTranslation: function () {
      this.set('editHeaderText', this.t('post.move'));
      this.set('toastText', this.t('post.haveMovedPost'));
      this.set('saveText', this.t('post.move'));
    }
  });
</script>
</div></body></html>