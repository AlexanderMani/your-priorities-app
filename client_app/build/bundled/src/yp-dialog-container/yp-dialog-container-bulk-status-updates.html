<div hidden="" by-polymer-bundler=""><dom-module id="yp-bulk-status-update-edit" assetpath="../yp-bulk-status-update/">
  <template>

    <style include="iron-flex iron-flex-alignment">
      .additionalSettings {
        padding-top: 16px;
      }

      .half {
        width: 50%;
      }
    </style>
    <lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal>

    <yp-edit-dialog id="editDialog" double-width="" icon="language" action="[[action]]" method="[[method]]" title="[[editHeaderText]]" params="[[params]]" save-text="[[saveText]]" toast-text="[[toastText]]">
      <div class="layout vertical">
        <paper-input id="name" name="name" type="text" label="[[t('name')]]" value="{{bulkStatusUpdate.name}}" maxlength="60" char-counter="" class="mainInput">
        </paper-input>

        <paper-textarea id="emailHeader" name="emailHeader" value="{{bulkStatusUpdate.config.emailHeader}}" always-float-label="[[bulkStatusUpdate.config.emailHeader]]" label="[[t('emailHeader')]]" char-counter="" rows="4" max-rows="5" maxlength="30000" class="mainInput">
        </paper-textarea>

        <paper-textarea id="emailFooter" name="emailFooter" value="{{bulkStatusUpdate.config.emailFooter}}" always-float-label="[[bulkStatusUpdate.config.emailFooter]]" label="[[t('emailFooter')]]" char-counter="" rows="4" max-rows="5" maxlength="30000" class="mainInput">
        </paper-textarea>

      </div>

   </yp-edit-dialog>
  </template>

</dom-module>

<script>Polymer({is:"yp-bulk-status-update-edit",behaviors:[Polymer.ypLanguageBehavior,Polymer.ypEditDialogBehavior,Polymer.ypGotoBehavior],properties:{action:{type:String,value:"/api/bulk_status_updates"},bulkStatusUpdate:{type:Object,observer:"_bulkStatusUpdateChanged"},params:{type:String},method:{type:String}},_customRedirect:function(t){t||console.warn("No bulkStatusUpdate found on custom redirect")},_bulkStatusUpdateChanged:function(t,e){},_clear:function(){this.set("bulkStatusUpdate",{name:"",description:"",access:0})},setup:function(t,e,s){t?this.set("bulkStatusUpdate",t):this.set("bulkStatusUpdate",{name:"",emailHeader:"",emailFooter:""}),this.set("new",e),this.set("refreshFunction",s),this._setupTranslation()},_setupTranslation:function(){this.new?(this.set("editHeaderText",this.t("newBulkStatusUpdate")),this.set("toastText",this.t("bulkStatusUpdate.toast.created")),this.set("saveText",this.t("create"))):(this.set("editHeaderText",this.t("editBulkStatusUpdate")),this.set("toastText",this.t("bulkStatusUpdate.toast.updated")),this.set("saveText",this.t("update")))}});</script>
<dom-module id="yp-bulk-status-update-grid" assetpath="../yp-bulk-status-update/">
  <template>
    <style include="iron-flex iron-flex-alignment">
      #dialog {
        width: 100%;
        max-height: 100%;
        background-color: #FFF;
      }

      iron-list {
        color: #000;
        height: 500px;
        width: 100%;
      }

      .pageItem {
        padding-right: 16px;
      }

      .id {
        width: 60px;
      }

      .title {
        width: 200px;
      }

      .email {
        width: 240px;
      }

      #editPageLocale {
        width: 80%;
        max-height: 80%;
        background-color: #FFF;
      }

      .locale {
        width: 30px;
        cursor: pointer;
      }

      paper-textarea {
        height: 60%;
      }

      .localeInput {
        width: 26px;
      }

      .pageItem {
        padding-top: 8px;
      }

      [hidden] {
        display: none !important;
      }
    </style>
    <lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal>

    <paper-dialog id="dialog">
      <h2>[[t('bulkStatusUpdate')]]</h2>
      <paper-dialog-scrollable>
        <iron-list items="[[bulkStatusUpdates]]" as="bulkStatusUpdate">
          <template>
            <div class="layout horizontal">
              <div class="pageItem id">
                [[bulkStatusUpdate.name]]
              </div>
              <paper-button data-args$="[[bulkStatusUpdate]]" on-tap="_editBulkStatusUpdate">[[t('update')]]</paper-button>
              <paper-button data-args$="[[bulkStatusUpdate]]" on-tap="_editConfig">[[t('config')]]</paper-button>
            </div>
          </template>
        </iron-list>
      </paper-dialog-scrollable>

      <paper-button on-tap="_newBulkStatusUpdate">[[t('new')]]</paper-button>

      <div class="buttons">
        <paper-button dialog-dismiss="">[[t('close')]]</paper-button>
      </div>
    </paper-dialog>

    <div class="layout horizontal center-center">
      <yp-ajax method="GET" id="getBulkStatusUpdatesAjax" on-response="_bulkStatusUpdateResponse"></yp-ajax>
    </div>

  </template>

  <script>Polymer({is:"yp-bulk-status-update-grid",behaviors:[Polymer.ypLanguageBehavior,Polymer.WordWrap],properties:{bulkStatusUpdates:{type:Array,notify:!0},selectedUpdate:{type:Object},headerText:{type:String},selected:{type:Object},communityId:Number},_newBulkStatusUpdate:function(){Polymer.dom(document).querySelector("yp-app").getDialogAsync("bulkStatusUpdateEdit",function(t){t.setup(null,!0,null),t.open("new",{communityId:this.communityId})}.bind(this))},_editConfig:function(t){var e=JSON.parse(t.target.getAttribute("data-args"));this.set("selectedUpdate",e),Polymer.dom(document).querySelector("yp-app").getDialogAsync("bulkStatusUpdateConfig",function(t){t.reset(),t.open(this.selectedUpdate),this.$.dialog.close()}.bind(this))},_editBulkStatusUpdate:function(t){var e=JSON.parse(t.target.getAttribute("data-args"));Polymer.dom(document).querySelector("yp-app").getDialogAsync("bulkStatusUpdateEdit",function(t){t._clear(),t.setup(e,!1,null),t.open("edit",{communityId:this.communityId,bulkStatusUpdateId:e.id})}.bind(this))},_bulkStatusUpdateResponse:function(t,e){this.set("bulkStatusUpdates",e.response)},open:function(t){this.set("communityId",t),this.set("bulkStatusUpdates",null),this.set("selectedUpdate",null),Polymer.dom(document).querySelector("yp-app").getDialogAsync("bulkStatusUpdateConfig",function(e){e.reset(),this.$.getBulkStatusUpdatesAjax.url="/api/bulk_status_updates/"+t,this.$.getBulkStatusUpdatesAjax.generateRequest(),this.$.dialog.open()}.bind(this))}});</script>
</dom-module>
<dom-module id="yp-bulk-status-update-templates" assetpath="../yp-bulk-status-update/">
  <template>
    <style include="iron-flex iron-flex-alignment">
      #dialog {
        width: 90%;
        max-height: 90%;
        background-color: #FFF;
      }

      iron-list {
        color: #000;
        height: 500px;
        width: 100%;
      }

      .templateItem {
        padding-right: 16px;
      }

      .id {
        width: 60px;
      }

      .title {
        width: 200px;
      }

      .email {
        width: 240px;
      }

      #editTemplateLocale {
        width: 80%;
        max-height: 80%;
        background-color: #FFF;
      }

      .locale {
        width: 30px;
        cursor: pointer;
      }

      paper-textarea {
        height: 60%;
      }

      .localeInput {
        width: 26px;
      }

      .templateItem {
        padding-top: 8px;
      }

      [hidden] {
        display: none !important;
      }
    </style>
    <lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal>

    <paper-dialog id="editTemplateLocale" modal="" class="layout vertical">
      <h2>[[t('editTemplate')]]</h2>

      <paper-dialog-scrollable>
        <paper-input id="title" name="title" type="text" label="[[t('title')]]" value="{{currentlyEditingTitle}}" maxlength="60" char-counter="" class="mainInput">
        </paper-input>

        <paper-textarea id="content" name="content" value="{{currentlyEditingContent}}" always-float-label="[[currentlyEditingContent]]" label="[[t('templateContent')]]" rows="7" max-rows="10">
        </paper-textarea>
      </paper-dialog-scrollable>


      <div class="buttons">
        <paper-button on-tap="_clearTemplateEdit" dialog-dismiss="">[[t('close')]]</paper-button>
        <paper-button on-tap="_updateTemplate" dialog-dismiss="">[[t('save')]]</paper-button>
      </div>
    </paper-dialog>

    <paper-dialog id="dialog" modal="">
      <h2>[[t('editTemplates')]]</h2>
      <paper-dialog-scrollable>
        <iron-list items="[[templates]]" as="template">
          <template>
            <div class="layout horizontal">
              <div class="templateItem title">
                [[template.title]]
              </div>
              <paper-button data-args$="[[index]]" on-tap="_editTemplate">[[t('editTemplate')]]</paper-button>
              <paper-button data-args$="[[template.title]]" on-tap="_deleteTemplate">[[t('deleteTemplate')]]</paper-button>
            </div>
          </template>
        </iron-list>
      </paper-dialog-scrollable>
      <div class="layout horizontal">
        <paper-button id="addTemplateButton" on-tap="_addTemplate">[[t('addTemplate')]]</paper-button>
      </div>

      <div class="buttons">
        <paper-button dialog-dismiss="">[[t('close')]]</paper-button>
      </div>
    </paper-dialog>

  </template>

  <script>Polymer({is:"yp-bulk-status-update-templates",behaviors:[Polymer.ypLanguageBehavior,Polymer.WordWrap],properties:{templates:{type:Array,notify:!0,observer:"_templatesChanged"},headerText:{type:String},selected:{type:Object},currentlyEditingTemplate:{type:Object},currentlyEditingTitle:{type:String},currentlyEditingContent:{type:String}},_templatesChanged:function(t){t&&document.dispatchEvent(new CustomEvent("lite-signal",{bubbles:!0,compose:!0,detail:{name:"bulk-status-updates-templates",data:this.templates}}))},_editTemplate:function(t){this.set("currentlyEditingTemplate",JSON.parse(t.target.getAttribute("data-args"))),this.set("currentlyEditingContent",this.wordwrap(120)(this.templates[this.currentlyEditingTemplate].content)),this.set("currentlyEditingTitle",this.templates[this.currentlyEditingTemplate].title),this.$.editTemplateLocale.open()},_clearTemplateEdit:function(){this.set("currentlyEditingTemplate",null),this.set("currentlyEditingContent",null),this.set("currentlyEditingTitle",null)},_updateTemplate:function(){var t=JSON.parse(JSON.stringify(this.templates));this.templates.forEach(function(e,i){i==this.currentlyEditingTemplate&&(t[i]={title:this.currentlyEditingTitle,content:this.currentlyEditingContent})}.bind(this)),this.set("templates",t),this._clearTemplateEdit()},_deleteTemplate:function(){var t=event.target.getAttribute("data-args"),e=this.templates;this.templates.forEach(function(i,s){i.title==t&&e.splice(s,1)}.bind(this)),this.set("templates",e)},_addTemplate:function(t){this.templates||this.set("templates",[]),this.push("templates",{title:"",content:""})},open:function(t){this.set("templates",t),this.$.dialog.open()},_setupHeaderText:function(){this.set("headerText",this.t("bulkStatusUpdatesTemplates"))}});</script>
</dom-module>
<dom-module id="yp-bulk-status-update-config" assetpath="../yp-bulk-status-update/">
  <template>
    <style include="iron-flex iron-flex-alignment">
      #dialog {
        width: 100%;
        max-height: 100%;
        background-color: #f0f0f0;
      }

      .postsList {
        color: #000;
        height: 800px;
        width: 100%;
        overflow: auto;
      }

      .pageItem {
        padding-right: 16px;
      }

      .postOfficialStatus {
        width: 100px;
      }

      .postName {
        max-width: 600px;
        font-size: 18px;
        padding-right: 8px;
      }

      .groupName {
        width: 100%;
        border-bottom: 1px dashed;
        margin-bottom: 16px;
        font-size: 22px;
      }

      .postIgnore {
        width: 90px;
      }

      .postDropdown {
        width: 150px;
        margin: 16px;
      }

      #editPageLocale {
        width: 80%;
        max-height: 80%;
        background-color: #FFF;
      }

      .locale {
        width: 30px;
        cursor: pointer;
      }

      paper-textarea {
        height: 200px;
        max-height: 220px;
        overflow: auto;
      }

      .localeInput {
        width: 26px;
      }

      .pageItem {
        padding-top: 8px;
      }

      paper-listbox {
        z-index: 100;
      }

      .dropdown-content {
        z-index: 1000;
      }

      paper-item {
        z-index: 10000;
      }

      .postUniqueMessage {
        width: 300px;
      }

      a {
        color: #333;
      }

      paper-material {
        margin: 16px;
        padding: 24px;
        background-color: #FFF;
      }

      .postItem {
        height: 300px;
        min-height: 300px;
      }

      paper-tab {
        font-size: 14px;
      }

      .id {
        width: 60px;
        font-size: 18px;
      }

      paper-listbox {
        max-height: 220px;
      }
    </style>
    <lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal>
    <lite-signal on-lite-signal-bulk-status-updates-templates="_updatedTemplates"></lite-signal>

    <paper-dialog id="dialog" modal="">
      <h2>[[t('bulkStatusUdateConfig')]]</h2>
      <paper-dialog-scrollable>
        <div class="layout horizontal wrap">
          <paper-tabs selected="{{selectedGroup}}" attr-for-selected="name">
            <template is="dom-repeat" items="[[config.groups]]" as="group">
              <paper-tab name="[[group.name]]">[[_getHeadGroupName(group.name)]]</paper-tab>
            </template>
          </paper-tabs>
        </div>
        <iron-pages attr-for-selected="name" selected="{{selectedGroup}}">
          <template is="dom-repeat" items="[[config.groups]]" as="group">
            <section name="[[group.name]]">
              <div class="layout vertical postsList">
                <template is="dom-if" if="[[_selectedGroup(selectedGroup, group.name)]]">
                  <template is="dom-repeat" items="[[_orderPosts(group.posts)]]" as="post">
                    <div class="layout horizontal postItem">
                      <paper-material elevation="2" class="layout horizontal">
                        <div class="layout vertical">
                          <div class="layout horizontal">
                            <div class="id">[[post.id]]</div>
                            <div class="postName">
                              <a target="_blank" href="/post/[[post.id]]">[[post.name]]</a>
                            </div>
                            <div class="postOfficialStatus">
                              [[_officialStatusOptionsName(post.currentOfficialStatus)]]
                            </div>
                          </div>
                          <div class="layout horizontal">
                            <div class="postDropdown">
                              <paper-dropdown-menu label="[[t('post.statusChangeSelectNewStatus')]]">
                                <paper-listbox slot="dropdown-content" attr-for-selected="name" data-args$="[[post]]" selected="{{post.newOfficialStatus}}" on-iron-select="_selectNewOfficialStatus">
                                  <template is="dom-repeat" items="[[officialStatusOptions]]" as="statusOption">
                                    <paper-item name="[[statusOption.official_value]]">[[statusOption.translatedName]]</paper-item>
                                  </template>
                                </paper-listbox>
                              </paper-dropdown-menu>
                            </div>
                            <div class="postDropdown">
                              <paper-dropdown-menu label="[[t('selectStatusTemplate')]]">
                                <paper-listbox slot="dropdown-content" attr-for-selected="name" data-args$="[[post]]" selected="{{post.selectedTemplateName}}">
                                  <template is="dom-repeat" items="[[templatesWithNone]]" as="templateOption">
                                    <paper-item name="[[templateOption.title]]">[[templateOption.title]]</paper-item>
                                  </template>
                                </paper-listbox>
                              </paper-dropdown-menu>
                            </div>
                            <div class="postDropdown">
                              <paper-dropdown-menu label="[[t('moveToGroup')]]">
                                <paper-listbox slot="dropdown-content" attr-for-selected="name" data-args$="[[post]]" selected="{{post.moveToGroupId}}">
                                  <template is="dom-repeat" items="[[availableGroups]]" as="group">
                                    <paper-item name="[[group.id]]">[[group.name]]</paper-item>
                                  </template>
                                </paper-listbox>
                              </paper-dropdown-menu>
                            </div>
                            <div class="postUniqueMessage">
                              <paper-textarea id="emailFooter" name="emailFooter" always-float-label="[[post.uniqueStatusMessage]]" value="{{post.uniqueStatusMessage}}" label="[[t('uniqueStatusMessage')]]" rows="4" max-rows="4" maxlength="30000" class="mainInput">
                              </paper-textarea>
                            </div>
                          </div>
                        </div>
                      </paper-material>
                    </div>
                  </template>
                </template>
              </div>
            </section>
          </template>
        </iron-pages>

        <div class="layout horizontal center-center">
          <yp-ajax method="GET" id="getAvailableGroupsAjax" url="/api/users/available/groups" on-response="_getGroupsResponse"></yp-ajax>
          <yp-ajax method="PUT" id="updateConfigAjax" url="/api/bulk_status_updates/[[bulkStatusUpdate.community_id]]/[[bulkStatusUpdate.id]]/updateConfig" on-response="_updateConfigResponse"></yp-ajax>
          <yp-ajax method="GET" id="getBulkStatusUpdatesAjax" on-response="_bulkStatusUpdateResponse"></yp-ajax>
        </div>
      </paper-dialog-scrollable>
      <div class="buttons">
        <paper-button on-tap="_saveAndClose">[[t('close')]]</paper-button>
        <paper-button on-tap="_editTemplates">[[t('editTemplates')]]</paper-button>
        <paper-button on-tap="_save">[[t('save')]]</paper-button>
      </div>

    </paper-dialog>


  </template>

  <script>Polymer({is:"yp-bulk-status-update-config",behaviors:[Polymer.ypLanguageBehavior,Polymer.AccessHelpers,Polymer.WordWrap,Polymer.ypOfficialStatusOptions,Polymer.ypPostMoveBehavior],properties:{bulkStatusUpdates:{type:Array,notify:!0},templates:{type:Array,notify:!0},communityId:Number,headerText:{type:String},selected:{type:Object},config:{type:Object,observer:"_configChanged"},haveGotMoveGroups:{type:Boolean,value:!1},selectedGroup:String,closeAfterSave:{type:Boolean,value:!1},templatesWithNone:{type:Array,computed:"_templatesWithNone(templates)"}},_templatesWithNone:function(t){return t?this.templates.concat(["None"]):["None"]},_onIronResize:function(t){t.stopImmediatePropagation()},_getHeadGroupName:function(t){return t?t.split(" ")[0]:""},_selectedGroup:function(t,e){return console.log(t+" - "+e),t==e},reset:function(){this.set("config",null),this.set("templates",null),this.set("bulkStatusUpdates",null)},observers:["_templatesChanged(templates.*)","_groupsChanged(config.*)"],_saveAndClose:function(){this.set("closeAfterSave",!0),this._save()},_orderPosts:function(t){return t.sort(function(t,e){return t.id-e.id})},_updatedTemplates:function(t,e){this.set("templates",e),this.$.updateConfigAjax.body={configValue:this.templates,configName:"templates"},this.$.updateConfigAjax.generateRequest()},_templatesChanged:function(t){},_groupsChanged:function(t){},_save:function(){this.$.updateConfigAjax.body={configValue:this.config,configName:"config"},this.$.updateConfigAjax.generateRequest()},_selectNewOfficialStatus:function(t,e){var o=e.item.name,s=JSON.parse(t.target.getAttribute("data-args")),n=JSON.parse(JSON.stringify(this.config));this.config.groups.forEach(function(t,e){t.posts.forEach(function(t,a){s.id==t.id&&(n.groups[e].posts[a].newOfficialStatus=o)}.bind(this))}.bind(this)),this.set("config",n)},_configChanged:function(t){t&&!this.haveGotMoveGroups&&(this.$.getAvailableGroupsAjax.generateRequest(),this.set("haveGotMoveGroups",!0))},_updateConfigResponse:function(){window.appGlobals.notifyUserViaToast(this.t("saved")),this.closeAfterSave&&(this.set("closeAfterSave",!1),this.$.dialog.close())},_newBulkStatusUpdate:function(){Polymer.dom(document).querySelector("yp-app").getDialogAsync("bulkStatusUpdateEdit",function(t){t.setup(null,!0,null),t.open("new",{})})},_editBulkStatusUpdate:function(t){var e=JSON.parse(t.target.getAttribute("data-args"));Polymer.dom(document).querySelector("yp-app").getDialogAsync("bulkStatusUpdateEdit",function(t){t._clear(),t.setup(e,!1,null),t.open("edit",{bulkStatusUpdateId:e.id})})},_editTemplates:function(){Polymer.dom(document).querySelector("yp-app").getDialogAsync("bulkStatusUpdateEditTemplates",function(t){t.open(this.templates)}.bind(this))},open:function(t){this.set("config",t.config),this.set("templates",t.templates),this.set("bulkStatusUpdate",t),this.$.dialog.open()}});</script>
</dom-module>
</div>