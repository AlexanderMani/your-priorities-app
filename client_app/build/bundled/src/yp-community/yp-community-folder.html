<dom-module id="yp-community-folder"><template><style include="iron-flex iron-flex-alignment">.card-container{@apply --layout-horizontal;@apply --layout-wrap;}.card{padding:16px}yp-ajax{background-color:var(--primary-background-color)!important}.archivedText{font-size:26px;color:#333}.minHeightSection{min-height:450px}#paper_tabs[apple]{margin-top:42px;margin-bottom:8px}[hidden]{display:none!important}</style><yp-page id="page" create-fab-icon="[[createFabIcon]]" hide-all-tabs="" create-fab-title="[[t('group.add')]]" on-yp-create-fab-tap="_newGroup"><yp-community-large-card id="communityCard" slot="largeCard" class="largeCard card" community="[[communityFolder]]" on-update-community="_refreshAjax"></yp-community-large-card><div class="layout horizontal center-center wrap" slot="tabPages"><yp-community-grid featured-communities="[[featuredCommunities]]" active-communities="[[activeCommunities]]" archived-communities="[[archivedCommunities]]" hide-add$="[[!createFabIcon]]" on-add-new-community="_newCommunity"></yp-community-grid></div></yp-page><lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal><lite-signal on-lite-signal-logged-in="_userLoggedIn"></lite-signal><lite-signal on-lite-signal-got-admin-rights="_gotAdminRights"></lite-signal><app-route route="{{idRoute}}" pattern="/:id" data="{{idRouteData}}" tail="{{tabRoute}}"></app-route><app-route route="{{tabRoute}}" pattern="/:tabName" data="{{tabRouteData}}"></app-route><yp-ajax id="ajax" url="/api/domains" on-response="_response"></yp-ajax><yp-ajax id="pagesAjax" on-response="_pagesResponse"></yp-ajax></template><script>Polymer({is:"yp-community-folder",behaviors:[Polymer.ypLanguageBehavior,Polymer.CommunityCollectionBehaviors,Polymer.ypThemeBehavior,Polymer.CollectionHelpers,Polymer.AccessHelpers,Polymer.ypLoggedInUserBehavior,Polymer.ypDetectOldiOs,Polymer.ypGotoBehavior,Polymer.ypMediaFormatsBehavior],properties:{idRoute:Object,tabRoute:Object,idRouteData:Object,tabRouteData:Object,createFabIcon:{type:String,value:null,notify:!0},communityFolderId:{type:Number,value:null,observer:"_communityFolderIdChanged"},communityFolder:{type:Object},mapActive:{type:Boolean,value:!1},locationHidden:{type:Boolean,value:!1},useAlternativeHeader:{type:Boolean,value:!1},isOldiOs:{type:Boolean,computed:"_isOldiOs(communityFolderId)"},useNormalHeader:{type:Boolean,value:!0}},observers:["_routeIdChanged(idRouteData.id)"],listeners:{"yp-new-group":"_newGroup"},_userLoggedIn:function(e){e&&this.communityFolder&&window.location.href.indexOf("/community_folder/")>-1&&this.$$("#ajax").generateRequest()},_routeIdChanged:function(e){e&&this.set("communityFolderId",e)},_hideEdit:function(){return!this.communityFolder||(!window.appUser.loggedIn()||window.appUser.user.id!=this.communityFolder.user_id)},_communityHeaderUrl:function(e){return this.getImageFormatUrl(e.CommunityHeaderImages,2)},_communityFolderIdChanged:function(e,o){e&&(this.set("communityFolder",null),this.set("featuredCommunities",null),this.set("activeCommuntities",null),this.set("archivedCommunities",null),this._getCommunityFolder())},_getCommunityFolder:function(){this.$$("#ajax").url="/api/communities/"+this.communityFolderId+"/communityFolders",this.$$("#ajax").retryMethodAfter401Login=this._getCommunityFolder.bind(this),this.$$("#ajax").generateRequest()},_refreshAjax:function(){this.async(function(){this.$$("#ajax").generateRequest()},100)},_newCommunity:function(){window.appGlobals.activity("open","newCommunity"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("communityEdit",function(e){e.setup(null,!0,this._refreshAjax.bind(this)),e.open("new",{domainId:this.domainId,communityFolderId:this.communityFolderId})}.bind(this))},_pagesResponse:function(e,o){this.fire("yp-set-pages",o.response)},_response:function(e,o,i){if(this.set("communityFolder",o.response),this.communityFolder.is_community_folder){this.refresh(),this.set("createFabIcon",null);this._communityHeaderUrl(this.communityFolder);this.setupCommunities(this.communityFolder.Communities)}else this.redirectTo("/community/"+this.community.id)},_gotAdminRights:function(e,o){o&&o>0&&this.checkCommunityAccess(this.communityFolder)&&this.set("createFabIcon","add")},refresh:function(){if(this.communityFolder){var e,o,i;if(this.fire("yp-set-home-link",{type:"communityFolder",id:this.communityFolder.id,name:this.communityFolder.name}),null!=this.communityFolder.theme_id?this.setTheme(this.communityFolder.theme_id):null!=this.communityFolder.Domain.theme_id&&this.setTheme(this.communityFolder.Domain.theme_id),null!=this.communityFolder.default_locale&&window.appGlobals.changeLocaleIfNeeded(this.communityFolder.default_locale),this.communityFolder.CommunityHeaderImages&&this.communityFolder.CommunityHeaderImages.length>0?this.$.page.setupTopHeaderImage(this.communityFolder.CommunityHeaderImages):this.$.page.setupTopHeaderImage(null),window.location.href.indexOf("/community_folder")>-1)this.communityFolder.CommunityFolder?(e="/community_folder/"+this.communityFolder.CommunityFolder.id,o=this.communityFolder.CommunityFolder.name,i=this.communityFolder.CommunityFolder.description):(e="/domain/"+this.communityFolder.domain_id,o=this.communityFolder.Domain.name,i=this.communityFolder.Domain.description),this.fire("change-header",{headerTitle:o,headerDescription:i,headerIcon:"group-work",disableDomainUpLink:!1,documentTitle:this.communityFolder.name,backPath:e});this.$.pagesAjax.url="/api/domains/"+this.communityFolder.Domain.id+"/pages",this.$.pagesAjax.generateRequest(),window.appGlobals.setAnonymousGroupStatus(null),window.appGlobals.disableFacebookLoginForGroup=!1,window.appGlobals.externalGoalTriggerUrl=null,window.appGlobals.currentGroupForceSaml=!1,window.appGlobals.currentGroup=null,this.communityFolder.configuration&&this.communityFolder.configuration.signupTermsPageId&&-1!=this.communityFolder.configuration.signupTermsPageId?window.appGlobals.signupTermsPageId=this.communityFolder.configuration.signupTermsPageId:window.appGlobals.signupTermsPageId=null}}});</script></dom-module>