<html><head><link rel="import" href="../../bower_components/polymer/polymer.html"><link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html"><link rel="import" href="../../bower_components/lite-signal/lite-signal.html"><link rel="import" href="../../bower_components/paper-tabs/paper-tab.html"><link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html"><link rel="import" href="../yp-behaviors/app-helpers.html"><link rel="import" href="../yp-theme/yp-theme-behavior.html"><link rel="import" href="../yp-post/yp-post-map.html"><link rel="import" href="../yp-ajax/yp-ajax.html"><link rel="import" href="../yp-page/yp-page.html"><link rel="import" href="yp-organization-large-card.html"></head><body><dom-module id="yp-organization"><template><style include="iron-flex iron-flex-alignment">.card-container{@apply (--layout-horizontal);@apply (--layout-wrap);width:100%;}.card{padding:16px;}yp-ajax{background-color:var(--primary-background-color);}</style><lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal><yp-page id="page" create-fab-icon="group" create-fab-title="[[t('group.add')]]" on-yp-create-fab-tap="_newGroup"><yp-organization-large-card id="organizationCard" slot="largeCard" class="largeCard card" organization="[[organization]]" on-update-organization="_refresh"></yp-organization-large-card><paper-tabs id="paper_tabs" slot="tabs" class="tabs" selected="{{selected}}" focused=""><paper-tab class="tab"><span>[[t('groups')]]</span> &nbsp; (<span>[[groups.length]]</span>)</paper-tab><paper-tab class="tab">[[t('news')]]</paper-tab><paper-tab class="tab">[[t('posts.map')]]</paper-tab></paper-tabs><iron-pages class="tabPages" slot="tabPages" selected="{{selected}}" entry-animation="fade-in-animation" exit-animation="fade-out-animation"><section><div class="layout horizontal center-center wrap"></div></section><section><template is="dom-if" if="[[mapActive]]" restamp=""><yp-post-map organization-id="[[organization.id]]"></yp-post-map></template></section></iron-pages></yp-page><yp-ajax id="ajax" url="/api/organizations" on-response="_response"></yp-ajax></template><script>Polymer({is:'yp-organization',behaviors:[Polymer.appHelpers,Polymer.ypThemeBehavior],properties:{groups:{type:Array},organizationId:{type:Number,value:null,observer:'_organizationIdChanged'},organization:{type:Object},organizationEmpty:{type:Boolean,value:!1},hideAdd:{type:Boolean,value:!0},selected:{type:Number,value:0,observer:'_selectedChanged'},tabName:{type:String,value:null,observer:'_tabNameChanged'},mapActive:{type:Boolean,value:!1}},_tabNameChanged:function(a){a&&('groups'==a?this.set('selected',0):'news'==a?this.set('selected',1):'map'==a&&this.set('selected',2))},_selectedChanged:function(a){this.organization&&(0==a?this.redirectTo('/organization/'+this.organization.id+'/groups'):1==a?this.redirectTo('/organization/'+this.organization.id+'/news'):2==a&&this.redirectTo('/organization/'+this.organization.id+'/map'))},_hideEdit:function(){return!this.organization||!window.appUser.loggedIn()||window.appUser.user.id!=this.organization.user_id},_organizationHeaderUrl:function(a){return this.getImageFormatUrl(a.OrganizationHeaderImages,2)},_organizationIdChanged:function(a){a&&(this.set('organization',null),this.set('groups',null),this.$$('#ajax').url='/api/organizations/'+this.organizationId,this.$$('#ajax').generateRequest(),this.hideAdd=!0)},_newGroup:function(){window.appGlobals.activity('open','newGroup'),Polymer.dom(document).querySelector('yp-app').getDialogAsync('groupEdit',function(a){a.setup(null,!0,null),a.open('new',{organizationId:this.organizationId})}.bind(this))},_response:function(a,b){this.set('organization',b.response),this.organization.OrganizationHeaderImages&&0<this.organization.OrganizationHeaderImages.length&&this.$.page.setupTopHeaderImage(this.organization.OrganizationHeaderImages);var c=Math.floor(3*Math.random())+1,d=this._organizationHeaderUrl(this.organization);this.set('groups',this.organization.Groups),this.async(function(){var a=this.$$('#organizationCard');a&&(a.setElevation(5),a.lowerCardLater())},20),this.organizationEmpty=!(0!==b.response.Groups.length),this.fire('change-header',{headerTitle:this.organization.Domain.name,headerDescription:this.organization.Domain.description,headerIcon:'group-work',backPath:'/domain/'+this.organization.domain_id}),this.hideAdd=!!(0<this.groups.length)},defaultGroupFirst:function(a){for(var b,c=[],d=null,e=0;e<a.length;e++)b=a[e],'default'==b.short_name?d=b:c.push(b);return c.unshift(d),c},noTestGroup:function(a){for(var b,c=[],d=0;d<a.length;d++)b=a[d],'test'!=b.short_name&&'ac-posts'!=b.short_name&&'development'!=b.short_name&&-1==b.short_name.indexOf('2012')&&-1==b.short_name.indexOf('2013')&&c.push(b);return c},_refresh:function(){this.$$('#ajax').generateRequest()},ready:function(){}});</script></dom-module></body></html>