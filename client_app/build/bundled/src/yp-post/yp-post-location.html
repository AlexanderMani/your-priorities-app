<html><head><link rel="import" href="../../bower_components/polymer/polymer.html"><link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html"><link rel="import" href="../../bower_components/iron-media-query/iron-media-query.html"><link rel="import" href="../../bower_components/iron-signals/iron-signals.html"><link rel="import" href="../../bower_components/paper-button/paper-button.html"><link rel="import" href="../../bower_components/paper-input/paper-input.html"><link rel="import" href="../../bower_components/paper-spinner/paper-spinner.html"><link rel="import" href="../../bower_components/google-map/google-map.html"><link rel="import" href="../../bower_components/google-map/google-map-marker.html"><link rel="import" href="../../bower_components/google-map/google-map-search.html"><link rel="import" href="../yp-app-globals/yp-app-icons.html"><link rel="import" href="../yp-behaviors/app-helpers.html"></head><body><dom-module id="yp-post-location"><template><style include="iron-flex iron-flex-alignment">:host{display:block;width:100%;height:100%;}.location-button{@apply (--layout-horizontal);@apply (--layout-flex);}#map{width:100%;height:100%;}@media screen and (-ms-high-contrast: active), (-ms-high-contrast: none){#map{min-height:220px;}}.mapSearchInput{width:100%;margin-top:8px;}paper-input{width:250px;}.searchResultText{width:100%;text-align:right;padding-top:8px;}paper-button{font-size:16px;padding-top:32px;}</style><iron-signals on-iron-signal-yp-language="_languageEvent"></iron-signals><iron-media-query query="(max-width: 1024px)" query-matches="{{narrowPad}}"></iron-media-query><google-map-search id="mapSearch" map="[[map]]" on-google-map-search-results="_mapSearchResults"></google-map-search><google-map id="map" zoom="[[mapZoom]]" api-key="AIzaSyDkF_kak8BVZA5zfp5R4xRnrX8HP3hjiL0" map="{{map}}" libraries="places" on-map-type-changed="_mapTypeChanged" class="map" click-events="" on-zoom-changed="_zoomChanged" on-google-map-click="_setLocation" fit-to-markers=""><google-map-marker latitude="[[defaultLatitude]]" longitude="[[defaultLongitude]]" id="marker"></google-map-marker></google-map><div class="mapSearchInput layout vertical center-center"><div class="layout horizontal center-center wrap"><paper-input max-length="60" label="[[t('maps.searchInput')]]" value="{{mapSearchString}}" on-keydown="_submitOnEnter"></paper-input><paper-button on-tap="_searchMap">[[t('maps.search')]]</paper-button></div><div class="searchResultText layout horizontal center-center">[[mapSearchResultAddress]]</div><paper-spinner id="spinner"></paper-spinner></div></template><script>Polymer({is:'yp-post-location',behaviors:[Polymer.appHelpers],properties:{map:{type:Object},group:{type:Object,observer:'_groupChanged'},defaultLatitude:{type:String,value:'64.13897027178841'},defaultLongitude:{type:String,value:'-21.876912117004395'},mapSearchString:{type:String,value:''},mapSearchResultAddress:{type:String,value:''},location:{type:Object,observer:'_locationChanged',notify:!0},mapZoom:{type:Number,value:13,computed:'_computeMapZoom(location)'},encodedLocation:{type:String,notify:!0},post:{type:Object,observer:'_postChanged'},marker:{type:Object},active:{type:Boolean,value:!1},narrowPad:Boolean},_computeMapZoom:function(a){return a&&a.map_zoom?a.map_zoom:this.mapZoom},_submitOnEnter:function(a){13===a.keyCode&&this._searchMap()},_searchMap:function(){this.$.mapSearch.query=this.mapSearchString,this.$.mapSearch.search(),this.$.spinner.active=!0,this.set('mapSearchResultAddress','')},_mapSearchResults:function(a,b){this.$.spinner.active=!1,b&&0<b.length&&(this.set('location',{latitude:b[0].latitude,longitude:b[0].longitude,map_zoom:15}),this.mapSearchResultAddress=b[0].formatted_address,this.$.map.zoom=15,this.$.map.resize())},ready:function(){this.location||this.async(function(){'geolocation'in navigator&&navigator.geolocation.getCurrentPosition(function(a){this.location||(this.location={latitude:a.coords.latitude,longitude:a.coords.longitude,map_zoom:13})}.bind(this))},50)},_zoomChanged:function(a,b){b&&b.value&&this.set('location.map_zoom',b.value),this.set('encodedLocation',JSON.stringify(this.location))},_mapTypeChanged:function(a,b){b&&b.value&&this.set('location.mapType',b.value),this.set('encodedLocation',JSON.stringify(this.location))},_locationChanged:function(a){a&&(this.$.marker.setAttribute('latitude',a.latitude),this.$.marker.setAttribute('longitude',a.longitude),a.map_zoom&&(this.$.map.zoom=a.map_zoom),a.mapType&&(this.$.map.mapType=a.mapType),this.$.map.resize(),this.set('encodedLocation',JSON.stringify(a)))},_setLocation:function(a,b){this.set('location',{latitude:b.latLng.lat(),longitude:b.latLng.lng(),mapType:this.$.map.mapType,map_zoom:this.$.map.zoom})},_groupChanged:function(a){if(a){var b;a.configuration&&a.configuration.defaultLocationLongLat&&''!=a.configuration.defaultLocationLongLat&&1<a.configuration.defaultLocationLongLat.split(',').length?(b=a.configuration.defaultLocationLongLat.trim().split(','),this.set('defaultLongitude',b[0]),this.set('defaultLatitude',b[1])):a.Community&&a.Community.configuration&&a.Community.configuration.defaultLocationLongLat&&''!=a.Community.configuration.defaultLocationLongLat&&1<a.Community.configuration.defaultLocationLongLat.split(',').length&&(b=a.Community.configuration.defaultLocationLongLat.trim().split(','),this.set('defaultLongitude',b[0]),this.set('defaultLatitude',b[1]))}},_postChanged:function(a){a||this.set('location',null)}});</script></dom-module></body></html>