<html><head><link rel="import" href="../../bower_components/polymer/polymer.html"><link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html"><link rel="import" href="../../bower_components/iron-signals/iron-signals.html"><link rel="import" href="../../bower_components/paper-input/paper-input.html"><link rel="import" href="../../bower_components/paper-radio-button/paper-radio-button.html"><link rel="import" href="../../bower_components/paper-radio-group/paper-radio-group.html"><link rel="import" href="../../bower_components/paper-input/paper-textarea.html"><link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html"><link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html"><link rel="import" href="../../bower_components/paper-item/paper-item.html"><link rel="import" href="../../bower_components/paper-tabs/paper-tab.html"><link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html"><link rel="import" href="../../bower_components/neon-animation/neon-animated-pages.html"><link rel="import" href="../../bower_components/neon-animation/neon-animatable.html"><link rel="import" href="../../bower_components/neon-animation/neon-animation.html"><link rel="import" href="../yp-file-upload/yp-file-upload.html"><link rel="import" href="../yp-behaviors/app-helpers.html"><link rel="import" href="../yp-behaviors/emoji-selector.html"><link rel="import" href="../yp-edit-dialog/yp-edit-dialog.html"><link rel="import" href="../yp-edit-dialog/yp-edit-dialog-behavior.html"><link rel="import" href="yp-post-location.html"></head><body><dom-module id="yp-post-edit"><template><style include="iron-flex iron-flex-alignment">.access{@apply (--layout-horizontal);@apply (--layout-center-justified);}paper-button{background-color:var(--accent-color);color:#FFF;}yp-file-upload{margin-top:16px;}.accessHeader{color:var(--primary-color,#777);font-weight:normal;margin-bottom:0;}paper-radio-button{display:block;}.container{width:100%;height:100%;min-height:300px;}@media (max-width: 600px){.container{padding-right:16px;}.subContainer{}paper-tab{font-size:12px;}}yp-post-location{}section{margin-top:32px;}.imageSizeInfo{font-size:12px;padding-bottom:16px;color:#444;}paper-dropdown-menu{max-width:250px;}.optional{font-size:12px;}.icon{padding-right:8px;}</style><iron-signals on-iron-signal-yp-language="_languageEvent"></iron-signals><yp-edit-dialog double-width="" id="editDialog" icon="lightbulb-outline" action="[[action]]" use-next-tab-action="[[newPost]]" on-next-tab-action="_nextTab" method="[[method]]" save-text="[[saveText]]" next-action-text="[[t('next')]]" toast-text="[[toastText]]" params="[[params]]"><h2 slot="h2">[[editHeaderText]]</h2><paper-tabs selected="{{selected}}" id="paperTabs" focused=""><paper-tab><span>[[t('post.yourPost')]]</span></paper-tab><template is="dom-if" restamp="" if="[[newPost]]"><paper-tab><div class="layout vertical center-center"><div>[[t('post.yourPoint')]]</div><div class="optional" hidden$="[[!group.configuration.newPointOptional]]">[[t('optional')]]</div></div></paper-tab></template><template is="dom-if" if="[[!locationHidden]]" restamp=""><paper-tab>[[t('post.location')]]</paper-tab></template><paper-tab>[[t('post.photo')]]</paper-tab></paper-tabs><div class="layout vertical wrap container"><neon-animated-pages id="pages" class="layout horizontal flex" selected="[[selected]]"><section><div class="layout vertical"><paper-input id="name" required="" minlength="3" name="name" type="text" label="[[t('title')]]" value="{{post.name}}" maxlength="60" char-counter=""></paper-input><template is="dom-if" if="[[_showCategories(group)]]" restamp=""><paper-dropdown-menu label="[[t('category.select')]]"><paper-listbox slot="dropdown-content" selected="{{selectedCategoryArrayId}}"><template is="dom-repeat" items="[[group.Categories]]" as="category"><paper-item data-category-id$="[[category.id]]">[[category.name]]</paper-item></template></paper-listbox></paper-dropdown-menu><input type="hidden" name="categoryId" value="[[selectedCategoryId]]"></template><paper-textarea id="description" required="" minlength="3" name="description" value="{{post.description}}" label="[[t('post.description')]]" char-counter="" rows="2" max-rows="5" maxlength="500"></paper-textarea><div class="horizontal end-justified layout" hidden$="[[group.configuration.hideEmoji]]"><emoji-selector id="emojiSelectorDescription"></emoji-selector></div></div></section><template is="dom-if" restamp="" if="[[newPost]]"><section class="subContainer"><paper-textarea id="pointFor" required$="[[!group.configuration.newPointOptional]]" minlength="3" name="pointFor" value="{{post.pointFor}}" label="[[t('point.for')]]" char-counter="" rows="2" max-rows="5" maxlength="500"></paper-textarea><div class="horizontal end-justified layout" hidden$="[[group.configuration.hideEmoji]]"><emoji-selector id="emojiSelectorPointFor"></emoji-selector></div></section></template><template is="dom-if" if="[[!locationHidden]]" restamp=""><section><template is="dom-if" if="[[mapActive]]" restamp=""><yp-post-location encoded-location="{{encodedLocation}}" location="{{location}}" group="[[group]]" post="[[post]]"></yp-post-location></template></section></template><section><div class="layout vertical center-center"><yp-file-upload id="imageFileUpload" raised="true" multi="true" target="/api/images?itemType=post-header" method="POST" on-success="_imageUploaded"><iron-icon class="icon" icon="photo-camera"></iron-icon><span>[[t('image.upload')]]</span></yp-file-upload><div class="imageSizeInfo layout horizontal"><div>864 x 486 (16/9 widescreen)</div></div><div>[[t('post.cover.imageInfo')]]</div><br><h3 class="accessHeader">[[t('post.cover.media')]]</h3><paper-radio-group id="coverMediaType" name="coverMediaType" class="coverMediaType layout horizontal wrap" selected="{{selectedCoverMediaType}}"><paper-radio-button name="none">[[t('post.cover.none')]]</paper-radio-button><paper-radio-button name="image" hidden$="[[!uploadedHeaderImageId]]">[[t('post.cover.image')]]</paper-radio-button><template is="dom-if" if="[[location]]"><paper-radio-button name="map">[[t('post.cover.map')]]</paper-radio-button><paper-radio-button name="streetView">[[t('post.cover.streetview')]]</paper-radio-button></template></paper-radio-group></div></section></neon-animated-pages><input type="hidden" name="location" value="[[encodedLocation]]"> <input type="hidden" name="coverMediaType" value="[[selectedCoverMediaType]]"> <input type="hidden" name="uploadedHeaderImageId" value="[[uploadedHeaderImageId]]"></div></yp-edit-dialog></template></dom-module><script>Polymer({is:"yp-post-edit",behaviors:[Polymer.appHelpers,Polymer.ypEditDialogBehavior],properties:{action:{type:String,value:"/api/posts"},newPost:{type:Boolean,value:!1},post:{type:Object,observer:"_postChanged"},group:{type:Object},locationHidden:{type:Boolean,value:!1,observer:"_locationHiddenChanged"},location:{type:Object,observer:"_locationChanged"},encodedLocation:{type:String,observer:"_encodedLocationChanged"},selectedCategoryArrayId:{type:Number,observer:"_selectedCategoryChanged"},selectedCategoryId:{type:Number},selectedCoverMediaType:{type:String,value:"none",observer:"_coverMediaTypeValueChanged"},uploadedHeaderImageId:{type:String,observer:"_uploadedHeaderImageIdChanged"},selected:{type:Number,value:0,observer:"_selectedChanged"},mapActive:{type:Boolean,value:!1}},listeners:{"iron-form-invalid":"_formInvalid"},observers:["_setupTranslation(language,t)"],customFormResponse:function(){var a=new CustomEvent("iron-signal",{detail:{name:"yp-refresh-group-posts",data:{id:4}}});document.dispatchEvent(a)},_updateEmojiBindings:function(){this.async(function(){var a=this.$$("#description"),b=this.$$("#emojiSelectorDescription");a&&b?b.inputTarget=a:console.warn("Post edit: Can't bind emojis :(");var c=this.$$("#emojiSelectorPointFor"),d=this.$$("#pointFor");c&&d&&(c.inputTarget=d)}.bind(this),500)},_locationHiddenChanged:function(){this.async(function(){var a=this.$$("#pages");a&&a.forceSynchronousItemUpdate();var b=this.$$("#paperTabs");b&&b.forceSynchronousItemUpdate(),console.log("Location hidden changed")},10)},_formInvalid:function(){this.newPost&&this.$$("#name").validate()&&this.$$("#description").validate()?this.set("selected",1):this.set("selected",0),this.$$("#name").autoValidate=!0,this.$$("#description").autoValidate=!0,this.newPost&&(this.$$("#pointFor").autoValidate=!0)},_encodedLocationChanged:function(){},_locationChanged:function(a){a&&(!this.selectedCoverMediaType||""==this.selectedCoverMediaType||"none"==this.selectedCoverMediaType)&&this.set("selectedCoverMediaType","map")},_uploadedHeaderImageIdChanged:function(a){a&&this.set("selectedCoverMediaType","image")},_nextOnEnter:function(a){13===a.keyCode&&this._searchMap()},_nextTab:function(){var a=3;this.newPost||(a=2),this.locationHidden&&(a-=1),this.selected<a&&this.set("selected",this.selected+1)},_selectedChanged:function(a){this.locationHidden||a!=(this.newPost?2:1)?this.set("mapActive",!1):this.set("mapActive",!0);var b=this.locationHidden?2:3;if(this.$$("#editDialog").useNextTabAction=!this.newPost||this.newPost&&a==b?!1:!0,0==a){var c=this.$$("#name");c&&c.focus()}if(1==a){var d=this.$$("#pointFor");d&&d.focus()}},_selectedCategoryChanged:function(a){null!=a&&a!=void 0&&(this.selectedCategoryId=this.group.Categories[a].id)},_showCategories:function(a){return a&&a.Categories&&0<a.Categories.length},getPositionInArrayFromId:function(a,b){for(var c=0;c<a.length;c++)if(a[c].id==b)return c;return null},_postChanged:function(a){a&&(a.location&&(this.set("location",a.location),this.set("encodedLocation",JSON.stringify(this.location))),a.cover_media_type&&(this.selectedCoverMediaType=a.cover_media_type),a.category_id&&(this.selectedCategoryId=a.category_id,this.selectedCategoryArrayId=this.getPositionInArrayFromId(this.group.Categories,a.category_id))),this._updateEmojiBindings()},_imageUploaded:function(a,b){var c=JSON.parse(b.xhr.response);this.set("uploadedHeaderImageId",c.id)},_coverMediaTypeValueChanged:function(){},_coverMediaTypeChanged:function(){},_customRedirect:function(a){a?(a.newEndorsement&&window.appUser&&window.appUser.endorsementPostsIndex&&(window.appUser.endorsementPostsIndex[a.id]=a.newEndorsement),this.redirectTo("/post/"+a.id)):console.warn("No post found on custom redirect")},_clear:function(){this.newPost&&(this.set("post",{name:"",description:"",pointFor:"",categoryId:null}),this.set("location",null),this.set("selectedCategoryArrayId",null),this.set("selectedCategoryId",null),this.set("selected",0),this.set("uploadedHeaderImageId",null),this.$$("#imageFileUpload").clear(),this.set("selectedCoverMediaType","none"))},setup:function(a,b,c,d){b?(this.set("group",b),this.group.configuration&&this.group.configuration.locationHidden?!0==this.group.configuration.locationHidden?this.set("locationHidden",!0):this.set("locationHidden",!1):this.set("locationHidden",!1)):this.set("group",null),a?this.set("post",a):this.set("post",null),this.set("newPost",c),this.set("refreshFunction",d),this._setupTranslation(),this._clear(),this.async(function(){var a=this.$$("#name");a&&a.focus()}.bind(this),250)},_setupTranslation:function(){this.async(function(){this.t&&(this.newPost?(this.editHeaderText=this.t("post.new"),this.toastText=this.t("post.toast.created"),this.set("saveText",this.t("create"))):(this.set("saveText",this.t("save")),this.editHeaderText=this.t("post.edit"),this.toastText=this.t("post.toast.updated")))}.bind(this),20)}});</script></body></html>