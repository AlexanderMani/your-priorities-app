<polymer-element name="yrpri-idea" attributes="small idea showCategory showName userImagesLimit">
  <template>

    <link rel="stylesheet" href="yrpri-idea.css">

    <div layout horizontal?="{{!small}}" flex>
      <div layout style="vertical-align: top;width:100%;">
        <div layout horizontal around-justified flex>
          <template if="{{showCategory}}">
            <div>
              <core-image class="category"
                        src="https://s3.amazonaws.com/better-reykjavik-paperclip-production/categories/icons/000/000/{{idea.Category.id | padNumber}}/icon_50/{{idea.Category.icon_file_name}}"/>

            </div>
          </template>
          <div flex class="header" on-tap="{{goToIdea}}" layout vertical>
            <div>
              <b>{{idea.name | trim | truncate(small ? 60 : 200) }}</b>
            </div>
            <template if="{{showName}}">
              <div class="userScreenname">
                {{idea.User.login}}
              </div>
            </template>
          </div>
          <template if="{{!small}}">
            <div flex style="">
              <idea-action-bar idea="{{idea}}" small="{{small}}" flex style="float:right; clear:right;"></idea-action-bar>
            </div>
            <core-icon-button icon="report" style="color:#eee;"></core-icon-button>
            <paper-icon-button class="share" style="color:#b0b0b0;" icon="image:remove-red-eye"></paper-icon-button>
            <paper-icon-button class="share" icon="social:share"></paper-icon-button>
            <template if="{{false}}">
              <paper-menu-button class="selected-items" layout horizontal>
                <paper-icon-button icon="more-vert"></paper-icon-button>
                <paper-dropdown class="dropdown" halign="right">
                  <div class="separator">Admin</div>
                  <paper-item>Breyta</paper-item>
                  <paper-item>Staða</paper-item>
                  <paper-item>Eyða</paper-item>
                </paper-dropdown>
              </paper-menu-button>
            </template>
          </template>
        </div>

        <div layout class="description">
          <template if="{{idea.IdeaRevision[0]}}">
            {{idea.IdeaRevision[0].description | trim | truncate(small ? 200 : 10000,"...")}}
          </template>
          <template if="{{idea.description}}">
            {{idea.description | trim | truncate(small ? 200 : 10000,"...")}}
          </template>
        </div>
        <template if="{{small}}">
          <idea-action-bar idea="{{idea}}" small="{{small}}" style=""></idea-action-bar>
        </template>
        <template if="{{!small}}">
          <paper-spinner id="spinner" style="padding-top:4px;display:block;" active></paper-spinner>
          <template if="{{endorsements}}">
            <div style="padding-top: 16px; opacity: 0.80;">
              <template repeat="{{endorsement, endorsementIndex in endorsements | limitTo(userImagesLimit)}}">
                <user-image user="{{endorsement.User}}" small></user-image>
              </template>
              <div id="moreImages" style="display:none;">
                <paper-icon-button class="more" id="moreImagesButton" icon="add" on-tap="{{moreUserImages}}"></paper-icon-button>
                <span id="numberOfMoreUserImages" style="display:none;margin-bottom:16px;padding-left:0px;margin-left:0px;">{{0 | countUserImagesLeft}}</span>
              <span id="restOfUserImages" style="display: none;">
                <template repeat="{{endorsement, endorsementIndex in endorsements | limitFrom(userImagesLimit,endorsements.length)}}">
                  <user-image user="{{endorsement.User}}" small></user-image>
                </template>
              </span>
                </div>
            </div>
          </template>
        </template>
      </div>
    </div>

    <template if="{{!small}}">
      <core-ajax
              auto="true"
              id="endorsementAjax"
              url="/api/ideas/{{idea.id}}/endorsements"
              response="{{response}}"
              handleAs="json">
      </core-ajax>
    </template>
  </template>

  <script>
    Polymer({

      userImagesLimit: 42,
      endorsements: [],

      allEndorsementsLength: function(idea) {
        return (this.endorsements.length);
      },

      countUserImagesLeft: function(e) {
        return this.allEndorsementsLength(this.idea)-this.userImagesLimit;
      },

      responseChanged: function (e, detail, sender) {
        this.$.spinner.active = false;
        this.$.spinner.style.display = "none";
        this.endorsements = detail;
        if (this.endorsements.length>this.userImagesLimit) {
          this.$.moreImages.style.display = "inline";
        }
      },

      moreUserImages: function() {
        this.$.moreImagesButton.style.display = "none";
        this.$.numberOfMoreUserImages.style.display = "none";
        this.$.restOfUserImages.style.display = "inline";
      },

      goToIdea: function (e) {
        window.location='/#/ideas/'+this.idea.id;
      }
    });
  </script>
</polymer-element>
