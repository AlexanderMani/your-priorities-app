<polymer-element name="idea-page" extends="base-page" attributes="contactId contacts" layout vertical>
  <template>
    <link rel="stylesheet" href="idea-page.css">
    <!--
    On larger screens, change the behavior of the header panel so it doesn't
    scroll away or do the condenses feature. Instead, treat its content like
    a regular toolbar.
    -->
    <core-media-query query="min-width: 640px" queryMatches="{{largeScreen}}">
    </core-media-query>
    <core-scroll-header-panel condenses keepCondensedHeader>

      <core-toolbar class="tall">

        <core-icon-button icon="arrow-back"></core-icon-button>
        <div flex></div>
        <core-icon-button icon="search"></core-icon-button>
        <core-icon-button icon="more-vert"></core-icon-button>
        <template if="{{idea}}">
          <div class="bottom indent title">{{idea.name}}</div>
        </template>
      </core-toolbar>

      <div class="content">
        <template if="{{idea}}">
          <div layout horizontal center-justified fill>
            <paper-shadow class="card" z="2" center-center layout>
              <div layout vertical flex>
                <div>
                  <yrpri-idea idea="{{idea}}"></yrpri-idea>
                </div>
                <div>
                  <paper-tabs selected="{{selected}}" id="paper_tabs" focused>
                    <paper-tab>Rökræða</paper-tab>
                    <paper-tab>Fréttir</paper-tab>
                    <paper-tab>Umræður</paper-tab>
                  </paper-tabs>

                  <core-animated-pages notap selected="{{selected}}" transitions="slide-from-right">
                    <section-points points="{{idea.Points}}"></section-points>
                    <section> bha</section>
                    <section> cha</section>
                  </core-animated-pages>

                </div>
              </div>
            </paper-shadow>
          </div>
        </template>
      </div>

    </core-scroll-header-panel>

    <core-ajax
            auto="false"
            id="ajax"
            url="/api/ideas/{{idea_id}}"
            response="{{response}}"
            handleAs="json">
    </core-ajax>
  </template>
  <script>
    (function () {
      Polymer({
        responseChanged: function (e, detail, sender) {
          this.idea = detail;
          var titleStyle = this.shadowRoot.querySelector('.title').style;
          addEventListener('core-header-transform', function (e) {
            var d = e.detail;
            var m = d.height - d.condensedHeight;
            var scale = Math.max(0.75, (m - d.y) / (m / 0.25) + 0.75);
            titleStyle.transform = titleStyle.webkitTransform =
                    'scale(' + scale + ') translateZ(0)';
          });
        },
        domReady: function () {
          this.$.ajax.go();
        },
        willPrepare: function () {
          this.super();

          // Measure the core-scroll-header-panel, otherwise its height will
          // be messed up
          this.$.scrollHeaderPanel.measureHeaderHeight();

          // Reset the scroller so every time the user comes to the info page
          // so they see the full profile photo
          this.$.scrollHeaderPanel.scroller.scrollTop = 0;
        }
      });
    })();
  </script>
</polymer-element>
