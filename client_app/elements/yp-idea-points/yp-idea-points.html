<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">

<link rel="import" href="../../bower_components/paper-material/paper-material.html">

<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../../bower_components/paper-input/paper-input-char-counter.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">

<link rel="import" href="../yp-behaviors/app-helpers.html">
<link rel="import" href="../yp-point/yp-point.html">

<dom-module id="yp-idea-points">
  <template>
    <style>

      .main-container {
        @apply(--layout-horizontal);
        @apply(--layout-flex);
      }

      .point {
        padding: 8px;
        margin: 8px;
        @apply(--layout-vertical);
      }

      .pointText {
        margin-bottom: 16px;
        margin-top: 16px;
        padding: 16px;
        padding-top: 24px;
      }
    </style>

    <div class="main-container">

        <div class="point">

          <paper-material elevation="0" class="pointText" animated>
            <paper-textarea id="up_point" on-tap="focusUpPoint" on-focus="focusTextArea" on-blur="blurTextArea"
                            bind-value="{{textValueUp}}" label="[[computeLabel()]]" char-counter rows="2" max-rows="5" maxlength="[[computeLabel()]]"></paper-textarea>

            <template is="dom-if" if="[[computeIf(textValueUp)]]">
              <div style="width:100%;text-align: center;padding-top: 10px;">
                <paper-fab icon="add" mini="" z="2" on-tap="addPointUp" class="upPointAction" title="[[computeTitle()]]"></paper-fab>
              </div>
            </template>
          </paper-material>

          <template is="dom-repeat" items="[[upPoints]]" as="point">
            <yp-point point="[[point]]"></yp-point>
          </template>

        </div>

        <div class="point">

          <paper-material elevation="0" class="pointText" animated>

            <paper-textarea id="down_point" on-tap="focusDownPoint" on-focus="focusTextArea" on-blur="blurTextArea"
                            bind-value="{{textValueDown}}" label="[[computeLabel()]]" char-counter rows="2" max-rows="5" maxlength="[[computeLabel()]]"></paper-textarea>

            <template is="dom-if" if="[[computeIf2(textValueDown)]]">
              <div id="downPointAction" style="width:100%;text-align: center;padding-top: 10px;">
                <paper-fab icon="add" mini="" z="2" on-tap="addPointDown" class="downPointAction" title="[[computeTitle2()]]"></paper-fab>
              </div>
            </template>
          </paper-material>

          <template is="dom-repeat" items="[[downPoints]]" as="point">
            <yp-point point="[[point]]"></yp-point>
          </template>
        </div>

      </div>
  </template>

  <script>
    (function () {
      Polymer({

        is: 'yp-idea-points',

        behaviors: [
          Polymer.appHelpers
        ],

        properties: {

          downPoints: {
            type: Array,
            value: function () {
              return [];
            }
          },

          points: { notify: true },

          text: {
            observer: 'textChanged'
          },

          upPoints: {
            type: Array,
            value: function () {
              return [];
            }
          },

          textValueUp: {
            type: String,
            value: ""
          },

          textValueDown: {
            type: String,
            value: ""
          }
        },

        addPointUp: function () {
          window.globals.activity('Anonymous', 'add', 'pointUp');
          window.globals.openDialog('point.add_up');
        },

        addPointDown: function () {
          window.globals.activity('Anonymous', 'add', 'pointDown');
          window.globals.openDialog('point.add_down');
        },

        focusUpPoint: function () {
          window.globals.activity('Anonymous', 'focus', 'pointUp');
        },

        focusDownPoint: function () {
          window.globals.activity('Anonymous', 'focus', 'pointDown');
        },

        focusTextArea: function (e) {
          e.srcElement.parentElement.parentElement.parentElement.setZ(3);
        },

        blurTextArea: function (e) {
          e.srcElement.parentElement.parentElement.parentElement.setZ(1);
        },

        textChanged: function (detail, e) {
          this.$.upPointAction.style.display = 'none';
          debugger;
          var text = e.srcElement;
          if (text.value.length >= 42) {
            if (text.id === 'up_point') {
              this.$.upPointAction.style.display = 'none';
            } else {
              this.$.downPointAction.style.display = 'none';
            }
          } else {
            if (text.id === 'up_point') {
              this.$.upPointAction.style.display = 'none';
            } else {
              this.$.downPointAction.style.display = 'none';
            }
          }
        },

        ready: function () {
          this.upPoints = this.points.filter(function (x) {
            return x.value > 0;
          });

          this.downPoints = this.points.filter(function (x) {
            return x.value < 0;
          });
        },

        computeLabel: function () {
          return this.t('point.for');
        },

        computeIf: function (textValueUp) {
          return textValueUp.length > 20;
        },

        computeLabel2: function () {
          return this.t('point.against');
        },

        computeIf2: function (textValueDown) {
          return textValueDown.length > 20;
        },

        computeTitle: function () {
          return this.t('points.add_up');
        },

        computeTitle2: function () {
          return this.t('points.add_down');
        }
      });
    }());
  </script>
</dom-module>
