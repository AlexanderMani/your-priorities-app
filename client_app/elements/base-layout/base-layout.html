<polymer-element name="base-layout" attributes="selected needLogin user pageTitle" extends="logged-in-page">
  <template>

    <link rel="stylesheet" href="base-layout.css">

    <core-media-query query="max-width: 550px" queryMatches="{{smallScreen}}"></core-media-query>

    <material-search id="search" narrow="{{narrow}}"
                     previousSearches="{{previousSearches}}"></material-search>

    <core-drawer-panel id="drawerPanel" narrow="{{narrow}}" responsiveWidth="2000px">

      <core-header-panel mode="scroll" drawer>
        <core-toolbar id="navheader" class="tall">
          <img class="middle profile" src="{{user.profile}}" hidden?="{{!user.profile}}">
          <div class="bottom" layout vertical>
            <span>Róbert Bjarnason</span>
            <span>50 samfélagsstig</span>
          </div>
        </core-toolbar>
        <core-menu selected="0" excludedLocalNames="div" on-core-select="{{menuSelect}}">
          <div class="separator" style="color:#F57C00">Betri Laugardalur 2015</div>
          <paper-item><core-icon icon="av:news" style="padding-right:16px;"></core-icon>Heim</paper-item>
          <paper-item><core-icon icon="image:wb-sunny" style="padding-right:16px;"></core-icon>Hugmyndir</paper-item>
          <paper-item><core-icon icon="social:people" style="padding-right:16px;"></core-icon>Fólk</paper-item>
          <div class="separator" style="color:#FFB74D">Betri Reykavík</div>
          <paper-item><core-icon icon="group-work" style="padding-right:16px;"></core-icon>Hugmyndahópar</paper-item>

          <div class="separator">Þínar hugmyndir</div>
          <paper-item>1. Hugmynd</paper-item>
          <paper-item>2. Hugmynd</paper-item>
          <paper-item>3. Hugmynd</paper-item>
          <template repeat="{{l in labels}}">
            <paper-item label="{{l.name}}" icon="label" class="{{l.color}}"></paper-item>
          </template>
        </core-menu>
      </core-header-panel>

      <core-scroll-header-panel id="scrollheader" main condenses keepCondensedHeader on-trackstart="{{onRefreshStart}}"  on-tracky="{{onMainAreaTrack}}" on-trackend="{{onRefreshUp}}">
        <core-toolbar id="mainheader" class="tall">
          <paper-icon-button icon="arrow-back" class="selected-item" on-tap="{{deselectAll}}"></paper-icon-button>

          <paper-icon-button id="navicon" icon="menu" core-drawer-toggle></paper-icon-button>
          <div flex></div>
        <span class="bottom indent title">
          <div layout vertical>
            <div layout horizontal>
              <div style="padding-right: 4px;padding-top:8px;">
                {{selectedThreads.length ? selectedThreads.length : 'Betri Laugardalur 2015'}}
              </div>
              <paper-menu-button class="selected-items" layout horizontal style="padding-top: 4px;">
                <paper-icon-button icon="filter-list"></paper-icon-button>
                <paper-dropdown class="dropdown" halign="right">
                  <paper-item>Efstu hugmyndir</paper-item>
                  <paper-item>Nýjustu hugmyndir</paper-item>
                  <paper-item>Hugmyndir af handahófi</paper-item>
                  <paper-item>Hugmyndir þinna vina</paper-item>
                </paper-dropdown>
              </paper-menu-button>
            </div>
            <div style="font-size:16px;margin-bottom: 8px;padding-bottom:8px; padding-left:4px;">
              Efstu hugmyndir í Framkvæmdum
            </div>
          </div>
        </span>
          <paper-icon-button icon="search" class="fade-on-drawer-open" on-tap="{{toggleSearch}}"></paper-icon-button>

          <paper-icon-button icon="social:group-add" class="selected-items" on-tap="{{archiveAll}}"></paper-icon-button>

          <paper-menu-button class="selected-items" layout horizontal>
            <paper-icon-button icon="more-vert"></paper-icon-button>
            <paper-dropdown class="dropdown" halign="right">
              <paper-item>Mín síða</paper-item>
              <paper-item>Um þessa síðu</paper-item>
              <paper-item>Hjálp</paper-item>
              <paper-item>Stillingar</paper-item>
            </paper-dropdown>
          </paper-menu-button>

          <div id="refresh" class="bottom fit"
               layout horizontal center-center on-transitionend="{{onRefreshTransitionEnd}}">
            <div class="paper-shadow-bottom-z-1">
              <paper-spinner id="refreshspinner"></paper-spinner>
            </div>
          </div>

        </core-toolbar>

          <template if="{{needLogin && !user}}">
            <shadow></shadow>
          </template>

          <template bind if="{{!needLogin || user}}">
            <div class="content">
              <content></content>
            </div>
          </template>
      </core-scroll-header-panel>

    </core-drawer-panel>
  </template>
  <script>
    Polymer({
      previousSearches: ["Blah","Hello"],
      smallScreen: false,
      selectedThreads: [],
      toggleSearch: function (e) {
        this.$.search.toggle();
      },
      domReady: function() {
        this.titleStyle = this.shadowRoot.querySelector('.title').style;
        this.checkForSmallScreen();

        window.onresize = function(event) {
          this.checkForSmallScreen();
        }.bind(this);

        var localTitleStyle = this.titleStyle;

        addEventListener('core-header-transform', function(e) {
          var d = e.detail;
          var m = d.height - d.condensedHeight;
          var scale = Math.max(0.75, (m - d.y) / (m / 0.25)  + 0.75);
          localTitleStyle.transform = localTitleStyle.webkitTransform =
            'scale(' + scale + ') translateZ(0)';
        });
      },
      checkForSmallScreen: function () {
        if (this.smallScreen===true) {
           this.titleStyle.fontSize="24px";
        } else {
           this.titleStyle.fontSize="40px";
        }
      }
    });
  </script>
</polymer-element>
