<polymer-element name="base-layout" attributes="selected needLogin user pageTitle" extends="logged-in-page">
  <template>

    <link rel="stylesheet" href="base-layout.css">

    <material-search id="search" narrow="{{narrow}}"
                     previousSearches="{{previousSearches}}"></material-search>

    <core-drawer-panel id="drawerPanel" narrow="{{narrow}}">

      <core-header-panel mode="scroll" drawer>
        <core-toolbar id="navheader" class="tall">
          <img class="middle profile" src="{{user.profile}}" hidden?="{{!user.profile}}">
          <div class="bottom" layout vertical>
            <span>Username</span>
            <span>50 social points</span>
          </div>
        </core-toolbar>
        <core-menu selected="0" excludedLocalNames="div" on-core-select="{{menuSelect}}">
          <div class="separator">Betri Reykavík</div>
          <paper-item>Hugmyndasvæði</paper-item>
          <div class="separator">Betri Laugardalur 2015</div>
          <paper-item>Heim</paper-item>
          <paper-item>Hugmyndir</paper-item>
          <paper-item>Fólk</paper-item>
          <div class="separator">Þínar hugmyndir</div>
          <paper-item>1. Hugmynd</paper-item>
          <paper-item>2. Hugmynd</paper-item>
          <paper-item>3. Hugmynd</paper-item>
          <template repeat="{{l in labels}}">
            <paper-item label="{{l.name}}" icon="label" class="{{l.color}}"></paper-item>
          </template>
        </core-menu>
      </core-header-panel>

      <core-scroll-header-panel id="scrollheader" main condenses keepCondensedHeader on-trackstart="{{onRefreshStart}}"  on-tracky="{{onMainAreaTrack}}" on-trackend="{{onRefreshUp}}">
        <core-toolbar id="mainheader" class="tall {{ {'core-narrow': narrow, 'selected-threads': selectedThreads.length} | tokenList }}">
          <paper-icon-button icon="arrow-back" class="selected-item" on-tap="{{deselectAll}}"></paper-icon-button>

          <paper-icon-button id="navicon" icon="menu" core-drawer-toggle></paper-icon-button>
          <div flex></div>
        <span class="bottom indent title">
          {{selectedThreads.length ? selectedThreads.length : 'Betri Laugardalur 2015'}}
        </span>
          <paper-icon-button icon="search" class="fade-on-drawer-open" on-tap="{{toggleSearch}}"></paper-icon-button>

          <paper-icon-button icon="archive" class="selected-items" on-tap="{{archiveAll}}"></paper-icon-button>

          <paper-menu-button class="selected-items" layout horizontal>
            <paper-icon-button icon="more-vert"></paper-icon-button>
            <paper-dropdown class="dropdown" halign="right">
              <paper-item>About</paper-item>
              <paper-item>Help</paper-item>
              <paper-item>Settings</paper-item>
            </paper-dropdown>
          </paper-menu-button>

          <div id="refresh" class="bottom fit"
               layout horizontal center-center on-transitionend="{{onRefreshTransitionEnd}}">
            <div class="paper-shadow-bottom-z-1">
              <paper-spinner id="refreshspinner"></paper-spinner>
            </div>
          </div>

        </core-toolbar>

          <template if="{{needLogin && !user}}">
            <shadow></shadow>
          </template>

          <template bind if="{{!needLogin || user}}">
            <div class="content">
              <content></content>
            </div>
          </template>
      </core-scroll-header-panel>

    </core-drawer-panel>
  </template>
  <script>
    Polymer({
      previousSearches: ["Blah","Hello"],
      selectedThreads: [],
      toggleSearch: function (e) {
        this.$.search.toggle();
      },
      domReady: function() {
        var titleStyle = this.shadowRoot.querySelector('.title').style;
        addEventListener('core-header-transform', function(e) {
          var d = e.detail;
          var m = d.height - d.condensedHeight;
          var scale = Math.max(0.75, (m - d.y) / (m / 0.25)  + 0.75);
          titleStyle.transform = titleStyle.webkitTransform =
            'scale(' + scale + ') translateZ(0)';
        });
      },
    });
  </script>
</polymer-element>
