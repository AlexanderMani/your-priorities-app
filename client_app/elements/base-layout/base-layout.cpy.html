<polymer-element name="base-layout" attributes="selected needLogin user pageTitle" extends="logged-in-page">
  <template>

    <link rel="stylesheet" href="base-layout.css">


    <core-media-query query="min-width: 640px" queryMatches="{{largeScreen}}"></core-media-query>

    <core-scroll-header-panel id="scrollHeaderPanel"
                              condenses?="{{!largeScreen}}"
                              fixed?="{{largeScreen}}"
                              flex>

      <core-toolbar class="{{ {tall: !largeScreen} | tokenList}}">
        <a href="/" on-click="{{goBack}}">
          <paper-icon-button icon="arrow-back"></paper-icon-button>
        </a>

        <div id="title" class="bottom indent">{{pageTitle}}</div>
      </core-toolbar>


        <core-menu>

          <a active?="{{selected == 'home'}}" href="/">
            <paper-item>Home</paper-item>
          </a>

          <a active?="{{selected == 'ideas'}}" href="/ideas">
            <paper-item>Ideas</paper-item>
          </a>
        </core-menu>

        <content select=".title"></content>

        <template if="{{needLogin && !user}}">
          <shadow></shadow>
        </template>

        <template bind if="{{!needLogin || user}}">
          <div class="content">
            <content></content>
          </div>
        </template>
    </core-scroll-header-panel>


  </template>
  <script>
    (function() {
      Polymer({
        domReady: function() {
          // custom transformation: scale header's title
          var titleStyle = this.$.title.style;
          document.addEventListener('core-header-transform', function(e) {
            var d = e.detail;
            var m = d.height - d.condensedHeight;
            var scale = Math.max(0.55, (m - d.y) / (m / 0.25) + 0.55);
            titleStyle.transform = titleStyle.webkitTransform =
              'scale(' + scale + ') translateZ(0)';
          });
        },
        willPrepare: function() {
          this.super();
          // Measure the core-scroll-header-panel, otherwise its height will
          // be messed up
          this.$.scrollHeaderPanel.measureHeaderHeight();
          // Reset the scroller so every time the user comes to the info page
          // so they see the full profile photo
          this.$.scrollHeaderPanel.scroller.scrollTop = 0;
        },
        contactIdChanged: function(oldVal, newVal) {
          this.contact_ = this.contacts[newVal];
          if (this.largeScreen) return;
          // Update the core-scroll-header-panel's background image with the
          // user's avatar if we're on a small screen
          this.$.scrollHeaderPanel.$.headerBg.style.background = 'url('+this.contact_.avatar+') 0 / cover no-repeat';
        }
      });
    })();
  </script>
</polymer-element>
