  <style is="custom-style">
    /* TODO(polyup): For speed, consider reworking these styles with .classes
                     and #ids rather than [attributes].
    */
    [fit] {
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
    }
  </style>
  <!--
      TODO(polyup): unable to infer path to components
      directory. This import path is probably incomplete.
   -->
  <link rel="import" href="iron-flex-layout/iron-flex-layout.html">
<dom-module id="material-search">
  <style>
    /* TODO(polyup): For speed, consider reworking these styles with .classes
                     and #ids rather than [attributes].
    */
    :host[fit] {
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
    }
    [fit] {
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
    }
  </style>
  <style>
      :host {
        display: none;
        margin: 0;
        background: rgba(255, 255, 255, 0.9);
        color: #757575;
        z-index: 20;
      }
      :host([active]) {
        display: block;
      }

      core-menu {
        margin-left: 0;
        margin-right: 0;
      }

      core-toolbar {
        background-color: white;
      }

      input {
        border: none;
        background: transparent;
        font: inherit;
        font-size: 16px;
        outline: none;
      }

      @media (min-width: 600px) {
        core-menu {
          max-width: 50%;
          margin: 0 auto;
        }
      }
      paper-item::shadow core-icon {
        margin-right: 24px !important;
      }
    </style>
  <template>
    <paper-header-panel mode="standard" fit="">
      <paper-toolbar class$="{{computeClass(narrow)}}">
        <paper-icon-button icon="arrow-back" on-tap="toggle"></paper-icon-button>
        <input id="searchbox" placeholder="{{computePlaceholder()}}" value="{{term::input}}" flex="">
        <paper-icon-button icon="av:mic"></paper-icon-button>
      </paper-toolbar>
      <paper-menu on-core-select="onSelect">
        <template is="dom-repeat" items="{{previousSearches}}" as="p">
          <paper-item icon="history" label="{{p}}"></paper-item>
        </template>
      </paper-menu>
    </paper-header-panel>
    <iron-a11y-keys target="{{searchbox}}" keys="enter" on-keys-pressed="enterHandler"></iron-a11y-keys>
  </template>
  <script>
    Polymer({
      is: 'material-search',
      properties: {
        active: {
          type: Boolean,
          value: false,
          notify: true,
          reflectToAttribute: true
        },
        groupId: { notify: true },
        narrow: {
          type: Boolean,
          value: false,
          notify: true,
          reflectToAttribute: true
        },
        previousSearches: { notify: true }
      },
      enterHandler: function () {
        window.location = '/#/groups/' + this.groupId + '/search/' + this.term;
      },
      created: function () {
        this.previousSearches = [];
      },
      onSelect: function (e, detail, sender) {
        if (detail.isSelected) {
          this.async(function () {
            this.toggle();
          }, null, 250);
        }
      },
      // Introduce small delay so user sees ripple.
      toggle: function () {
        window.globals.activity('Anonymous', 'toggle', 'search', this.active);
        this.active = !this.active;
        if (this.active) {
          this.$.searchbox.focus();
        }
      },
      hostAttributes: { 'fit': '' },
      computeClass: function (narrow) {
        return this.tokenList({ 'core-narrow': narrow });
      },
      computePlaceholder: function () {
        return this.t('ideas.search');
      },
      tokenList: function (obj) {
        var pieces = [];
        for (key in obj) {
          if (obj[key]) {
            pieces.push(key);
          }
        }
        return pieces.join(' ');
      }
    });
  </script>
</dom-module>
