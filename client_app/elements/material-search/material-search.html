<polymer-element name="material-search" attributes="active previousSearches narrow groupId globals"  fit>
  <template>
    <style>
      :host {
        display: none;
        margin: 0;
        background: rgba(255, 255, 255, 0.9);
        color: #757575;
        z-index: 20;
      }
      :host([active]) {
        display: block;
      }

      core-menu {
        margin-left: 0;
        margin-right: 0;
      }

      core-toolbar {
        background-color: white;
      }

      input {
        border: none;
        background: transparent;
        font: inherit;
        font-size: 16px;
        outline: none;
      }

      @media (min-width: 600px) {
        core-menu {
          max-width: 50%;
          margin: 0 auto;
        }
      }
      paper-item::shadow core-icon {
        margin-right: 24px !important;
      }
    </style>
    <core-header-panel mode="standard" fit>
      <core-toolbar class="{{ {'core-narrow' : narrow} | tokenList}}">
        <paper-icon-button icon="arrow-back" on-tap="{{toggle}}"></paper-icon-button>
        <input id="searchbox" placeholder="{{'ideas.search' | t}}" value="{{term}}" flex>
        <paper-icon-button icon="av:mic"></paper-icon-button>
      </core-toolbar>
      <core-menu on-core-select="{{onSelect}}">
        <template repeat="{{p in previousSearches}}">
          <paper-item icon="history" label="{{p}}"></paper-item>
        </template>
      </core-menu>
    </core-header-panel>
    <core-a11y-keys target="{{searchbox}}" keys="enter" on-keys-pressed="{{enterHandler}}"></core-a11y-keys>
  </template>
  <script>
    Polymer({
      publish: {
        narrow: {value: false, reflect: true},
        active: {value: false, reflect: true}
      },

      enterHandler: function () {
        window.location = "/#/groups/" + this.groupId + "/search/"+ this.term;
      },

      created: function() {
        this.previousSearches = [];
      },

      onSelect: function(e, detail, sender) {
        if (detail.isSelected) {
          this.async(function() {
            this.toggle();
          }, null, 250); // Introduce small delay so user sees ripple.
        }
      },

      toggle: function() {
        this.globals.activity("Anonymous","toggle","search",this.active);
        this.active = !this.active;
        if (this.active) {
          this.$.searchbox.focus();
        }
      }
    });
  </script>
</polymer-element>
