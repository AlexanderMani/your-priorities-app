<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icons/communication-icons.html" >
<link rel="import" href="../../bower_components/iron-icons/image-icons.html" >
<link rel="import" href="../../bower_components/iron-icons/social-icons.html" >
<link rel="import" href="../../bower_components/iron-image/iron-image.html" >

<link rel="import" href="../yp-behaviors/app-helpers.html">
<link rel="import" href="../yp-user/yp-user-image.html">
<link rel="import" href="../yp-point/yp-point-news-story.html">

<dom-module id="yp-point-comment-list">

  <template>

    <style>
      yp-point-comment-edit {

      }

      iron-list {
       max-height: 500px;
       width: 650px;
        --iron-list-items-container: {
          margin: auto;
          margin-top: 32px;
        };
      }

      .listContainer {
        padding-top: 24px;
        padding-left: 32px;
        padding-right: 32px;
      }

      yp-point-comment {
      }
    </style>

    <div class="layout vertical center-center listContainer">
      <iron-list id="list" items="[[comments]]" as="point">
        <template>
          <yp-point-comment point="[[point]]" tabindex$="[[tabIndex]]"></yp-point-comment>
        </template>
      </iron-list>
      <yp-point-comment-edit on-refresh="_refresh" point="[[point]]" image="[[image]]"></yp-point-comment-edit>
      <div class="layout horizontal center-center">
        <yp-ajax large-spinner id="commentListAjax" method="GET" on-response="_commentsResponse"></yp-ajax>
      </div>
    </div>
  </template>

  <script>
    Polymer({

      is: 'yp-point-comment-list',

      properties: {

        comments: {
          type: Array
        },

        point: {
          type: Object,
          notify: true,
          observer: "_pointChanged"
        },

        image: {
          type: Object,
          notify: true,
          observer: "_imageChanged"
        }
      },

      _pointChanged: function(newPoint) {
        if (newPoint) {
          this.$.commentListAjax.url = '/api/points/'+newPoint.id+'/comments';
          this.$.commentListAjax.generateRequest();
        }
      },

      _refresh: function () {
        this.$.commentListAjax.generateRequest();
      },

      _imageChanged: function(newImage) {
        if (newImage) {
          this.$.commentListAjax.url = '/api/images/'+newImage.id+'/comments';
          this.$.commentListAjax.generateRequest();
        }
      },

      _commentsResponse: function (event, detail) {
        debugger;
        var comment = detail.response;
        this.set('comments', comment);
        this.$.list.fire('iron-resize');
        if (comment && comment.length>0) {
          this.$.list.scrollToIndex(comment.length-1);
        }
      }
    });
  </script>
</dom-module>
