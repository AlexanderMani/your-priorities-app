<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-image/iron-image.html" >

<dom-module id="yp-user-image">
  <template>
    <style>
      :host {
        display: block;
        vertical-align: text-top;
      }

      .small {
        height: 24px;
        width: 24px;
        background-color: var(--primary-color-lighter,#434343);
      }

      .medium {
        height: 48px;
        width: 48px;
        background-color: var(--primary-color-lighter,#434343);
      }

      .rounded {
        -webkit-border-radius: 25px;
        -moz-border-radius: 25px;
        border-radius: 25px;
        display: block;
      }

      .rounded-more {
        -webkit-border-radius: 30px;
        -moz-border-radius: 30px;
        border-radius: 30px;
        display: block;
        vertical-align: top;
        align: top;
      }

      .rounded img { opacity: 0; }

      .rounded-more img { opacity: 0; }

    </style>

    <template restamp is="dom-if" if="[[user]]">

      <template is="dom-if" if="[[profileImageUrl]]">
        <iron-image sizing="cover" title="{{user.name}}" preload src="[[profileImageUrl]]" class$="[[computeClass(small)]]"></iron-image>
      </template>

      <template is="dom-if" if="[[!profileImageUrl]]">
        <template is="dom-if" if="[[user.facebook_uid]]">
          <iron-image sizing="cover" title="{{user.name}}" preload src$="[[computeFacebookSrc(user)]]" class$="[[computeClass(small)]]"></iron-image>
        </template>

        <template is="dom-if" if="[[computeIf(user)]]">
          <span>{{user.id}}</span> <span>{{user.buddy_icon_file_name}}</span><br>
        </template>

        <template is="dom-if" if="[[!user.facebook_uid]]">
          <iron-image sizing="cover" title="{{user.name}}" preload src="https://s3.amazonaws.com/better-reykjavik-paperclip-production/instances/buddy_icons/000/000/001/icon_50/default_profile.png" class$="[[computeClass(small)]]"></iron-image>
        </template>
      </template>

    </template>
  </template>

  <script>
    Polymer({

      is: 'yp-user-image',

      properties: {
        small: {
          type: Boolean,
          value: false
        },

        user: {
          type: Object,
          observer: "_userChanged"
        },

        profileImageUrl: {
          type: String
        }
      },

      _userChanged: function (newValue, oldValue) {
        if (newValue && newValue.UserProfileImages && newValue.UserProfileImages.length > 0) {
          var profileImages = newValue.UserProfileImages;
          var formats = JSON.parse(profileImages[profileImages.length - 1].formats);
          if (formats && formats.length > 0) {
            this.profileImageUrl = formats[0];
          }
        }
      },

      computeIf: function (user) {
        return false && !user.facebook_uid && user.buddy_icon_file_name;
      },

      computeClass: function (small) {
        if (this.small)
          return 'small rounded';
        else
          return 'medium rounded';
      },

      computeFacebookSrc: function (user) {
        return 'http://graph.facebook.com/' + user.facebook_uid + '/picture';
      },

      ready: function () {
      }
    });
  </script>
</dom-module>
