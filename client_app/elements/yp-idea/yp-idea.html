<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">

<link rel="import" href="../../bower_components/paper-tabs/paper-tab.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/neon-animation/neon-animated-pages.html">

<link rel="import" href="../yp-behaviors/app-helpers.html">
<link rel="import" href="../yp-idea-header/yp-idea-header.html">
<link rel="import" href="../yp-idea-points/yp-idea-points.html">

<dom-module id="yp-idea">
  <template>
    <style>
      .container {
        @apply(--layout-vertical)
      }
    </style>
    <div class="container">
      <yp-ajax auto id="ajax" url$="[[computeUrl(ideaId)]]" on-response="_response" handle-as="json"></yp-ajax>
      <yp-idea-header idea="[[idea]]" showcategory="true"></yp-idea-header>

      <paper-tabs selected="[[selected]]" id="paper_tabs" focused="">
        <paper-tab><span>[[computeExpression1()]]</span> (<span>[[idea.Points.length]]</span>)</paper-tab>
        <paper-tab>[[computeExpression3()]]</paper-tab>
        <paper-tab>[[computeExpression4()]]</paper-tab>
        <paper-tab>[[computeExpression5()]]</paper-tab>
      </paper-tabs>

      <neon-animated-pages notap="" selected="[[selected]]" style="width:100%;" transitions="slide-from-right">
        <template is="dom-if" if="[[idea]]">
          <yp-idea-points points="[[idea.Points]]"></yp-idea-points>
        </template>
        <section><center><br><br><h1>[[computeExpression8()]]</h1></center></section>
        <section><center><br><br><h1>[[computeExpression8()]]</h1></center></section>
        <section><center><br><br><h1>[[computeExpression8()]]</h1></center></section>
      </neon-animated-pages>
    </div>
  </template>

  <script>
    (function () {
      Polymer({

        is: 'yp-idea',

        behaviors: [
          Polymer.appHelpers
        ],

        properties: {
          ideaId: {
            type: String,
            value: 519
          },

          contactId: { notify: true },
          contacts: { notify: true },
          ideaName: { notify: true },
          selected: { observer: 'selectedChanged' }
        },

        _response: function (event, detail, sender) {
          this.idea = detail.response;
          if (this.idea.description === null) {
            this.idea.description = this.idea.Points[0].content;
            this.idea.Points.shift();
          }
        },

        selectedChanged: function (selected, previous) {
          if (selected == 0)
            window.globals.activity('Anonymous', 'open', 'pointsTab');
          else if (selected == 1)
            window.globals.activity('Anonymous', 'open', 'newsfeedTab');
          else if (selected == 2)
            window.globals.activity('Anonymous', 'open', 'photosTab');
          else if (selected == 3)
            window.globals.activity('Anonymous', 'open', 'solutionsTab');
        },

        ready: function () {
        },

        computeUrl: function (idea_id) {
          return '/api/ideas/' + idea_id;
        },
        computeExpression1: function () {
          return this.t('ideas.tabs.debate');
        },
        computeExpression3: function () {
          return this.t('ideas.tabs.newsfeed');
        },
        computeExpression4: function () {
          return this.t('ideas.tabs.photos');
        },
        computeExpression5: function () {
          return this.t('ideas.tabs.solutions');
        },
        computeExpression8: function () {
          return this.t('ideas.tabs.not_implemented');
        }
      });
    }());
  </script>
</dom-module>
