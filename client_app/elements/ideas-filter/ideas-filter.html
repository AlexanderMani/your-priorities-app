<polymer-element name="ideas-filter" attributes="categories groupId groupName">
  <template>

    <link rel="stylesheet" href="ideas-filter.css">

    <paper-menu-button class="selected-items" layout horizontal
                       style="padding-left:0px;padding-top: 0px;margin-top: -8px;">
      <paper-icon-button class="filterIcon" icon="editor:merge-type"></paper-icon-button>
      <paper-dropdown id="filterDropdown" class="dropdown" halign="left">
        <div layout horizontal>
          <div>
            <core-selector on-core-select="{{ changeFilter }}">
              <paper-item data-filter="top">{{'ideas.top' | t}}</paper-item>
              <paper-item data-filter="newest">{{'ideas.newest' | t}}</paper-item>
              <paper-item data-filter="random">{{'ideas.random' | t}}</paper-item>
              <paper-item data-filter="inProgress">{{'ideas.inProgress' | t}}</paper-item>
            </core-selector>
          </div>
          <template if="{{categories}}">
            <div>
              <core-selector on-core-select="{{ changeCategory }}">
                <template repeat="{{category in categories}}">
                  <paper-item data-category-id="{{category.id}}">{{category.name}}</paper-item>
                </template>
              </core-selector>
            </div>
          </template>
        </div>
      </paper-dropdown>
    </paper-menu-button>
  </template>
  <script>
    Polymer({

      changeFilter: function (e, detail) {
        window.selectedFilter = detail.item.dataset.filter;
        this.updateAfterFiltering();
      },

      changeCategory: function (e, detail) {
        var categoryId = detail.item.dataset.categoryId;
        if (categoryId != -1) {
          window.categoryId = categoryId;
        } else {
          window.categoryId = null;
        }
        this.updateAfterFiltering();
      },

      updateAfterFiltering: function () {
        var newLocation = "/#/groups/" + this.groupId + "/ideas/" + window.selectedFilter + "/" + this.groupName;
        if (window.categoryId) {
          newLocation += "/" + window.categoryId;
        }
        window.location = newLocation;
      }

    });
  </script>
</polymer-element>
