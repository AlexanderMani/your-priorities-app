<polymer-element name="groups-home-page">
  <template>
    <link rel="stylesheet" href="groups-home-page.css">

    <core-ajax
            auto="false"
            id="ajax"
            url="/api/groups"
            response="{{response}}"
            handleAs="json">
    </core-ajax>

    <base-layout id="layout" selected="groupsHome" showLogo="true"
                 name="{{name}}" subTitle="{{subTitle}}">
      <div class="card-container">
        <template repeat="{{groups as group}}">
          <paper-shadow class="card" z="1" center-center layout>
            <yrpri-group group="{{group}}" small="true"></yrpri-group>
          </paper-shadow>
        </template>
        <a href="/addGroup" on-click="{{navigate}}">
          <paper-fab icon="group-work" z="1" class="createIdea" title="create"></paper-fab>
        </a>
      </div>

    </base-layout>
  </template>

  <script>

    Polymer({

      shortName: null,
      groupHome: false,
      name: PolymerExpressions.prototype.instanceName(),
      subTitle: PolymerExpressions.prototype.t("ideas.groups"),
      groups: [],

      ready: function () {
        this.$.layout.setSpinner(true);
        this.$.ajax.go();
      },

      responseChanged: function (e, detail, sender) {
        this.$.layout.setSpinner(false);
        if (window.defaultGroupFirst) {
          this.groups = this.defaultGroupFirst(detail);
        } else {
          this.groups = this.noTestGroup(detail);
        }
      },

      defaultGroupFirst: function (items) {
        var filtered = [];
        var defaultGroup = null;
        for (var i = 0; i < items.length; i++) {
          var item = items[i];
          if (item.short_name!="default") {
            filtered.push(item);
          } else {
            defaultGroup = item;
          }
        }
        filtered.unshift(defaultGroup);
        return filtered;
      },

      noTestGroup: function (items) {
        var filtered = [];
        for (var i = 0; i < items.length; i++) {
          var item = items[i];
          if (item.short_name!="test") {
            filtered.push(item);
          }
        }
        return filtered;
      }

    });
  </script>
</polymer-element>
