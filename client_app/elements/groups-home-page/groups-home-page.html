<polymer-element name="groups-home-page">
  <template>
    <link rel="stylesheet" href="groups-home-page.css">

    <core-ajax
            auto="false"
            id="ajax"
            url="/api/groups"
            response="{{response}}"
            handleAs="json">
    </core-ajax>

    <base-layout id="layout" selected="groups" showLogo="true" name="{{name}}" subTitle="{{subTitle}}">
      <div class="card-container">
        <template repeat='{{groups as group}}'>
          <paper-shadow class="card" z="1" center-center layout>
            <yrpri-group globals="{{globals}}" group="{{group}}" small="true"></yrpri-group>
          </paper-shadow>
        </template>
        <paper-fab icon="group-work" z="1" class="createIdea" title="create" on-tap="{{newGroup}}">
        </paper-fab>
      </div>
    </base-layout>
  </template>

  <script>

    Polymer({

      shortName: null,

      groupHome: false,

      name: PolymerExpressions.prototype.instanceName(),

      subTitle: PolymerExpressions.prototype.t("ideas.groups"),

      groups: [],

      ready: function () {
        this.$.layout.setSpinner(true);
        this.$.ajax.go();
      },

      newGroup: function () {
        window.globals.activity("Anonymous","open","newGroup");
        window.globals.openDialog("groups.new");
      },

      responseChanged: function (e, detail, sender) {
        this.$.layout.setSpinner(false);
        if (window.defaultGroupFirst) {
          this.groups = this.defaultGroupFirst(detail);
        } else {
          this.groups = this.noTestGroup(detail);
        }
      },

      defaultGroupFirst: function (items) {
        var filtered = [];
        var defaultGroup = null;
        for (var i = 0; i < items.length; i++) {
          var item = items[i];
          if (item.short_name!="default") {
            filtered.push(item);
          } else {
            defaultGroup = item;
          }
        }
        filtered.unshift(defaultGroup);
        return filtered;
      },

      noTestGroup: function (items) {
        var filtered = [];
        for (var i = 0; i < items.length; i++) {
          var item = items[i];
          if (item.short_name!="test" &&
              item.short_name!="ac-ideas" &&
              item.short_name!="development" &&
              item.short_name.indexOf("2012") == -1 &&
              item.short_name.indexOf("2013") == -1) {
            filtered.push(item);
          }
        }
        return filtered;
      }
    });
  </script>
</polymer-element>
