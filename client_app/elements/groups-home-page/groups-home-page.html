  <!--
      TODO(polyup): unable to infer path to components
      directory. This import path is probably incomplete.
   -->
  <link rel="import" href="iron-flex-layout/iron-flex-layout.html">
<dom-module id="groups-home-page">
  <style>
    /* TODO(polyup): For speed, consider reworking these styles with .classes
                     and #ids rather than [attributes].
    */
    [layout] {
      @apply(--layout);
    }
    [layout][center-center] {
      @apply(--layout-center-center);
    }
  </style>
  <link rel="import" type="css" href="groups-home-page.css">
  <template>

    <iron-ajax auto="false" id="ajax" url="/api/groups" last-response="{{response}}" handle-as="json">
    </iron-ajax>

    <base-layout id="layout" selected="groups" showlogo="true" name="{{name}}" subtitle="{{subTitle}}">
      <div class="card-container">
        <template is="dom-repeat" items="{{groups}}" as="group">
          <paper-material class="card" elevation="1" center-center="" layout="">
            <yrpri-group globals="{{globals}}" group="{{group}}" small="true"></yrpri-group>
          </paper-material>
        </template>
        <paper-fab icon="group-work" z="1" class="createIdea" title="create" on-tap="newGroup">
        </paper-fab>
      </div>

    </base-layout>
  </template>
  <script>
    Polymer({
      is: 'groups-home-page',
      properties: {
        groupHome: {
          type: Boolean,
          value: false
        },
        groups: {
          type: Array,
          value: function () {
            return [];
          }
        },
        response: { observer: 'responseChanged' },
        shortName: { value: null }
      },
      name: PolymerExpressions.prototype.instanceName(),
      subTitle: PolymerExpressions.prototype.t('ideas.groups'),
      ready: function () {
        this.$.layout.setSpinner(true);
        this.$.ajax.go();
      },
      newGroup: function () {
        window.globals.activity('Anonymous', 'open', 'newGroup');
        window.globals.openDialog('groups.new');
      },
      responseChanged: function (detail, e, sender) {
        this.$.layout.setSpinner(false);
        if (window.defaultGroupFirst) {
          this.groups = this.defaultGroupFirst(detail);
        } else {
          this.groups = this.noTestGroup(detail);
        }
      },
      defaultGroupFirst: function (items) {
        var filtered = [];
        var defaultGroup = null;
        for (var i = 0; i < items.length; i++) {
          var item = items[i];
          if (item.short_name != 'default') {
            filtered.push(item);
          } else {
            defaultGroup = item;
          }
        }
        filtered.unshift(defaultGroup);
        return filtered;
      },
      noTestGroup: function (items) {
        var filtered = [];
        for (var i = 0; i < items.length; i++) {
          var item = items[i];
          if (item.short_name != 'test' && item.short_name != 'ac-ideas' && item.short_name != 'development' && item.short_name.indexOf('2012') == -1 && item.short_name.indexOf('2013') == -1) {
            filtered.push(item);
          }
        }
        return filtered;
      }
    });
  </script>
</dom-module>
